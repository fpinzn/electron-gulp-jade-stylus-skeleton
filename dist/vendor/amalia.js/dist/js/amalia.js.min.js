/*! V1.3.0, Â© INA 2015 */
/**
 * Copyright (c) 2015 Institut National de l'Audiovisuel, INA
 * This file is part of amalia.js

 * amalia.js is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or (at your option) any later version.

 * Redistributions of source code, javascript and css minified versions
 * must retain the above copyright notice, this list of conditions and the following disclaimer.

 * Neither the name of the copyright holder nor the names of its
 * contributors may be used to endorse or promote products derived from
 * this software without specific prior written permission.

 * You should have received a copy of the GNU General Public License
 * along with amalia.js. If not, see <http://www.gnu.org/licenses/>

 *
 * amalia.js is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU General Public License for more details.
 */

function X2JS(a,b,c){function d(a){var b=a.localName;return null==b&&(b=a.baseName),(null==b||""==b)&&(b=a.nodeName),b}function e(a){return a.prefix}function f(a){return"string"==typeof a?a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;"):a}function g(a){return a.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&#x2F;/g,"/")}function h(f){if(f.nodeType==u.DOCUMENT_NODE){var i,j,k,l=f.firstChild;for(j=0,k=f.childNodes.length;k>j;j+=1)if(f.childNodes[j].nodeType!==u.COMMENT_NODE){l=f.childNodes[j];break}if(c)i=h(l);else{i={};var m=d(l);i[m]=h(l)}return i}if(f.nodeType==u.ELEMENT_NODE){var i=new Object;i.__cnt=0;for(var n=f.childNodes,o=0;o<n.length;o++){var l=n.item(o),m=d(l);if(i.__cnt++,null==i[m])i[m]=h(l),i[m+"_asArray"]=new Array(1),i[m+"_asArray"][0]=i[m];else{if(null!=i[m]&&!(i[m]instanceof Array)){var p=i[m];i[m]=new Array,i[m][0]=p,i[m+"_asArray"]=i[m]}for(var q=0;null!=i[m][q];)q++;i[m][q]=h(l)}}for(var r=0;r<f.attributes.length;r++){var s=f.attributes.item(r);i.__cnt++;for(var v=s.value,w=0,x=a.length;x>w;w++){var y=a[w];y.test.call(this,s.value)&&(v=y.converter.call(this,s.value))}i[b+s.name]=v}var z=e(f);return null!=z&&""!=z&&(i.__cnt++,i.__prefix=z),1==i.__cnt&&null!=i["#text"]&&(i=i["#text"]),null!=i["#text"]&&(i.__text=i["#text"],t&&(i.__text=g(i.__text)),delete i["#text"],delete i["#text_asArray"]),null!=i["#cdata-section"]&&(i.__cdata=i["#cdata-section"],delete i["#cdata-section"],delete i["#cdata-section_asArray"]),(null!=i.__text||null!=i.__cdata)&&(i.toString=function(){return(null!=this.__text?this.__text:"")+(null!=this.__cdata?this.__cdata:"")}),i}return f.nodeType==u.TEXT_NODE||f.nodeType==u.CDATA_SECTION_NODE?f.nodeValue:f.nodeType==u.COMMENT_NODE?null:void 0}function i(a,b,c,d){var e="<"+(null!=a&&null!=a.__prefix?a.__prefix+":":"")+b;if(null!=c)for(var f=0;f<c.length;f++){var g=c[f],h=a[g];e+=" "+g.substr(1)+"='"+h+"'"}return e+=d?"/>":">"}function j(a,b){return"</"+(null!=a.__prefix?a.__prefix+":":"")+b+">"}function k(a,b){return-1!==a.indexOf(b,a.length-b.length)}function l(a,b){return k(b.toString(),"_asArray")||0==b.toString().indexOf("_")||a[b]instanceof Function?!0:!1}function m(a){var b=0;if(a instanceof Object)for(var c in a)l(a,c)||b++;return b}function n(a){var b=[];if(a instanceof Object)for(var c in a)-1==c.toString().indexOf("__")&&0==c.toString().indexOf("_")&&b.push(c);return b}function o(a){var b="";return null!=a.__cdata&&(b+="<![CDATA["+a.__cdata+"]]>"),null!=a.__text&&(b+=t?f(a.__text):a.__text),b}function p(a){var b="";return a instanceof Object?b+=o(a):null!=a&&(b+=t?f(a):a),b}function q(a,b,c){var d="";if(0==a.length)d+=i(a,b,c,!0);else for(var e=0;e<a.length;e++)d+=i(a[e],b,n(a[e]),!1),d+=r(a[e]),d+=j(a[e],b);return d}function r(a){var b="",c=m(a);if(c>0)for(var d in a)if(!l(a,d)){var e=a[d],f=n(e);if(null==e||void 0==e)b+=i(e,d,f,!0);else if(e instanceof Object)if(e instanceof Array)b+=q(e,d,f);else{var g=m(e);g>0||null!=e.__text||null!=e.__cdata?(b+=i(e,d,f,!1),b+=r(e),b+=j(e,d)):b+=i(e,d,f,!0)}else b+=i(e,d,f,!1),b+=p(e),b+=j(e,d)}return b+=p(a)}(null===b||void 0===b)&&(b="_"),(null===c||void 0===c)&&(c=!1);var s="1.0.11",t=!1,u={ELEMENT_NODE:1,TEXT_NODE:3,CDATA_SECTION_NODE:4,COMMENT_NODE:8,DOCUMENT_NODE:9};this.parseXmlString=function(a){var b;if(window.DOMParser){var c=new window.DOMParser;b=c.parseFromString(a,"text/xml")}else 0==a.indexOf("<?")&&(a=a.substr(a.indexOf("?>")+2)),b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a);return b},this.xml2json=function(a){return h(a)},this.xml_str2json=function(a){var b=this.parseXmlString(a);return this.xml2json(b)},this.json2xml_str=function(a){return r(a)},this.json2xml=function(a){var b=this.json2xml_str(a);return this.parseXmlString(b)},this.getVersion=function(){return s},this.escapeMode=function(a){t=a}}function ObjectIron(a){var b;for(b=[],i=0,len=a.length;len>i;i+=1)b.push(a[i].isRoot?"root":a[i].name);var c=function(a,b){var c;if(null!==a&&null!==b)for(c in a)a.hasOwnProperty(c)&&(b.hasOwnProperty(c)||(b[c]=a[c]))},d=function(a,b,d){var e,f,g,h,i;if(null!==a&&0!==a.length)for(e=0,f=a.length;f>e;e+=1)g=a[e],b.hasOwnProperty(g.name)&&(d.hasOwnProperty(g.name)?g.merge&&(h=b[g.name],i=d[g.name],"object"==typeof h&&"object"==typeof i?c(h,i):d[g.name]=null!=g.mergeFunction?g.mergeFunction(h,i):h+i):d[g.name]=b[g.name])},e=function(a,b){var c,f,g,h,i,j,k,l=a;if(null!==l.children&&0!==l.children.length)for(c=0,f=l.children.length;f>c;c+=1)if(j=l.children[c],b.hasOwnProperty(j.name))if(j.isArray)for(i=b[j.name+"_asArray"],g=0,h=i.length;h>g;g+=1)k=i[g],d(l.properties,b,k),e(j,k);else k=b[j.name],d(l.properties,b,k),e(j,k)},f=function(c){var d,g,h,i,j,k,l;if(null===c)return c;if("object"!=typeof c)return c;for(d=0,g=b.length;g>d;d+=1)"root"===b[d]&&(j=a[d],k=c,e(j,k));for(i in c)if(c.hasOwnProperty(i)){if(h=b.indexOf(i),-1!==h)if(j=a[h],j.isArray)for(l=c[i+"_asArray"],d=0,g=l.length;g>d;d+=1)k=l[d],e(j,k);else k=c[i],e(j,k);f(c[i])}return c};return{run:f}}!function(a){var b={undHash:/_|-/,colons:/::/,words:/([A-Z]+)([A-Z][a-z])/g,lowUp:/([a-z\d])([A-Z])/g,dash:/([a-z\d])([A-Z])/g,replacer:/\{([^\}]+)\}/g,dot:/\./},c=function(a,b,c){return a[b]||c&&(a[b]={})},d=function(a){var b=typeof a;return b&&("function"==b||"object"==b)},e=function(e,f,g){var h,i,j,k=e?e.split(b.dot):[],l=k.length,m=a.isArray(f)?f:[f||window],n=0;if(0==l)return m[0];for(;h=m[n++];){for(j=0;l-1>j&&d(h);j++)h=c(h,k[j],g);if(d(h)&&(i=c(h,k[j],g),void 0!==i))return g===!1&&delete h[k[j]],i}},f=a.String=a.extend(a.String||{},{getObject:e,capitalize:function(a,b){return a.charAt(0).toUpperCase()+a.substr(1)},camelize:function(a){return a=f.classize(a),a.charAt(0).toLowerCase()+a.substr(1)},classize:function(a,c){for(var d=a.split(b.undHash),e=0;e<d.length;e++)d[e]=f.capitalize(d[e]);return d.join(c||"")},niceName:function(a){f.classize(parts[i]," ")},underscore:function(a){return a.replace(b.colons,"/").replace(b.words,"$1_$2").replace(b.lowUp,"$1_$2").replace(b.dash,"_").toLowerCase()},sub:function(a,c,d){var f=[];return f.push(a.replace(b.replacer,function(a,b){var g=e(b,c,"boolean"==typeof d?!d:d),h=typeof g;return"object"!==h&&"function"!==h||null===h?""+g:(f.push(g),"")})),f.length<=1?f[0]:f}})}(jQuery),function(a){var b=!1,c=a.makeArray,d=a.isFunction,e=a.isArray,f=a.extend,g=function(a,b){return a.concat(c(b))},h=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/,i=function(a,b,c){c=c||a;for(var e in a)c[e]=d(a[e])&&d(b[e])&&h.test(a[e])?function(a,c){return function(){var d,e=this._super;return this._super=b[a],d=c.apply(this,arguments),this._super=e,d}}(e,a[e]):a[e]},j=a.Class=function(){arguments.length&&j.extend.apply(j,arguments)};f(j,{callback:function(a){var b,d=c(arguments);return a=d.shift(),e(a)||(a=[a]),b=this,function(){for(var c,f,h=g(d,arguments),i=a.length,j=0;i>j;j++)f=a[j],f&&(c="string"==typeof f,c&&b._set_called&&(b.called=f),h=(c?b[f]:f).apply(b,h||[]),i-1>j&&(h=!e(h)||h._use_call?[h]:h));return h}},getObject:a.String.getObject,newInstance:function(){var a,b=this.rawInstance();return b.setup&&(a=b.setup.apply(b,arguments)),b.init&&b.init.apply(b,e(a)?a:arguments),b},setup:function(a,b){return this.defaults=f(!0,{},a.defaults,this.defaults),arguments},rawInstance:function(){b=!0;var a=new this;return b=!1,a},extend:function(a,c,d){function e(){return b?void 0:this.constructor!==e&&arguments.length?arguments.callee.extend.apply(arguments.callee,arguments):this.Class.newInstance.apply(this.Class,arguments)}"string"!=typeof a&&(d=c,c=a,a=null),d||(d=c,c=null),d=d||{};var h,k,l,m,n=this,o=this.prototype;b=!0,m=new this,b=!1,i(d,o,m);for(h in this)this.hasOwnProperty(h)&&(e[h]=this[h]);if(i(c,this,e),a){var p=a.split(/\./),k=p.pop(),q=j.getObject(p.join("."),window,!0),l=q;q[k]=e}f(e,{prototype:m,namespace:l,shortName:k,constructor:e,fullName:a}),e.prototype.Class=e.prototype.constructor=e;var r=e.setup.apply(e,g([n],arguments));return e.init&&e.init.apply(e,r||[]),e}}),j.prototype.callback=j.callback}(jQuery),function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){"use strict";var b={},c=Math.max,d=Math.min;b.c={},b.c.d=a(document),b.c.t=function(a){return a.originalEvent.touches.length-1},b.o=function(){var c=this;this.o=null,this.$=null,this.i=null,this.g=null,this.v=null,this.cv=null,this.x=0,this.y=0,this.w=0,this.h=0,this.$c=null,this.c=null,this.t=0,this.isInit=!1,this.fgColor=null,this.pColor=null,this.dH=null,this.cH=null,this.eH=null,this.rH=null,this.scale=1,this.relative=!1,this.relativeWidth=!1,this.relativeHeight=!1,this.$div=null,this.run=function(){var b=function(a,b){var d;for(d in b)c.o[d]=b[d];c._carve().init(),c._configure()._draw()};if(!this.$.data("kontroled")){if(this.$.data("kontroled",!0),this.extend(),this.o=a.extend({min:void 0!==this.$.data("min")?this.$.data("min"):0,max:void 0!==this.$.data("max")?this.$.data("max"):100,stopper:!0,readOnly:this.$.data("readonly")||"readonly"===this.$.attr("readonly"),cursor:this.$.data("cursor")===!0&&30||this.$.data("cursor")||0,thickness:this.$.data("thickness")&&Math.max(Math.min(this.$.data("thickness"),1),.01)||.35,lineCap:this.$.data("linecap")||"butt",width:this.$.data("width")||200,height:this.$.data("height")||200,displayInput:null==this.$.data("displayinput")||this.$.data("displayinput"),displayPrevious:this.$.data("displayprevious"),fgColor:this.$.data("fgcolor")||"#87CEEB",inputColor:this.$.data("inputcolor"),font:this.$.data("font")||"Arial",fontWeight:this.$.data("font-weight")||"bold",inline:!1,step:this.$.data("step")||1,rotation:this.$.data("rotation"),draw:null,change:null,cancel:null,release:null,format:function(a){return a},parse:function(a){return parseFloat(a)}},this.o),this.o.flip="anticlockwise"===this.o.rotation||"acw"===this.o.rotation,this.o.inputColor||(this.o.inputColor=this.o.fgColor),this.$.is("fieldset")?(this.v={},this.i=this.$.find("input"),this.i.each(function(b){var d=a(this);c.i[b]=d,c.v[b]=c.o.parse(d.val()),d.bind("change blur",function(){var a={};a[b]=d.val(),c.val(a)})}),this.$.find("legend").remove()):(this.i=this.$,this.v=this.o.parse(this.$.val()),""===this.v&&(this.v=this.o.min),this.$.bind("change blur",function(){c.val(c._validate(c.o.parse(c.$.val())))})),!this.o.displayInput&&this.$.hide(),this.$c=a(document.createElement("canvas")).attr({width:this.o.width,height:this.o.height}),this.$div=a('<div style="'+(this.o.inline?"display:inline;":"")+"width:"+this.o.width+"px;height:"+this.o.height+'px;"></div>'),this.$.wrap(this.$div).before(this.$c),this.$div=this.$.parent(),"undefined"!=typeof G_vmlCanvasManager&&G_vmlCanvasManager.initElement(this.$c[0]),this.c=this.$c[0].getContext?this.$c[0].getContext("2d"):null,!this.c)throw{name:"CanvasNotSupportedException",message:"Canvas not supported. Please use excanvas on IE8.0.",toString:function(){return this.name+": "+this.message}};return this.scale=(window.devicePixelRatio||1)/(this.c.webkitBackingStorePixelRatio||this.c.mozBackingStorePixelRatio||this.c.msBackingStorePixelRatio||this.c.oBackingStorePixelRatio||this.c.backingStorePixelRatio||1),this.relativeWidth=this.o.width%1!==0&&this.o.width.indexOf("%"),this.relativeHeight=this.o.height%1!==0&&this.o.height.indexOf("%"),this.relative=this.relativeWidth||this.relativeHeight,this._carve(),this.v instanceof Object?(this.cv={},this.copy(this.v,this.cv)):this.cv=this.v,this.$.bind("configure",b).parent().bind("configure",b),this._listen()._configure()._xy().init(),this.isInit=!0,this.$.val(this.o.format(this.v)),this._draw(),this}},this._carve=function(){if(this.relative){var a=this.relativeWidth?this.$div.parent().width()*parseInt(this.o.width)/100:this.$div.parent().width(),b=this.relativeHeight?this.$div.parent().height()*parseInt(this.o.height)/100:this.$div.parent().height();this.w=this.h=Math.min(a,b)}else this.w=this.o.width,this.h=this.o.height;return this.$div.css({width:this.w+"px",height:this.h+"px"}),this.$c.attr({width:this.w,height:this.h}),1!==this.scale&&(this.$c[0].width=this.$c[0].width*this.scale,this.$c[0].height=this.$c[0].height*this.scale,this.$c.width(this.w),this.$c.height(this.h)),this},this._draw=function(){var a=!0;c.g=c.c,c.clear(),c.dH&&(a=c.dH()),a!==!1&&c.draw()},this._touch=function(a){var d=function(a){var b=c.xy2val(a.originalEvent.touches[c.t].pageX,a.originalEvent.touches[c.t].pageY);b!=c.cv&&(c.cH&&c.cH(b)===!1||(c.change(c._validate(b)),c._draw()))};return this.t=b.c.t(a),d(a),b.c.d.bind("touchmove.k",d).bind("touchend.k",function(){b.c.d.unbind("touchmove.k touchend.k"),c.val(c.cv)}),this},this._mouse=function(a){var d=function(a){var b=c.xy2val(a.pageX,a.pageY);b!=c.cv&&(c.cH&&c.cH(b)===!1||(c.change(c._validate(b)),c._draw()))};return d(a),b.c.d.bind("mousemove.k",d).bind("keyup.k",function(a){if(27===a.keyCode){if(b.c.d.unbind("mouseup.k mousemove.k keyup.k"),c.eH&&c.eH()===!1)return;c.cancel()}}).bind("mouseup.k",function(a){b.c.d.unbind("mousemove.k mouseup.k keyup.k"),c.val(c.cv)}),this},this._xy=function(){var a=this.$c.offset();return this.x=a.left,this.y=a.top,this},this._listen=function(){return this.o.readOnly?this.$.attr("readonly","readonly"):(this.$c.bind("mousedown",function(a){a.preventDefault(),c._xy()._mouse(a)}).bind("touchstart",function(a){a.preventDefault(),c._xy()._touch(a)}),this.listen()),this.relative&&a(window).resize(function(){c._carve().init(),c._draw()}),this},this._configure=function(){return this.o.draw&&(this.dH=this.o.draw),this.o.change&&(this.cH=this.o.change),this.o.cancel&&(this.eH=this.o.cancel),this.o.release&&(this.rH=this.o.release),this.o.displayPrevious?(this.pColor=this.h2rgba(this.o.fgColor,"0.4"),this.fgColor=this.h2rgba(this.o.fgColor,"0.6")):this.fgColor=this.o.fgColor,this},this._clear=function(){this.$c[0].width=this.$c[0].width},this._validate=function(a){return~~((0>a?-.5:.5)+a/this.o.step)*this.o.step},this.listen=function(){},this.extend=function(){},this.init=function(){},this.change=function(a){},this.val=function(a){},this.xy2val=function(a,b){},this.draw=function(){},this.clear=function(){this._clear()},this.h2rgba=function(a,b){var c;return a=a.substring(1,7),c=[parseInt(a.substring(0,2),16),parseInt(a.substring(2,4),16),parseInt(a.substring(4,6),16)],"rgba("+c[0]+","+c[1]+","+c[2]+","+b+")"},this.copy=function(a,b){for(var c in a)b[c]=a[c]}},b.Dial=function(){b.o.call(this),this.startAngle=null,this.xy=null,this.radius=null,this.lineWidth=null,this.cursorExt=null,this.w2=null,this.PI2=2*Math.PI,this.extend=function(){this.o=a.extend({bgColor:this.$.data("bgcolor")||"#EEEEEE",angleOffset:this.$.data("angleoffset")||0,angleArc:this.$.data("anglearc")||360,inline:!0},this.o)},this.val=function(a,b){return null==a?this.v:(a=this.o.parse(a),void(b!==!1&&a!=this.v&&this.rH&&this.rH(a)===!1||(this.cv=this.o.stopper?c(d(a,this.o.max),this.o.min):a,this.v=this.cv,this.$.val(this.o.format(this.v)),this._draw())))},this.xy2val=function(a,b){var e,f;return e=Math.atan2(a-(this.x+this.w2),-(b-this.y-this.w2))-this.angleOffset,this.o.flip&&(e=this.angleArc-e-this.PI2),this.angleArc!=this.PI2&&0>e&&e>-.5?e=0:0>e&&(e+=this.PI2),f=~~(.5+e*(this.o.max-this.o.min)/this.angleArc)+this.o.min,this.o.stopper&&(f=c(d(f,this.o.max),this.o.min)),f},this.listen=function(){var b,e,f,g,h=this,i=function(a){a.preventDefault();var f=a.originalEvent,g=f.detail||f.wheelDeltaX,i=f.detail||f.wheelDeltaY,j=h._validate(h.o.parse(h.$.val()))+(g>0||i>0?h.o.step:0>g||0>i?-h.o.step:0);j=c(d(j,h.o.max),h.o.min),h.val(j,!1),h.rH&&(clearTimeout(b),b=setTimeout(function(){h.rH(j),b=null},100),e||(e=setTimeout(function(){b&&h.rH(j),e=null},200)))},j=1,k={37:-h.o.step,38:h.o.step,39:h.o.step,40:-h.o.step};this.$.bind("keydown",function(b){var e=b.keyCode;if(e>=96&&105>=e&&(e=b.keyCode=e-48),f=parseInt(String.fromCharCode(e)),isNaN(f)&&(13!==e&&8!==e&&9!==e&&189!==e&&(190!==e||h.$.val().match(/\./))&&b.preventDefault(),a.inArray(e,[37,38,39,40])>-1)){b.preventDefault();var i=h.o.parse(h.$.val())+k[e]*j;h.o.stopper&&(i=c(d(i,h.o.max),h.o.min)),h.change(i),h._draw(),g=window.setTimeout(function(){j*=2},30)}}).bind("keyup",function(a){isNaN(f)?g&&(window.clearTimeout(g),g=null,j=1,h.val(h.$.val())):h.$.val()>h.o.max&&h.$.val(h.o.max)||h.$.val()<h.o.min&&h.$.val(h.o.min)}),this.$c.bind("mousewheel DOMMouseScroll",i),this.$.bind("mousewheel DOMMouseScroll",i)},this.init=function(){(this.v<this.o.min||this.v>this.o.max)&&(this.v=this.o.min),this.$.val(this.v),this.w2=this.w/2,this.cursorExt=this.o.cursor/100,this.xy=this.w2*this.scale,this.lineWidth=this.xy*this.o.thickness,this.lineCap=this.o.lineCap,this.radius=this.xy-this.lineWidth/2,this.o.angleOffset&&(this.o.angleOffset=isNaN(this.o.angleOffset)?0:this.o.angleOffset),this.o.angleArc&&(this.o.angleArc=isNaN(this.o.angleArc)?this.PI2:this.o.angleArc),this.angleOffset=this.o.angleOffset*Math.PI/180,this.angleArc=this.o.angleArc*Math.PI/180,this.startAngle=1.5*Math.PI+this.angleOffset,this.endAngle=1.5*Math.PI+this.angleOffset+this.angleArc;var a=c(String(Math.abs(this.o.max)).length,String(Math.abs(this.o.min)).length,2)+2;this.o.displayInput&&this.i.css({width:(this.w/2+4>>0)+"px",height:(this.w/3>>0)+"px",position:"absolute","vertical-align":"middle","margin-top":(this.w/3>>0)+"px","margin-left":"-"+(3*this.w/4+2>>0)+"px",border:0,background:"none",font:this.o.fontWeight+" "+(this.w/a>>0)+"px "+this.o.font,"text-align":"center",color:this.o.inputColor||this.o.fgColor,padding:"0px","-webkit-appearance":"none"})||this.i.css({width:"0px",visibility:"hidden"})},this.change=function(a){this.cv=a,this.$.val(this.o.format(a))},this.angle=function(a){return(a-this.o.min)*this.angleArc/(this.o.max-this.o.min)},this.arc=function(a){var b,c;return a=this.angle(a),this.o.flip?(b=this.endAngle+1e-5,c=b-a-1e-5):(b=this.startAngle-1e-5,c=b+a+1e-5),this.o.cursor&&(b=c-this.cursorExt)&&(c+=this.cursorExt),{s:b,e:c,d:this.o.flip&&!this.o.cursor}},this.draw=function(){var a,b=this.g,c=this.arc(this.cv),d=1;b.lineWidth=this.lineWidth,b.lineCap=this.lineCap,b.beginPath(),b.strokeStyle=this.o.bgColor,b.arc(this.xy,this.xy,this.radius,this.endAngle-1e-5,this.startAngle+1e-5,!0),b.stroke(),this.o.displayPrevious&&(a=this.arc(this.v),b.beginPath(),b.strokeStyle=this.pColor,b.arc(this.xy,this.xy,this.radius,a.s,a.e,a.d),b.stroke(),d=this.cv==this.v),b.beginPath(),b.strokeStyle=d?this.o.fgColor:this.fgColor,b.arc(this.xy,this.xy,this.radius,c.s,c.e,c.d),b.stroke()},this.cancel=function(){this.val(this.v)}},a.fn.dial=a.fn.knob=function(c){return this.each(function(){var d=new b.Dial;d.o=c,d.$=a(this),d.run()}).parent()}}),function(a){function b(a,b){if(!(a.originalEvent.touches.length>1)){a.preventDefault();var c=a.originalEvent.changedTouches[0],d=document.createEvent("MouseEvents");d.initMouseEvent(b,!0,!0,window,1,c.screenX,c.screenY,c.clientX,c.clientY,!1,!1,!1,!1,0,null),a.target.dispatchEvent(d)}}if(a.support.touch="ontouchend"in document,a.support.touch){var c,d=a.ui.mouse.prototype,e=d._mouseInit,f=d._mouseDestroy;d._touchStart=function(a){var d=this;!c&&d._mouseCapture(a.originalEvent.changedTouches[0])&&(c=!0,d._touchMoved=!1,b(a,"mouseover"),b(a,"mousemove"),b(a,"mousedown"))},d._touchMove=function(a){c&&(this._touchMoved=!0,b(a,"mousemove"))},d._touchEnd=function(a){c&&(b(a,"mouseup"),b(a,"mouseout"),this._touchMoved||b(a,"click"),c=!1)},d._mouseInit=function(){var b=this;b.element.bind({touchstart:a.proxy(b,"_touchStart"),touchmove:a.proxy(b,"_touchMove"),touchend:a.proxy(b,"_touchEnd")}),e.call(b)},d._mouseDestroy=function(){var b=this;b.element.unbind({touchstart:a.proxy(b,"_touchStart"),touchmove:a.proxy(b,"_touchMove"),touchend:a.proxy(b,"_touchEnd")}),f.call(b)}}}(jQuery),MediaPlayer=function(a){"use strict";var b,c,d,e,f,g,h,i,j,k,l,m="1.3.0 (refactor)",n=a,o=!1,p=!1,q=!0,r=!1,s=MediaPlayer.dependencies.BufferController.BUFFER_SIZE_REQUIRED,t=function(){return!!e&&!!f},u=function(){if(!o)throw"MediaPlayer not initialized!";if(!this.capabilities.supportsMediaSource())return void this.errHandler.capabilityError("mediasource");if(!e||!f)throw"Missing view or source.";p=!0,g=b.getObject("streamController"),g.subscribe(g.eventList.ENAME_STREAMS_COMPOSED,i),c.subscribe(c.eventList.ENAME_MANIFEST_LOADED,g),c.subscribe(c.eventList.ENAME_MANIFEST_LOADED,i),g.setVideoModel(l),g.setAutoPlay(q),g.load(f),b.mapValue("scheduleWhilePaused",r),b.mapOutlet("scheduleWhilePaused","stream"),b.mapOutlet("scheduleWhilePaused","scheduleController"),b.mapValue("bufferMax",s),b.mapOutlet("bufferMax","bufferController"),h.initialize()},v=function(){t()&&u.call(this)},w=function(){var a=k.getReadOnlyMetricsFor("video")||k.getReadOnlyMetricsFor("audio");return j.getCurrentDVRInfo(a)},x=function(){return w.call(this).manifestInfo.DVRWindowSize},y=function(a){var b=w.call(this),c=b.range.start+a;return c>b.range.end&&(c=b.range.end),c},z=function(a){l.getElement().currentTime=this.getDVRSeekOffset(a)},A=function(){var a=w.call(this);return null===a?0:this.duration()-(a.range.end-a.time)},B=function(){var a,b=w.call(this);return null===b?0:(a=b.range.end-b.range.start,a<b.manifestInfo.DVRWindowSize?a:b.manifestInfo.DVRWindowSize)},C=function(){var a,b,c=w.call(this);return null===c?0:(a=c.manifestInfo.availableFrom.getTime()/1e3,b=this.time()+(a+c.range.start))},D=function(){var a,b,c=w.call(this);return null===c?0:(a=c.manifestInfo.availableFrom.getTime()/1e3,b=a+c.range.start+this.duration())},E=function(a,b,c){var d=new Date(1e3*a),e=d.toLocaleDateString(b),f=d.toLocaleTimeString(b,{hour12:c});return f+" "+e},F=function(a){a=Math.max(a,0);var b=Math.floor(a/3600),c=Math.floor(a%3600/60),d=Math.floor(a%3600%60);return(0===b?"":10>b?"0"+b.toString()+":":b.toString()+":")+(10>c?"0"+c.toString():c.toString())+":"+(10>d?"0"+d.toString():d.toString())},G=function(a,b,c){b&&void 0!==a&&null!==a&&(c?h.setRules(a,b):h.addRules(a,b))},H=function(){p&&g&&(g.unsubscribe(g.eventList.ENAME_STREAMS_COMPOSED,i),c.unsubscribe(c.eventList.ENAME_MANIFEST_LOADED,g),c.unsubscribe(c.eventList.ENAME_MANIFEST_LOADED,i),g.reset(),d.reset(),h.reset(),g=null,p=!1)};return b=new dijon.System,b.mapValue("system",b),b.mapOutlet("system"),b.injectInto(n),{notifier:void 0,debug:void 0,eventBus:void 0,capabilities:void 0,adapter:void 0,errHandler:void 0,tokenAuthentication:void 0,uriQueryFragModel:void 0,videoElementExt:void 0,setup:function(){j=b.getObject("metricsExt"),c=b.getObject("manifestLoader"),i=b.getObject("manifestUpdater"),d=b.getObject("abrController"),h=b.getObject("rulesController"),k=b.getObject("metricsModel")},addEventListener:function(a,b,c){this.eventBus.addEventListener(a,b,c)},removeEventListener:function(a,b,c){this.eventBus.removeEventListener(a,b,c)},getVersion:function(){return m},startup:function(){o||(b.injectInto(this),o=!0)},getDebug:function(){return this.debug},getVideoModel:function(){return l},setAutoPlay:function(a){q=a},getAutoPlay:function(){return q},setScheduleWhilePaused:function(a){r=a},getScheduleWhilePaused:function(){return r},setTokenAuthentication:function(a,b){this.tokenAuthentication.setTokenAuthentication({name:a,type:b})},setBufferMax:function(a){s=a},getBufferMax:function(){return s},getMetricsExt:function(){return j},getMetricsFor:function(a){var b=k.getReadOnlyMetricsFor(a);return b},getQualityFor:function(a){return d.getQualityFor(a)},setQualityFor:function(a,b){d.setPlaybackQuality(a,b)},getAutoSwitchQuality:function(){return d.getAutoSwitchBitrate()},setAutoSwitchQuality:function(a){d.setAutoSwitchBitrate(a)},setSchedulingRules:function(a){G.call(this,h.SCHEDULING_RULE,a,!0)},addSchedulingRules:function(a){G.call(this,h.SCHEDULING_RULE,a,!1)},setABRRules:function(a){G.call(this,h.ABR_RULE,a,!0)},addABRRules:function(a){G.call(this,h.ABR_RULE,a,!1)},attachView:function(a){if(!o)throw"MediaPlayer not initialized!";e=a,l=null,e&&(l=b.getObject("videoModel"),l.setElement(e)),H.call(this),t.call(this)&&v.call(this)},attachSource:function(a){if(!o)throw"MediaPlayer not initialized!";this.uriQueryFragModel.reset(),f=this.uriQueryFragModel.parseURI(a),H.call(this),t.call(this)&&v.call(this)},reset:function(){this.attachSource(null),this.attachView(null)},play:u,isReady:t,seek:z,time:A,duration:B,timeAsUTC:C,durationAsUTC:D,getDVRWindowSize:x,getDVRSeekOffset:y,formatUTC:E,convertToTimeCode:F}},MediaPlayer.prototype={constructor:MediaPlayer},MediaPlayer.dependencies={},MediaPlayer.utils={},MediaPlayer.models={},MediaPlayer.vo={},MediaPlayer.vo.metrics={},MediaPlayer.rules={},MediaPlayer.di={},MediaPlayer.di.Context=function(){"use strict";return{system:void 0,setup:function(){this.system.autoMapOutlets=!0,this.system.mapSingleton("debug",MediaPlayer.utils.Debug),this.system.mapSingleton("tokenAuthentication",MediaPlayer.utils.TokenAuthentication),this.system.mapSingleton("eventBus",MediaPlayer.utils.EventBus),this.system.mapSingleton("capabilities",MediaPlayer.utils.Capabilities),this.system.mapSingleton("textTrackExtensions",MediaPlayer.utils.TextTrackExtensions),this.system.mapSingleton("vttParser",MediaPlayer.utils.VTTParser),this.system.mapSingleton("ttmlParser",MediaPlayer.utils.TTMLParser),this.system.mapClass("videoModel",MediaPlayer.models.VideoModel),this.system.mapSingleton("manifestModel",MediaPlayer.models.ManifestModel),this.system.mapSingleton("metricsModel",MediaPlayer.models.MetricsModel),this.system.mapSingleton("uriQueryFragModel",MediaPlayer.models.URIQueryAndFragmentModel),this.system.mapClass("protectionModel",MediaPlayer.models.ProtectionModel),this.system.mapSingleton("textSourceBuffer",MediaPlayer.dependencies.TextSourceBuffer),this.system.mapSingleton("mediaSourceExt",MediaPlayer.dependencies.MediaSourceExtensions),this.system.mapSingleton("sourceBufferExt",MediaPlayer.dependencies.SourceBufferExtensions),this.system.mapSingleton("abrController",MediaPlayer.dependencies.AbrController),this.system.mapSingleton("errHandler",MediaPlayer.dependencies.ErrorHandler),this.system.mapSingleton("protectionExt",MediaPlayer.dependencies.ProtectionExtensions),this.system.mapSingleton("videoExt",MediaPlayer.dependencies.VideoModelExtensions),this.system.mapClass("protectionController",MediaPlayer.dependencies.ProtectionController),this.system.mapClass("playbackController",MediaPlayer.dependencies.PlaybackController),this.system.mapSingleton("liveEdgeFinder",MediaPlayer.dependencies.LiveEdgeFinder),this.system.mapClass("metrics",MediaPlayer.models.MetricsList),this.system.mapClass("downloadRatioRule",MediaPlayer.rules.DownloadRatioRule),this.system.mapClass("insufficientBufferRule",MediaPlayer.rules.InsufficientBufferRule),this.system.mapClass("limitSwitchesRule",MediaPlayer.rules.LimitSwitchesRule),this.system.mapSingleton("abrRulesCollection",MediaPlayer.rules.ABRRulesCollection),this.system.mapSingleton("rulesController",MediaPlayer.rules.RulesController),this.system.mapClass("liveEdgeBinarySearchRule",MediaPlayer.rules.LiveEdgeBinarySearchRule),this.system.mapClass("bufferLevelRule",MediaPlayer.rules.BufferLevelRule),this.system.mapClass("pendingRequestsRule",MediaPlayer.rules.PendingRequestsRule),this.system.mapClass("playbackTimeRule",MediaPlayer.rules.PlaybackTimeRule),this.system.mapClass("sameTimeRequestRule",MediaPlayer.rules.SameTimeRequestRule),this.system.mapSingleton("scheduleRulesCollection",MediaPlayer.rules.ScheduleRulesCollection),this.system.mapClass("streamProcessor",MediaPlayer.dependencies.StreamProcessor),this.system.mapClass("eventController",MediaPlayer.dependencies.EventController),this.system.mapClass("textController",MediaPlayer.dependencies.TextController),this.system.mapClass("bufferController",MediaPlayer.dependencies.BufferController),this.system.mapSingleton("manifestLoader",MediaPlayer.dependencies.ManifestLoader),this.system.mapSingleton("manifestUpdater",MediaPlayer.dependencies.ManifestUpdater),this.system.mapClass("fragmentController",MediaPlayer.dependencies.FragmentController),this.system.mapClass("fragmentLoader",MediaPlayer.dependencies.FragmentLoader),this.system.mapClass("fragmentModel",MediaPlayer.dependencies.FragmentModel),this.system.mapSingleton("streamController",MediaPlayer.dependencies.StreamController),this.system.mapClass("stream",MediaPlayer.dependencies.Stream),this.system.mapClass("scheduleController",MediaPlayer.dependencies.ScheduleController),this.system.mapSingleton("notifier",MediaPlayer.dependencies.Notifier)}}},Dash=function(){"use strict";return{modules:{},dependencies:{},vo:{},di:{}}}(),Dash.di.DashContext=function(){"use strict";return{system:void 0,setup:function(){Dash.di.DashContext.prototype.setup.call(this),this.system.mapClass("parser",Dash.dependencies.DashParser),this.system.mapClass("indexHandler",Dash.dependencies.DashHandler),this.system.mapSingleton("baseURLExt",Dash.dependencies.BaseURLExtensions),this.system.mapClass("fragmentExt",Dash.dependencies.FragmentExtensions),this.system.mapClass("trackController",Dash.dependencies.RepresentationController),this.system.mapSingleton("manifestExt",Dash.dependencies.DashManifestExtensions),this.system.mapSingleton("metricsExt",Dash.dependencies.DashMetricsExtensions),this.system.mapSingleton("timelineConverter",Dash.dependencies.TimelineConverter),this.system.mapSingleton("adapter",Dash.dependencies.DashAdapter)}}},Dash.di.DashContext.prototype=new MediaPlayer.di.Context,Dash.di.DashContext.prototype.constructor=Dash.di.DashContext,function(a){"use strict";var b={VERSION:"0.5.3"};b.System=function(){this._mappings={},this._outlets={},this._handlers={},this.strictInjections=!0,this.autoMapOutlets=!1,this.postInjectionHook="setup"},b.System.prototype={_createAndSetupInstance:function(a,b){var c=new b;return this.injectInto(c,a),c},_retrieveFromCacheOrCreate:function(a,b){"undefined"==typeof b&&(b=!1);var c;if(!this._mappings.hasOwnProperty(a))throw new Error(1e3);var d=this._mappings[a];return!b&&d.isSingleton?(null==d.object&&(d.object=this._createAndSetupInstance(a,d.clazz)),c=d.object):c=d.clazz?this._createAndSetupInstance(a,d.clazz):d.object,c},mapOutlet:function(a,b,c){if("undefined"==typeof a)throw new Error(1010);return b=b||"global",c=c||a,this._outlets.hasOwnProperty(b)||(this._outlets[b]={}),this._outlets[b][c]=a,this},getObject:function(a){if("undefined"==typeof a)throw new Error(1020);return this._retrieveFromCacheOrCreate(a)},mapValue:function(a,b){if("undefined"==typeof a)throw new Error(1030);return this._mappings[a]={clazz:null,object:b,isSingleton:!0},this.autoMapOutlets&&this.mapOutlet(a),this.hasMapping(a)&&this.injectInto(b,a),this},hasMapping:function(a){if("undefined"==typeof a)throw new Error(1040);return this._mappings.hasOwnProperty(a)},mapClass:function(a,b){if("undefined"==typeof a)throw new Error(1050);if("undefined"==typeof b)throw new Error(1051);return this._mappings[a]={clazz:b,object:null,isSingleton:!1},this.autoMapOutlets&&this.mapOutlet(a),this},mapSingleton:function(a,b){if("undefined"==typeof a)throw new Error(1060);if("undefined"==typeof b)throw new Error(1061);return this._mappings[a]={clazz:b,object:null,isSingleton:!0},this.autoMapOutlets&&this.mapOutlet(a),this},instantiate:function(a){if("undefined"==typeof a)throw new Error(1070);return this._retrieveFromCacheOrCreate(a,!0)},injectInto:function(a,b){if("undefined"==typeof a)throw new Error(1080);if("object"==typeof a){var c=[];this._outlets.hasOwnProperty("global")&&c.push(this._outlets.global),"undefined"!=typeof b&&this._outlets.hasOwnProperty(b)&&c.push(this._outlets[b]);for(var d in c){var e=c[d];for(var f in e){var g=e[f];(!this.strictInjections||f in a)&&(a[f]=this.getObject(g))}}"setup"in a&&a.setup.call(a)}return this},unmap:function(a){if("undefined"==typeof a)throw new Error(1090);return delete this._mappings[a],this},unmapOutlet:function(a,b){if("undefined"==typeof a)throw new Error(1100);if("undefined"==typeof b)throw new Error(1101);return delete this._outlets[a][b],this},mapHandler:function(a,b,c,d,e){if("undefined"==typeof a)throw new Error(1110);return b=b||"global",c=c||a,
"undefined"==typeof d&&(d=!1),"undefined"==typeof e&&(e=!1),this._handlers.hasOwnProperty(a)||(this._handlers[a]={}),this._handlers[a].hasOwnProperty(b)||(this._handlers[a][b]=[]),this._handlers[a][b].push({handler:c,oneShot:d,passEvent:e}),this},unmapHandler:function(a,b,c){if("undefined"==typeof a)throw new Error(1120);if(b=b||"global",c=c||a,this._handlers.hasOwnProperty(a)&&this._handlers[a].hasOwnProperty(b)){var d=this._handlers[a][b];for(var e in d){var f=d[e];if(f.handler===c){d.splice(e,1);break}}}return this},notify:function(a){if("undefined"==typeof a)throw new Error(1130);var b=Array.prototype.slice.call(arguments),c=b.slice(1);if(this._handlers.hasOwnProperty(a)){var d=this._handlers[a];for(var e in d){var f,g=d[e];"global"!==e&&(f=this.getObject(e));var h,i,j=[];for(h=0,i=g.length;i>h;h++){var k,l=g[h];k=f&&"string"==typeof l.handler?f[l.handler]:l.handler,l.oneShot&&j.unshift(h),l.passEvent?k.apply(f,b):k.apply(f,c)}for(h=0,i=j.length;i>h;h++)g.splice(j[h],1)}}return this}},a.dijon=b}(this),Dash.dependencies.BaseURLExtensions=function(){"use strict";var a=function(a,b){for(var c,d,e,f,g,h,i,j,k,l,m=new DataView(a),n={},o=0;"sidx"!==j&&o<m.byteLength;){for(k=m.getUint32(o),o+=4,j="",f=0;4>f;f+=1)l=m.getInt8(o),j+=String.fromCharCode(l),o+=1;"moof"!==j&&"traf"!==j&&"sidx"!==j?o+=k-8:"sidx"===j&&(o-=8)}if(e=m.getUint32(o,!1)+o,e>a.byteLength)throw"sidx terminates after array buffer";for(n.version=m.getUint8(o+8),o+=12,n.timescale=m.getUint32(o+4,!1),o+=8,0===n.version?(n.earliest_presentation_time=m.getUint32(o,!1),n.first_offset=m.getUint32(o+4,!1),o+=8):(n.earliest_presentation_time=utils.Math.to64BitNumber(m.getUint32(o+4,!1),m.getUint32(o,!1)),n.first_offset=(m.getUint32(o+8,!1)<<32)+m.getUint32(o+12,!1),o+=16),n.first_offset+=e+(b||0),n.reference_count=m.getUint16(o+2,!1),o+=4,n.references=[],c=n.first_offset,d=n.earliest_presentation_time,f=0;f<n.reference_count;f+=1)h=m.getUint32(o,!1),g=h>>>31,h=2147483647&h,i=m.getUint32(o+4,!1),o+=12,n.references.push({size:h,type:g,offset:c,duration:i,time:d,timescale:n.timescale}),c+=h,d+=i;if(o!==e)throw"Error: final pos "+o+" differs from SIDX end "+e;return n},b=function(b,c,d){var e,f,g,h,i,j,k,l;for(e=a.call(this,b,d),f=e.references,g=[],i=0,j=f.length;j>i;i+=1)h=new Dash.vo.Segment,h.duration=f[i].duration,h.media=c,h.startTime=f[i].time,h.timescale=f[i].timescale,k=f[i].offset,l=f[i].offset+f[i].size-1,h.mediaRange=k+"-"+l,g.push(h);return this.debug.log("Parsed SIDX box: "+g.length+" segments."),g},c=function(a,b,d){var e,f,g,h,i,j,k,l,m,n=new DataView(a),o=0,p="",q=0,r=!1,s=this;for(s.debug.log("Searching for initialization.");"moov"!==p&&o<n.byteLength;){for(q=n.getUint32(o),o+=4,p="",j=0;4>j;j+=1)k=n.getInt8(o),p+=String.fromCharCode(k),o+=1;"ftyp"===p&&(e=o-8),"moov"===p&&(f=o-8),"moov"!==p&&(o+=q-8)}i=n.byteLength-o,"moov"!==p?(s.debug.log("Loading more bytes to find initialization."),b.range.start=0,b.range.end=b.bytesLoaded+b.bytesToLoad,l=new XMLHttpRequest,l.onloadend=function(){r||d.call(s,null,new Error("Error loading initialization."))},l.onload=function(){r=!0,b.bytesLoaded=b.range.end,c.call(s,l.response,function(a){d.call(s,a)})},l.onerror=function(){d.call(s,null,new Error("Error loading initialization."))},l.open("GET",s.tokenAuthentication.addTokenAsQueryArg(b.url)),l.responseType="arraybuffer",l.setRequestHeader("Range","bytes="+b.range.start+"-"+b.range.end),l=s.tokenAuthentication.setTokenInRequestHeader(l),l.send(null)):(g=void 0===e?f:e,h=f+q-1,m=g+"-"+h,s.debug.log("Found the initialization.  Range: "+m),d.call(s,m))},d=function(a){var b=new XMLHttpRequest,d=!0,e=this,f=a.adaptation.period.mpd.manifest.Period_asArray[a.adaptation.period.index].AdaptationSet_asArray[a.adaptation.index].Representation_asArray[a.index].BaseURL,g={url:f,range:{},searching:!1,bytesLoaded:0,bytesToLoad:1500,request:b};e.debug.log("Start searching for initialization."),g.range.start=0,g.range.end=g.bytesToLoad,b.onload=function(){b.status<200||b.status>299||(d=!1,g.bytesLoaded=g.range.end,c.call(e,b.response,g,function(b){a.range=b,a.initialization=f,e.notify(e.eventList.ENAME_INITIALIZATION_LOADED,a)}))},b.onloadend=b.onerror=function(){d&&(d=!1,e.errHandler.downloadError("initialization",g.url,b),e.notify(e.eventList.ENAME_INITIALIZATION_LOADED,a))},b.open("GET",e.tokenAuthentication.addTokenAsQueryArg(g.url)),b.responseType="arraybuffer",b.setRequestHeader("Range","bytes="+g.range.start+"-"+g.range.end),b=e.tokenAuthentication.setTokenInRequestHeader(b),b.send(null),e.debug.log("Perform init search: "+g.url)},e=function(a,c,d,g){var h,i,j,k,l,m,n,o,p,q=new DataView(a),r=new XMLHttpRequest,s=0,t="",u=0,v=!0,w=!1,x=this;for(x.debug.log("Searching for SIDX box."),x.debug.log(c.bytesLoaded+" bytes loaded.");"sidx"!==t&&s<q.byteLength;){for(u=q.getUint32(s),s+=4,t="",m=0;4>m;m+=1)n=q.getInt8(s),t+=String.fromCharCode(n),s+=1;"sidx"!==t&&(s+=u-8)}if(i=q.byteLength-s,"sidx"!==t)g.call(x);else if(u-8>i)x.debug.log("Found SIDX but we don't have all of it."),c.range.start=0,c.range.end=c.bytesLoaded+(u-i),r.onload=function(){r.status<200||r.status>299||(v=!1,c.bytesLoaded=c.range.end,e.call(x,r.response,c,d,g))},r.onloadend=r.onerror=function(){v&&(v=!1,x.errHandler.downloadError("SIDX",c.url,r),g.call(x))},r.open("GET",x.tokenAuthentication.addTokenAsQueryArg(c.url)),r.responseType="arraybuffer",r.setRequestHeader("Range","bytes="+c.range.start+"-"+c.range.end),r=x.tokenAuthentication.setTokenInRequestHeader(r),r.send(null);else if(c.range.start=s-8,c.range.end=c.range.start+u,x.debug.log("Found the SIDX box.  Start: "+c.range.start+" | End: "+c.range.end),j=new ArrayBuffer(c.range.end-c.range.start),l=new Uint8Array(j),k=new Uint8Array(a,c.range.start,c.range.end-c.range.start),l.set(k),o=this.parseSIDX.call(this,j,c.range.start),p=o.references,null!==p&&void 0!==p&&p.length>0&&(w=1===p[0].type),w){x.debug.log("Initiate multiple SIDX load.");var y,z,A,B,C,D=[],E=0,F=function(a){a?(D=D.concat(a),E+=1,E>=z&&g.call(x,D)):g.call(x)};for(y=0,z=p.length;z>y;y+=1)A=p[y].offset,B=p[y].offset+p[y].size-1,C=A+"-"+B,f.call(x,d,null,C,F)}else x.debug.log("Parsing segments from SIDX."),h=b.call(x,j,c.url,c.range.start),g.call(x,h)},f=function(a,c,d,f){var g,h,i=new XMLHttpRequest,j=a.adaptation.period.mpd.manifest.Period_asArray[a.adaptation.period.index].AdaptationSet_asArray[a.adaptation.index].Representation_asArray[a.index].BaseURL,k=!0,l=this,m={url:j,range:{},searching:!1,bytesLoaded:0,bytesToLoad:1500,request:i};null===d?(l.debug.log("No known range for SIDX request."),m.searching=!0,m.range.start=0,m.range.end=m.bytesToLoad):(h=d.split("-"),m.range.start=parseFloat(h[0]),m.range.end=parseFloat(h[1])),i.onload=function(){i.status<200||i.status>299||(k=!1,m.searching?(m.bytesLoaded=m.range.end,e.call(l,i.response,m,a,function(b){b&&f.call(l,b,a,c)})):(g=b.call(l,i.response,m.url,m.range.start),f.call(l,g,a,c)))},i.onloadend=i.onerror=function(){k&&(k=!1,l.errHandler.downloadError("SIDX",m.url,i),f.call(l,null,a,c))},i.open("GET",l.tokenAuthentication.addTokenAsQueryArg(m.url)),i.responseType="arraybuffer",i.setRequestHeader("Range","bytes="+m.range.start+"-"+m.range.end),i=l.tokenAuthentication.setTokenInRequestHeader(i),i.send(null),l.debug.log("Perform SIDX load: "+m.url)},g=function(a,b,c){var d=this;a?d.notify(d.eventList.ENAME_SEGMENTS_LOADED,a,b,c):d.notify(d.eventList.ENAME_SEGMENTS_LOADED,null,b,c,new Error("error loading segments"))};return{debug:void 0,errHandler:void 0,tokenAuthentication:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_INITIALIZATION_LOADED:"initializationLoaded",ENAME_SEGMENTS_LOADED:"segmentsLoaded"},loadSegments:function(a,b,c){f.call(this,a,b,c,g.bind(this))},loadInitialization:d,parseSegments:b,parseSIDX:a,findSIDX:e}},Dash.dependencies.BaseURLExtensions.prototype={constructor:Dash.dependencies.BaseURLExtensions},Dash.dependencies.DashAdapter=function(){"use strict";var a=[],b={},c=function(a,b){return b.getRepresentationForQuality(a.quality)},d=function(a){return b[a.streamInfo.id][a.index]},e=function(b){var c,d=a.length,e=0;for(e;d>e;e+=1)if(c=a[e],b.id===c.id)return c;return null},f=function(a){var b=new MediaPlayer.vo.TrackInfo,c=a.adaptation.period.mpd.manifest.Period_asArray[a.adaptation.period.index].AdaptationSet_asArray[a.adaptation.index],d=this.manifestExt.getRepresentationFor(a.index,c);return b.id=a.id,b.quality=a.index,b.bandwidth=this.manifestExt.getBandwidth(d),b.DVRWindow=a.segmentAvailabilityRange,b.fragmentDuration=a.segmentDuration||(a.segments&&a.segments.length>0?a.segments[0].duration:NaN),b.MSETimeOffset=a.MSETimeOffset,b.useCalculatedLiveEdgeTime=a.useCalculatedLiveEdgeTime,b.mediaInfo=g.call(this,a.adaptation),b},g=function(a){var b=new MediaPlayer.vo.MediaInfo,c=this,d=a.period.mpd.manifest.Period_asArray[a.period.index].AdaptationSet_asArray[a.index];return b.id=a.id,b.index=a.index,b.type=a.type,b.streamInfo=h.call(this,a.period),b.trackCount=this.manifestExt.getRepresentationCount(d),b.lang=this.manifestExt.getLanguageForAdaptation(d),b.codec=this.manifestExt.getCodec(d),b.mimeType=this.manifestExt.getMimeType(d),b.contentProtection=this.manifestExt.getContentProtectionData(d),b.contentProtection&&b.contentProtection.forEach(function(a){a.KID=c.manifestExt.getKID(a)}),b.isText=this.manifestExt.getIsTextTrack(b.mimeType),b},h=function(a){var b=new MediaPlayer.vo.StreamInfo;return b.id=a.id,b.index=a.index,b.start=a.start,b.duration=a.duration,b.manifestInfo=i.call(this,a.mpd),b},i=function(a){var b=new MediaPlayer.vo.ManifestInfo,c=this.manifestModel.getValue();return b.DVRWindowSize=a.timeShiftBufferDepth,b.loadedTime=a.manifest.loadedTime,b.availableFrom=a.availabilityStartTime,b.minBufferTime=a.manifest.minBufferTime,b.maxFragmentDuration=a.maxSegmentDuration,b.duration=this.manifestExt.getDuration(c),b.isDynamic=this.manifestExt.getIsDynamic(c),b},j=function(a,c,d){var f,h=e(c),i=h.id,j=this.manifestExt.getAdaptationForType(a,c.index,d);return j?(f=this.manifestExt.getIndexForAdaptation(j,a,c.index),b[i]=b[i]||this.manifestExt.getAdaptationsForPeriod(a,h),g.call(this,b[i][f])):null},k=function(c){var d,e,f,g=[];if(!c)return null;for(d=this.manifestExt.getMpd(c),a=this.manifestExt.getRegularPeriods(c,d),b={},e=a.length,f=0;e>f;f+=1)g.push(h.call(this,a[f]));return g},l=function(a){var b=this.manifestExt.getMpd(a);return i.call(this,b)},m=function(a,b){var c=a.trackController.getRepresentationForQuality(b);return a.indexHandler.getInitRequest(c)},n=function(a,b){var d=c(b,a.trackController);return a.indexHandler.getNextSegmentRequest(d)},o=function(a,b,d,e){var f=c(b,a.trackController);return a.indexHandler.getSegmentRequestForTime(f,d,e)},p=function(a,b,d){var e=c(b,a.trackController),f=a.indexHandler.generateSegmentRequestForTime(e,d);return f},q=function(a){return a.indexHandler.getCurrentTime()},r=function(a,b){return a.indexHandler.setCurrentTime(b)},s=function(a){var b,c,f=e(a.getStreamInfo()),g=a.getMediaInfo(),h=d(g),i=this.manifestModel.getValue(),j=a.getType();b=g.id,c=b?this.manifestExt.getAdaptationForId(b,i,f.index):this.manifestExt.getAdaptationForIndex(g.index,i,f.index),a.setMediaInfo(g),a.trackController.updateData(c,h,j)},t=function(a,b){var c=a.getRepresentationForQuality(b);return c?f.call(this,c):null},u=function(a){var b=a.getCurrentRepresentation();return b?f.call(this,b):null},v=function(a,b,c){var d=new Dash.vo.Event,e=a[0],f=a[1],g=a[2],h=a[3],i=a[4],j=a[5],k=a[6],l=c*g+h;return b[e]?(d.eventStream=b[e],d.eventStream.value=f,d.eventStream.timescale=g,d.duration=i,d.id=j,d.presentationTime=l,d.messageData=k,d.presentationTimeDelta=h,d):null},w=function(a,b){var f=this.manifestModel.getValue(),g=[];return a instanceof MediaPlayer.vo.StreamInfo?g=this.manifestExt.getEventsForPeriod(f,e(a)):a instanceof MediaPlayer.vo.MediaInfo?g=this.manifestExt.getEventStreamForAdaptationSet(f,d(a)):a instanceof MediaPlayer.vo.TrackInfo&&(g=this.manifestExt.getEventStreamForRepresentation(f,c(a,b.trackController))),g};return{system:void 0,manifestExt:void 0,manifestModel:void 0,timelineConverter:void 0,metricsList:{TCP_CONNECTION:"TcpConnection",HTTP_REQUEST:"HttpRequest",HTTP_REQUEST_TRACE:"HttpRequestTrace",TRACK_SWITCH:"RepresentationSwitch",BUFFER_LEVEL:"BufferLevel",DVR_INFO:"DVRInfo",DROPPED_FRAMES:"DroppedFrames",SCHEDULING_INFO:"SchedulingInfo",MANIFEST_UPDATE:"ManifestUpdate",MANIFEST_UPDATE_STREAM_INFO:"ManifestUpdatePeriodInfo",MANIFEST_UPDATE_TRACK_INFO:"ManifestUpdateRepresentationInfo",PLAY_LIST:"PlayList",PLAY_LIST_TRACE:"PlayListTrace"},convertDataToTrack:f,convertDataToMedia:g,convertDataToStream:h,getDataForTrack:c,getDataForMedia:d,getDataForStream:e,getStreamsInfo:k,getManifestInfo:l,getMediaInfoForType:j,getCurrentTrackInfo:u,getTrackInfoForQuality:t,updateData:s,getInitRequest:m,getNextFragmentRequest:n,getFragmentRequestForTime:o,generateFragmentRequestForTime:p,getIndexHandlerTime:q,setIndexHandlerTime:r,getEventsFor:w,getEvent:v,reset:function(){a=[],b={}}}},Dash.dependencies.DashAdapter.prototype={constructor:Dash.dependencies.DashAdapter},Dash.dependencies.DashHandler=function(){"use strict";var a,b,c,d=-1,e=0,f=function(a,b){for(;a.length<b;)a="0"+a;return a},g=function(a,b,c){for(var d,e,g,h,i=0,j=0,k=b.length,l="%0",m=l.length;;){if(i=a.indexOf("$"+b),0>i)return a;if(j=a.indexOf("$",i+k),0>j)return a;if(d=a.indexOf(l,i+k),d>i&&j>d)switch(e=a.charAt(j-1),g=parseInt(a.substring(d+m,j-1),10),e){case"d":case"i":case"u":h=f(c.toString(),g);break;case"x":h=f(c.toString(16),g);break;case"X":h=f(c.toString(16),g).toUpperCase();break;case"o":h=f(c.toString(8),g);break;default:return this.debug.log("Unsupported/invalid IEEE 1003.1 format identifier string in URL"),a}else h=c;a=a.substring(0,i)+h+a.substring(j+1)}},h=function(a){return a.split("$$").join("$")},i=function(a,b){if(null===b||-1===a.indexOf("$RepresentationID$"))return a;var c=b.toString();return a.split("$RepresentationID$").join(c)},j=function(a,b){return a.representation.startNumber+b},k=function(a,b){var c,d=b.adaptation.period.mpd.manifest.Period_asArray[b.adaptation.period.index].AdaptationSet_asArray[b.adaptation.index].Representation_asArray[b.index].BaseURL;return c=a===d?a:-1!==a.indexOf("http://")?a:d+a},l=function(a,c){var d,e,f=this,g=new MediaPlayer.vo.FragmentRequest;return d=a.adaptation.period,g.mediaType=c,g.type="Initialization Segment",g.url=k(a.initialization,a),g.range=a.range,e=d.start,g.availabilityStartTime=f.timelineConverter.calcAvailabilityStartTimeFromPresentationTime(e,a.adaptation.period.mpd,b),g.availabilityEndTime=f.timelineConverter.calcAvailabilityEndTimeFromPresentationTime(e+d.duration,d.mpd,b),g.quality=a.index,g},m=function(a){var b,d=this;return a?b=l.call(d,a,c):null},n=function(a){var c,e,f,g=a.adaptation.period,h=!1;return b?h=!1:0>d?h=!1:d<a.availableSegmentsNumber?(e=A(d,a),e&&(f=e.presentationStartTime-g.start,c=a.adaptation.period.duration,this.debug.log(a.segmentInfoType+": "+f+" / "+c),h=f>=c)):h=!0,h},o=function(a,c){var d,e,f,g,h=this;return e=a.segmentDuration,f=a.adaptation.period.start+c*e,g=f+e,d=new Dash.vo.Segment,d.representation=a,d.duration=e,d.presentationStartTime=f,d.mediaStartTime=h.timelineConverter.calcMediaTimeFromPresentationTime(d.presentationStartTime,a),d.availabilityStartTime=h.timelineConverter.calcAvailabilityStartTimeFromPresentationTime(d.presentationStartTime,a.adaptation.period.mpd,b),d.availabilityEndTime=h.timelineConverter.calcAvailabilityEndTimeFromPresentationTime(g,a.adaptation.period.mpd,b),d.wallStartTime=h.timelineConverter.calcWallTimeForSegment(d,b),d.replacementNumber=j(d,c),d.availabilityIdx=c,d},p=function(b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q=this,r=b.adaptation.period.mpd.manifest.Period_asArray[b.adaptation.period.index].AdaptationSet_asArray[b.adaptation.index].Representation_asArray[b.index].SegmentTemplate,u=r.SegmentTimeline,v=b.availableSegmentsNumber>0,w=10,x=[],y=0,z=0,A=-1,B=function(a){return t.call(q,b,y,a.d,p,r.media,a.mediaRange,A)};for(p=b.timescale,c=u.S_asArray,k=s.call(q,b),k?(n=k.start,o=k.end):m=q.timelineConverter.calcMediaTimeFromPresentationTime(a||0,b),e=0,f=c.length;f>e;e+=1)if(d=c[e],h=0,d.hasOwnProperty("r")&&(h=d.r),d.hasOwnProperty("t")&&(y=d.t,z=y/p),0>h&&(j=c[e+1],j&&j.hasOwnProperty("t")?i=j.t/p:(i=q.timelineConverter.calcMediaTimeFromPresentationTime(b.segmentAvailabilityRange.end,b),b.segmentDuration=d.d/p),h=Math.ceil((i-z)/(d.d/p))-1),l){if(v)break;A+=h+1}else for(g=0;h>=g;g+=1){if(A+=1,k){if(A>o){if(l=!0,v)break;continue}A>=n&&x.push(B.call(q,d))}else{if(x.length>w){if(l=!0,v)break;continue}z>=m-d.d/p&&x.push(B.call(q,d))}y+=d.d,z=y/p}if(!v){var C,D,E=c[0];C=void 0===E.t?0:q.timelineConverter.calcPresentationTimeFromMediaTime(E.t/p,b),D=q.timelineConverter.calcPresentationTimeFromMediaTime((y-d.d)/p,b),b.segmentAvailabilityRange={start:C,end:D},b.availableSegmentsNumber=A+1}return x},q=function(a){var b,c,d,e,f,h=[],i=this,j=a.adaptation.period.mpd.manifest.Period_asArray[a.adaptation.period.index].AdaptationSet_asArray[a.adaptation.index].Representation_asArray[a.index].SegmentTemplate,k=a.segmentDuration,l=a.segmentAvailabilityRange,m=null,n=null;for(f=a.startNumber,b=r.call(i,a),d=b.start,e=b.end,c=d;e>=c;c+=1)m=o.call(i,a,c),m.replacementTime=(f+c-1)*a.segmentDuration,n=j.media,n=g(n,"Number",m.replacementNumber),n=g(n,"Time",m.replacementTime),m.media=n,h.push(m),m=null;return a.availableSegmentsNumber=Math.ceil((l.end-l.start)/k),h},r=function(c){var e,f,g,h=this,i=c.segmentDuration,j=c.adaptation.period.mpd.manifest.minBufferTime,k=c.segmentAvailabilityRange,l={start:h.timelineConverter.calcPeriodRelativeTimeFromMpdRelativeTime(c,k.start),end:h.timelineConverter.calcPeriodRelativeTimeFromMpdRelativeTime(c,k.end)},m=NaN,n=null,o=c.segments,p=2*i,q=Math.max(2*j,10*i);return l||(l=h.timelineConverter.calcSegmentAvailabilityRange(c,b)),b&&!h.timelineConverter.isTimeSyncCompleted()?(e=Math.floor(l.start/i),f=Math.floor(l.end/i),g={start:e,end:f}):(o?(n=A(d,c),m=n?h.timelineConverter.calcPeriodRelativeTimeFromMpdRelativeTime(c,n.presentationStartTime):d>0?d*i:h.timelineConverter.calcPeriodRelativeTimeFromMpdRelativeTime(c,a||o[0].presentationStartTime)):m=d>0?d*i:b?l.end:l.start,e=Math.floor(Math.max(m-p,l.start)/i),f=Math.floor(Math.min(e+q/i,l.end/i)),g={start:e,end:f})},s=function(){var c,e,f,g=2,h=10,i=0,j=Number.POSITIVE_INFINITY;return b&&!this.timelineConverter.isTimeSyncCompleted()?f={start:i,end:j}:!b&&a||0>d?null:(c=Math.max(d-g,i),e=Math.min(d+h,j),f={start:c,end:e})},t=function(a,c,d,e,f,h,i){var k,l,m,n=this,o=c/e,p=Math.min(d/e,a.adaptation.period.mpd.maxSegmentDuration);return k=n.timelineConverter.calcPresentationTimeFromMediaTime(o,a),l=k+p,m=new Dash.vo.Segment,m.representation=a,m.duration=p,m.mediaStartTime=o,m.presentationStartTime=k,m.availabilityStartTime=a.adaptation.period.mpd.manifest.loadedTime,m.availabilityEndTime=n.timelineConverter.calcAvailabilityEndTimeFromPresentationTime(l,a.adaptation.period.mpd,b),m.wallStartTime=n.timelineConverter.calcWallTimeForSegment(m,b),m.replacementTime=c,m.replacementNumber=j(m,i),f=g(f,"Number",m.replacementNumber),f=g(f,"Time",m.replacementTime),m.media=f,m.mediaRange=h,m.availabilityIdx=i,m},u=function(a){var b,c,d,e,f,g,h,i=this,j=[],k=a.adaptation.period.mpd.manifest.Period_asArray[a.adaptation.period.index].AdaptationSet_asArray[a.adaptation.index].Representation_asArray[a.index].SegmentList,l=k.SegmentURL_asArray.length;for(h=a.startNumber,e=r.call(i,a),f=Math.max(e.start,0),g=Math.min(e.end,k.SegmentURL_asArray.length-1),b=f;g>=b;b+=1)d=k.SegmentURL_asArray[b],c=o.call(i,a,b),c.replacementTime=(h+b-1)*a.segmentDuration,c.media=d.media,c.mediaRange=d.mediaRange,c.index=d.index,c.indexRange=d.indexRange,j.push(c),c=null;return a.availableSegmentsNumber=l,j},v=function(a){var b,c=this,d=a.segmentInfoType;return"SegmentBase"!==d&&"BaseURL"!==d&&B.call(c,a)?("SegmentTimeline"===d?b=p.call(c,a):"SegmentTemplate"===d?b=q.call(c,a):"SegmentList"===d&&(b=u.call(c,a)),w.call(c,a,b)):b=a.segments,b},w=function(a,c){var d;if(a.segments=c,d=c.length-1,b&&isNaN(this.timelineConverter.getExpectedLiveEdge())){var e=c[d].presentationStartTime,f=this.metricsModel.getMetricsFor("stream");this.timelineConverter.setExpectedLiveEdge(e),this.metricsModel.updateManifestUpdateInfo(this.metricsExt.getCurrentManifestUpdate(f),{presentationStartTime:e})}},x=function(a){var b=this;if(!a)throw new Error("no representation");return a.segments=null,v.call(b,a),a},y=function(a,e){var f=this,g=a.initialization,h="BaseURL"!==a.segmentInfoType&&"SegmentBase"!==a.segmentInfoType;a.segmentAvailabilityRange=f.timelineConverter.calcSegmentAvailabilityRange(a,b),e||(d=-1),x.call(f,a),g||f.baseURLExt.loadInitialization(a),h||f.baseURLExt.loadSegments(a,c,a.indexRange),g&&h&&f.notify(f.eventList.ENAME_REPRESENTATION_UPDATED,a)},z=function(a,b){var c,d,e,f,g=b.segments,h=g?g.length:null,i=-1;if(g&&h>0)for(f=0;h>f;f+=1)if(c=g[f],d=c.presentationStartTime,e=c.duration,a+e/2>=d&&d+e>a-e/2){i=c.availabilityIdx;break}return i},A=function(a,b){if(!b||!b.segments)return null;var c,d,e=b.segments.length;for(d=0;e>d;d+=1)if(c=b.segments[d],c.availabilityIdx===a)return c;return null},B=function(a){var b,c,e=!1,f=a.segments;return f&&0!==f.length?(c=f[0].availabilityIdx,b=f[f.length-1].availabilityIdx,e=c>d||d>b):e=!0,e},C=function(a){if(null===a||void 0===a)return null;var b,d=new MediaPlayer.vo.FragmentRequest,e=a.representation,f=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].bandwidth;return b=k(a.media,e),b=g(b,"Number",a.replacementNumber),b=g(b,"Time",a.replacementTime),b=g(b,"Bandwidth",f),b=i(b,e.id),b=h(b),d.mediaType=c,d.type="Media Segment",d.url=b,d.range=a.mediaRange,d.startTime=a.presentationStartTime,d.duration=a.duration,d.timescale=e.timescale,d.availabilityStartTime=a.availabilityStartTime,d.availabilityEndTime=a.availabilityEndTime,d.wallStartTime=a.wallStartTime,d.quality=e.index,d.index=a.availabilityIdx,d},D=function(b,e,f){var g,h,i,j=d,k=this;return b?(a=e,k.debug.log("Getting the request for time: "+e),d=z.call(k,e,b),v.call(k,b),0>d&&(d=z.call(k,e,b)),k.debug.log("Index for time "+e+" is "+d),i=n.call(k,b),i?(g=new MediaPlayer.vo.FragmentRequest,g.action=g.ACTION_COMPLETE,g.index=d,g.mediaType=c,k.debug.log("Signal complete."),k.debug.log(g)):(h=A(d,b),g=C.call(k,h)),f&&(d=j),g):null},E=function(a,b){var c=(a.segmentAvailabilityRange.end-a.segmentAvailabilityRange.start)/2;return a.segments=null,a.segmentAvailabilityRange={start:b-c,end:b+c},D.call(this,a,b,!1)},F=function(b){var e,f,g,h,i=this;if(!b)return null;if(-1===d)throw"You must call getSegmentRequestForTime first.";return a=null,d+=1,h=d,g=n.call(i,b),g?(e=new MediaPlayer.vo.FragmentRequest,e.action=e.ACTION_COMPLETE,e.index=h,e.mediaType=c,i.debug.log("Signal complete.")):(v.call(i,b),f=A(h,b),e=C.call(i,f)),e},G=function(a,b){b.segments&&this.notify(this.eventList.ENAME_REPRESENTATION_UPDATED,b)},H=function(a,b,d,e,f){if(!f&&c===e){var g,h,i,j,k=this,l=[],m=0;for(g=0,h=b.length;h>g;g+=1)i=b[g],j=t.call(k,d,i.startTime,i.duration,i.timescale,i.media,i.mediaRange,m),l.push(j),j=null,m+=1;d.segmentAvailabilityRange={start:l[0].presentationStartTime,end:l[h-1].presentationStartTime},d.availableSegmentsNumber=h,w.call(k,d,l),d.initialization&&this.notify(this.eventList.ENAME_REPRESENTATION_UPDATED,d)}};return{debug:void 0,baseURLExt:void 0,timelineConverter:void 0,metricsModel:void 0,metricsExt:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_REPRESENTATION_UPDATED:"representationUpdated"},setup:function(){this.initializationLoaded=G,this.segmentsLoaded=H},initialize:function(a){this.subscribe(this.eventList.ENAME_REPRESENTATION_UPDATED,a.trackController),c=a.getType(),b=a.isDynamic(),this.streamProcessor=a},getType:function(){return c},setType:function(a){c=a},getIsDynamic:function(){return b},setIsDynamic:function(a){b=a},setCurrentTime:function(a){e=a},getCurrentTime:function(){return e},reset:function(){e=0,a=void 0,d=-1,this.unsubscribe(this.eventList.ENAME_REPRESENTATION_UPDATED,this.streamProcessor.trackController)},getInitRequest:m,getSegmentRequestForTime:D,getNextSegmentRequest:F,generateSegmentRequestForTime:E,updateRepresentation:y}},Dash.dependencies.DashHandler.prototype={constructor:Dash.dependencies.DashHandler},Dash.dependencies.DashManifestExtensions=function(){"use strict";this.timelineConverter=void 0},Dash.dependencies.DashManifestExtensions.prototype={constructor:Dash.dependencies.DashManifestExtensions,getIsTypeOf:function(a,b){"use strict";var c,d,e,f=a.ContentComponent_asArray,g=new RegExp("text"!==b?b:"(vtt|ttml)"),h=!1,i=!1;if(f)for(c=0,d=f.length;d>c;c+=1)f[c].contentType===b&&(h=!0,i=!0);if(a.hasOwnProperty("mimeType")&&(h=g.test(a.mimeType),i=!0),!i)for(c=0,d=a.Representation_asArray.length;!i&&d>c;)e=a.Representation_asArray[c],e.hasOwnProperty("mimeType")&&(h=g.test(e.mimeType),i=!0),c+=1;return h},getIsAudio:function(a){"use strict";return this.getIsTypeOf(a,"audio")},getIsVideo:function(a){"use strict";return this.getIsTypeOf(a,"video")},getIsText:function(a){"use strict";return this.getIsTypeOf(a,"text")},getIsTextTrack:function(a){return"text/vtt"===a||"application/ttml+xml"===a},getLanguageForAdaptation:function(a){var b="";return a.hasOwnProperty("lang")&&(b=a.lang),b},getIsMain:function(){"use strict";return!1},processAdaptation:function(a){"use strict";return void 0!==a.Representation_asArray&&null!==a.Representation_asArray&&a.Representation_asArray.sort(function(a,b){return a.bandwidth-b.bandwidth}),a},getAdaptationForId:function(a,b,c){"use strict";var d,e,f=b.Period_asArray[c].AdaptationSet_asArray;for(d=0,e=f.length;e>d;d+=1)if(f[d].hasOwnProperty("id")&&f[d].id===a)return f[d];return null},getAdaptationForIndex:function(a,b,c){"use strict";var d=b.Period_asArray[c].AdaptationSet_asArray;return d[a]},getIndexForAdaptation:function(a,b,c){"use strict";var d,e,f=b.Period_asArray[c].AdaptationSet_asArray;for(d=0,e=f.length;e>d;d+=1)if(f[d]===a)return d;return-1},getAdaptationsForType:function(a,b,c){"use strict";var d,e,f=this,g=a.Period_asArray[b].AdaptationSet_asArray,h=[];for(d=0,e=g.length;e>d;d+=1)this.getIsTypeOf(g[d],c)&&h.push(f.processAdaptation(g[d]));return h},getAdaptationForType:function(a,b,c){"use strict";var d,e,f,g=this;if(f=this.getAdaptationsForType(a,b,c),!f||0===f.length)return null;for(d=0,e=f.length;e>d;d+=1)if(g.getIsMain(f[d]))return f[d];return f[0]},getCodec:function(a){"use strict";var b=a.Representation_asArray[0],c=b.mimeType+';codecs="'+b.codecs+'"';return c},getMimeType:function(a){"use strict";return a.Representation_asArray[0].mimeType},getKID:function(a){"use strict";return a&&a.hasOwnProperty("cenc:default_KID")?a["cenc:default_KID"]:null},getContentProtectionData:function(a){"use strict";return a&&a.hasOwnProperty("ContentProtection_asArray")&&0!==a.ContentProtection_asArray.length?a.ContentProtection_asArray:null},getIsDynamic:function(a){"use strict";var b=!1,c="dynamic";return a.hasOwnProperty("type")&&(b=a.type===c),b},getIsDVR:function(a){"use strict";var b,c,d=this.getIsDynamic(a);return b=!isNaN(a.timeShiftBufferDepth),c=d&&b},getIsOnDemand:function(a){"use strict";var b=!1;return a.profiles&&a.profiles.length>0&&(b=-1!==a.profiles.indexOf("urn:mpeg:dash:profile:isoff-on-demand:2011")),b},getDuration:function(a){var b;return b=a.hasOwnProperty("mediaPresentationDuration")?a.mediaPresentationDuration:Number.POSITIVE_INFINITY},getBandwidth:function(a){"use strict";return a.bandwidth},getRefreshDelay:function(a){"use strict";var b=NaN,c=2;return a.hasOwnProperty("minimumUpdatePeriod")&&(b=Math.max(parseFloat(a.minimumUpdatePeriod),c)),b},getRepresentationCount:function(a){"use strict";return a.Representation_asArray.length},getRepresentationFor:function(a,b){"use strict";return b.Representation_asArray[a]},getRepresentationsForAdaptation:function(a,b){for(var c,d,e,f,g,h=this,i=h.processAdaptation(a.Period_asArray[b.period.index].AdaptationSet_asArray[b.index]),j=[],k=0;k<i.Representation_asArray.length;k+=1)f=i.Representation_asArray[k],c=new Dash.vo.Representation,c.index=k,c.adaptation=b,f.hasOwnProperty("id")&&(c.id=f.id),f.hasOwnProperty("SegmentBase")?(e=f.SegmentBase,c.segmentInfoType="SegmentBase"):f.hasOwnProperty("SegmentList")?(e=f.SegmentList,c.segmentInfoType="SegmentList",c.useCalculatedLiveEdgeTime=!0):f.hasOwnProperty("SegmentTemplate")?(e=f.SegmentTemplate,e.hasOwnProperty("SegmentTimeline")?(c.segmentInfoType="SegmentTimeline",g=e.SegmentTimeline.S_asArray[e.SegmentTimeline.S_asArray.length-1],(!g.hasOwnProperty("r")||g.r>=0)&&(c.useCalculatedLiveEdgeTime=!0)):c.segmentInfoType="SegmentTemplate",e.hasOwnProperty("initialization")&&(c.initialization=e.initialization.split("$Bandwidth$").join(f.bandwidth).split("$RepresentationID$").join(f.id))):(e=f.BaseURL,c.segmentInfoType="BaseURL"),e.hasOwnProperty("Initialization")?(d=e.Initialization,d.hasOwnProperty("sourceURL")?c.initialization=d.sourceURL:d.hasOwnProperty("range")&&(c.initialization=f.BaseURL,c.range=d.range)):f.hasOwnProperty("mimeType")&&h.getIsTextTrack(f.mimeType)&&(c.initialization=f.BaseURL,c.range=0),e.hasOwnProperty("timescale")&&(c.timescale=e.timescale),e.hasOwnProperty("duration")&&(c.segmentDuration=e.duration/c.timescale),e.hasOwnProperty("startNumber")&&(c.startNumber=e.startNumber),e.hasOwnProperty("indexRange")&&(c.indexRange=e.indexRange),e.hasOwnProperty("presentationTimeOffset")&&(c.presentationTimeOffset=e.presentationTimeOffset/c.timescale),c.MSETimeOffset=h.timelineConverter.calcMSETimeOffset(c),j.push(c);return j},getAdaptationsForPeriod:function(a,b){for(var c,d,e=a.Period_asArray[b.index],f=[],g=0;g<e.AdaptationSet_asArray.length;g+=1)d=e.AdaptationSet_asArray[g],c=new Dash.vo.AdaptationSet,d.hasOwnProperty("id")&&(c.id=d.id),c.index=g,c.period=b,c.type=this.getIsAudio(d)?"audio":this.getIsVideo(d)?"video":"text",f.push(c);return f},getRegularPeriods:function(a,b){var c,d,e=this,f=[],g=e.getIsDynamic(a),h=null,i=null,j=null,k=null;for(c=0,d=a.Period_asArray.length;d>c;c+=1)i=a.Period_asArray[c],i.hasOwnProperty("start")?(k=new Dash.vo.Period,k.start=i.start):null!==h&&i.hasOwnProperty("duration")?(k=new Dash.vo.Period,k.start=j.start+j.duration,k.duration=i.duration):0!==c||g||(k=new Dash.vo.Period,k.start=0),null!==j&&isNaN(j.duration)&&(j.duration=k.start-j.start),null!==k&&i.hasOwnProperty("id")&&(k.id=i.id),null!==k&&i.hasOwnProperty("duration")&&(k.duration=i.duration),null!==k&&(k.index=c,k.mpd=b,f.push(k)),h=i,i=null,j=k,k=null;return 0===f.length?f:(b.checkTime=e.getCheckTime(a,f[0]),null!==j&&isNaN(j.duration)&&(j.duration=e.getEndTimeForLastPeriod(b)-j.start),f)},getMpd:function(a){var b=new Dash.vo.Mpd;return b.manifest=a,b.availabilityStartTime=new Date(a.hasOwnProperty("availabilityStartTime")?a.availabilityStartTime.getTime():a.loadedTime.getTime()),a.hasOwnProperty("availabilityEndTime")&&(b.availabilityEndTime=new Date(a.availabilityEndTime.getTime())),a.hasOwnProperty("suggestedPresentationDelay")&&(b.suggestedPresentationDelay=a.suggestedPresentationDelay),a.hasOwnProperty("timeShiftBufferDepth")&&(b.timeShiftBufferDepth=a.timeShiftBufferDepth),a.hasOwnProperty("maxSegmentDuration")&&(b.maxSegmentDuration=a.maxSegmentDuration),b},getFetchTime:function(a,b){var c=this.timelineConverter.calcPresentationTimeFromWallTime(a.loadedTime,b);return c},getCheckTime:function(a,b){var c,d=this,e=NaN;return a.hasOwnProperty("minimumUpdatePeriod")&&(c=d.getFetchTime(a,b),e=c+a.minimumUpdatePeriod),e},getEndTimeForLastPeriod:function(a){var b;if(a.manifest.mediaPresentationDuration)b=a.manifest.mediaPresentationDuration;else{if(isNaN(a.checkTime))throw new Error("Must have @mediaPresentationDuration or @minimumUpdatePeriod on MPD or an explicit @duration on the last period.");b=a.checkTime}return b},getEventsForPeriod:function(a,b){var c=a.Period_asArray,d=c[b.index].EventStream_asArray,e=[];if(d)for(var f=0;f<d.length;f+=1){
var g=new Dash.vo.EventStream;if(g.period=b,g.timescale=1,!d[f].hasOwnProperty("schemeIdUri"))throw"Invalid EventStream. SchemeIdUri has to be set";g.schemeIdUri=d[f].schemeIdUri,d[f].hasOwnProperty("timescale")&&(g.timescale=d[f].timescale),d[f].hasOwnProperty("value")&&(g.value=d[f].value);for(var h=0;h<d[f].Event_asArray.length;h+=1){var i=new Dash.vo.Event;i.presentationTime=0,i.eventStream=g,d[f].Event_asArray[h].hasOwnProperty("presentationTime")&&(i.presentationTime=d[f].Event_asArray[h].presentationTime),d[f].Event_asArray[h].hasOwnProperty("duration")&&(i.duration=d[f].Event_asArray[h].duration),d[f].Event_asArray[h].hasOwnProperty("id")&&(i.id=d[f].Event_asArray[h].id),e.push(i)}}return e},getEventStreamForAdaptationSet:function(a,b){var c=[],d=a.Period_asArray[b.period.index].AdaptationSet_asArray[b.index].InbandEventStream_asArray;if(d)for(var e=0;e<d.length;e+=1){var f=new Dash.vo.EventStream;if(f.timescale=1,!d[e].hasOwnProperty("schemeIdUri"))throw"Invalid EventStream. SchemeIdUri has to be set";f.schemeIdUri=d[e].schemeIdUri,d[e].hasOwnProperty("timescale")&&(f.timescale=d[e].timescale),d[e].hasOwnProperty("value")&&(f.value=d[e].value),c.push(f)}return c},getEventStreamForRepresentation:function(a,b){var c=[],d=a.Period_asArray[b.adaptation.period.index].AdaptationSet_asArray[b.adaptation.index].Representation_asArray[b.index].InbandEventStream_asArray;if(d)for(var e=0;e<d.length;e++){var f=new Dash.vo.EventStream;if(f.timescale=1,f.representation=b,!d[e].hasOwnProperty("schemeIdUri"))throw"Invalid EventStream. SchemeIdUri has to be set";f.schemeIdUri=d[e].schemeIdUri,d[e].hasOwnProperty("timescale")&&(f.timescale=d[e].timescale),d[e].hasOwnProperty("value")&&(f.value=d[e].value),c.push(f)}return c}},Dash.dependencies.DashMetricsExtensions=function(){"use strict";var a=function(a,b){var c,d,e,f,g,h,i,j;for(h=0;h<a.length;h+=1)for(c=a[h],e=c.AdaptationSet_asArray,i=0;i<e.length;i+=1)for(d=e[i],g=d.Representation_asArray,j=0;j<g.length;j+=1)if(f=g[j],b===f.id)return j;return-1},b=function(a,b){var c,d,e,f,g,h,i,j;for(h=0;h<a.length;h+=1)for(c=a[h],e=c.AdaptationSet_asArray,i=0;i<e.length;i+=1)for(d=e[i],g=d.Representation_asArray,j=0;j<g.length;j+=1)if(f=g[j],b===f.id)return f;return null},c=function(a,b){return this.manifestExt.getIsTypeOf(a,b)},d=function(a,b){var d,e,f,g,h,i;for(h=0;h<a.length;h+=1)for(d=a[h],f=d.AdaptationSet_asArray,i=0;i<f.length;i+=1)if(e=f[i],g=e.Representation_asArray,c.call(this,e,b))return g.length;return-1},e=function(a){var c,d=this,e=d.manifestModel.getValue(),f=e.Period_asArray;return c=b.call(d,f,a),null===c?null:c.bandwidth},f=function(b){var c,d=this,e=d.manifestModel.getValue(),f=e.Period_asArray;return c=a.call(d,f,b)},g=function(a){var b,c=this,e=c.manifestModel.getValue(),f=e.Period_asArray;return b=d.call(this,f,a)},h=function(a){if(null===a)return null;var b,c,d,e=a.RepSwitchList;return null===e||e.length<=0?null:(b=e.length,c=b-1,d=e[c])},i=function(a){if(null===a)return null;var b,c,d,e=a.BufferLevel;return null===e||e.length<=0?null:(b=e.length,c=b-1,d=e[c])},j=function(a){if(null===a)return null;var b,c,d=a.PlayList;return null===d||d.length<=0?null:(b=d[d.length-1].trace,null===b||b.length<=0?null:c=b[b.length-1].playbackspeed)},k=function(a){if(null===a)return null;var b,c,d=a.HttpList,e=null;if(null===d||d.length<=0)return null;for(b=d.length,c=b-1;c>0;){if(d[c].responsecode){e=d[c];break}c-=1}return e},l=function(a){return null===a?[]:a.HttpList?a.HttpList:[]},m=function(a){if(null===a)return null;var b,c,d,e=a.DroppedFrames;return null===e||e.length<=0?null:(b=e.length,c=b-1,d=e[c])},n=function(a){if(null===a)return null;var b,c,d,e=a.SchedulingInfo;return null===e||e.length<=0?null:(b=e.length,c=b-1,d=e[c])},o=function(a){if(null===a)return null;var b,c,d,e=a.ManifestUpdate;return null===e||e.length<=0?null:(b=e.length,c=b-1,d=e[c])},p=function(a){if(null===a)return null;var b,c=a.DVRInfo,d=null;return null===c||c.length<=0?null:(b=c.length-1,d=c[b])};return{manifestModel:void 0,manifestExt:void 0,getBandwidthForRepresentation:e,getIndexForRepresentation:f,getMaxIndexForBufferType:g,getCurrentRepresentationSwitch:h,getCurrentBufferLevel:i,getCurrentPlaybackRate:j,getCurrentHttpRequest:k,getHttpRequests:l,getCurrentDroppedFrames:m,getCurrentSchedulingInfo:n,getCurrentDVRInfo:p,getCurrentManifestUpdate:o}},Dash.dependencies.DashMetricsExtensions.prototype={constructor:Dash.dependencies.DashMetricsExtensions},Dash.dependencies.DashParser=function(){"use strict";var a=31536e3,b=2592e3,c=86400,d=3600,e=60,f=60,g=1e3,h=/^P(([\d.]*)Y)?(([\d.]*)M)?(([\d.]*)D)?T?(([\d.]*)H)?(([\d.]*)M)?(([\d.]*)S)?/,i=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+-])([0-9]{2})([0-9]{2}))?/,j=/^[-+]?[0-9]+[.]?[0-9]*([eE][-+]?[0-9]+)?$/,k=[{type:"duration",test:function(a){return h.test(a)},converter:function(f){var g=h.exec(f);return parseFloat(g[2]||0)*a+parseFloat(g[4]||0)*b+parseFloat(g[6]||0)*c+parseFloat(g[8]||0)*d+parseFloat(g[10]||0)*e+parseFloat(g[12]||0)}},{type:"datetime",test:function(a){return i.test(a)},converter:function(a){var b,c=i.exec(a);if(b=Date.UTC(parseInt(c[1],10),parseInt(c[2],10)-1,parseInt(c[3],10),parseInt(c[4],10),parseInt(c[5],10),c[6]&&parseInt(c[6],10)||0,c[7]&&parseFloat(c[7])*g||0),c[9]&&c[10]){var d=parseInt(c[9],10)*f+parseInt(c[10],10);b+=("+"===c[8]?-1:1)*d*e*g}return new Date(b)}},{type:"numeric",test:function(a){return j.test(a)},converter:function(a){return parseFloat(a)}}],l=function(){var a,b,c,d;return d=[{name:"profiles",merge:!1},{name:"width",merge:!1},{name:"height",merge:!1},{name:"sar",merge:!1},{name:"frameRate",merge:!1},{name:"audioSamplingRate",merge:!1},{name:"mimeType",merge:!1},{name:"segmentProfiles",merge:!1},{name:"codecs",merge:!1},{name:"maximumSAPPeriod",merge:!1},{name:"startsWithSap",merge:!1},{name:"maxPlayoutRate",merge:!1},{name:"codingDependency",merge:!1},{name:"scanType",merge:!1},{name:"FramePacking",merge:!0},{name:"AudioChannelConfiguration",merge:!0},{name:"ContentProtection",merge:!0}],a={},a.name="AdaptationSet",a.isRoot=!1,a.isArray=!0,a.parent=null,a.children=[],a.properties=d,b={},b.name="Representation",b.isRoot=!1,b.isArray=!0,b.parent=a,b.children=[],b.properties=d,a.children.push(b),c={},c.name="SubRepresentation",c.isRoot=!1,c.isArray=!0,c.parent=b,c.children=[],c.properties=d,b.children.push(c),a},m=function(){var a,b,c,d;return d=[{name:"SegmentBase",merge:!0},{name:"SegmentTemplate",merge:!0},{name:"SegmentList",merge:!0}],a={},a.name="Period",a.isRoot=!1,a.isArray=!0,a.parent=null,a.children=[],a.properties=d,b={},b.name="AdaptationSet",b.isRoot=!1,b.isArray=!0,b.parent=a,b.children=[],b.properties=d,a.children.push(b),c={},c.name="Representation",c.isRoot=!1,c.isArray=!0,c.parent=b,c.children=[],c.properties=d,b.children.push(c),a},n=function(){var a,b,c,d,e;return e=[{name:"BaseURL",merge:!0,mergeFunction:function(a,b){var c;return c=0===b.indexOf("http://")?b:a+b}}],a={},a.name="mpd",a.isRoot=!0,a.isArray=!0,a.parent=null,a.children=[],a.properties=e,b={},b.name="Period",b.isRoot=!1,b.isArray=!0,b.parent=null,b.children=[],b.properties=e,a.children.push(b),c={},c.name="AdaptationSet",c.isRoot=!1,c.isArray=!0,c.parent=b,c.children=[],c.properties=e,b.children.push(c),d={},d.name="Representation",d.isRoot=!1,d.isArray=!0,d.parent=c,d.children=[],d.properties=e,c.children.push(d),a},o=function(){var a=[];return a.push(l()),a.push(m()),a.push(n()),a},p=function(a,b){var c,d=new X2JS(k,"",!0),e=new ObjectIron(o()),f=new Date,g=null,h=null;try{c=d.xml_str2json(a),g=new Date,c.hasOwnProperty("BaseURL")?(c.BaseURL=c.BaseURL_asArray[0],0!==c.BaseURL.toString().indexOf("http")&&(c.BaseURL=b+c.BaseURL)):c.BaseURL=b,e.run(c),h=new Date,this.debug.log("Parsing complete: ( xml2json: "+(g.getTime()-f.getTime())+"ms, objectiron: "+(h.getTime()-g.getTime())+"ms, total: "+(h.getTime()-f.getTime())/1e3+"s)")}catch(i){return this.errHandler.manifestError("parsing the manifest failed","parse",a),null}return c};return{debug:void 0,errHandler:void 0,parse:p}},Dash.dependencies.DashParser.prototype={constructor:Dash.dependencies.DashParser},Dash.dependencies.FragmentExtensions=function(){"use strict";var a=function(a){for(var b,c,d,e,f,g,h=new DataView(a),i=0;"tfdt"!==e&&i<h.byteLength;){for(d=h.getUint32(i),i+=4,e="",f=0;4>f;f+=1)g=h.getInt8(i),e+=String.fromCharCode(g),i+=1;"moof"!==e&&"traf"!==e&&"tfdt"!==e&&(i+=d-8)}if(i===h.byteLength)throw"Error finding live offset.";return c=h.getUint8(i),this.debug.log("position: "+i),0===c?(i+=4,b=h.getUint32(i,!1)):(i+=d-16,b=utils.Math.to64BitNumber(h.getUint32(i+4,!1),h.getUint32(i,!1))),{version:c,base_media_decode_time:b}},b=function(a){for(var b,c,d,e,f,g,h,i=new DataView(a),j=0;"sidx"!==f&&j<i.byteLength;){for(g=i.getUint32(j),j+=4,f="",e=0;4>e;e+=1)h=i.getInt8(j),f+=String.fromCharCode(h),j+=1;"moof"!==f&&"traf"!==f&&"sidx"!==f?j+=g-8:"sidx"===f&&(j-=8)}return b=i.getUint8(j+8),j+=12,c=i.getUint32(j+4,!1),j+=8,d=0===b?i.getUint32(j,!1):utils.Math.to64BitNumber(i.getUint32(j+4,!1),i.getUint32(j,!1)),{earliestPresentationTime:d,timescale:c}},c=function(b){var c,d,e,f=this,g=new XMLHttpRequest,h=!1;c=b,g.onloadend=function(){h||(d="Error loading fragment: "+c,f.notify(f.eventList.ENAME_FRAGMENT_LOADING_COMPLETED,null,new Error(d)))},g.onload=function(){h=!0,e=a(g.response),f.notify(f.eventList.ENAME_FRAGMENT_LOADING_COMPLETED,e)},g.onerror=function(){d="Error loading fragment: "+c,f.notify(f.eventList.ENAME_FRAGMENT_LOADING_COMPLETED,null,new Error(d))},g.responseType="arraybuffer",g.open("GET",c),g.send(null)};return{debug:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_FRAGMENT_LOADING_COMPLETED:"fragmentLoadingCompleted"},loadFragment:c,parseTFDT:a,parseSIDX:b}},Dash.dependencies.FragmentExtensions.prototype={constructor:Dash.dependencies.FragmentExtensions},Dash.dependencies.RepresentationController=function(){"use strict";var a,b=null,c=-1,d=!0,e=[],f=function(c,f,i){var k=this;if(d=!0,k.notify(k.eventList.ENAME_DATA_UPDATE_STARTED),e=j.call(k,f),a=h.call(k,k.abrController.getQualityFor(i)),b=c,"video"!==i&&"audio"!==i)return k.notify(k.eventList.ENAME_DATA_UPDATE_COMPLETED,b,a),void g.call(k);for(var l=0;l<e.length;l+=1)k.indexHandler.updateRepresentation(e[l],!0)},g=function(){var a=new Date,b=this.getCurrentRepresentation(),c=this.streamProcessor.playbackController.getTime();this.metricsModel.addTrackSwitch(b.adaptation.type,a,c,b.id)},h=function(a){return e[a]},i=function(){for(var a=0,b=e.length;b>a;a+=1)if(null===e[a].segmentAvailabilityRange||null===e[a].initialization)return!1;return!0},j=function(a){var d,e=this,f=e.manifestModel.getValue();return c=e.manifestExt.getIndexForAdaptation(b,f,a.period.index),d=e.manifestExt.getRepresentationsForAdaptation(f,a)},k=function(a){for(var b,c=this,d=0,f=e.length;f>d;d+=1)b=e[d],b.segmentAvailabilityRange=c.timelineConverter.calcSegmentAvailabilityRange(b,a)},l=function(c,e){for(var f,h=this,j=e,k=h.metricsModel.getMetricsFor("stream"),l=h.metricsExt.getCurrentManifestUpdate(k),m=!1,n=0;n<l.trackInfo.length;n+=1)if(f=l.trackInfo[n],f.index===j.index&&f.mediaType===h.streamProcessor.getType()){m=!0;break}m||h.metricsModel.addManifestUpdateTrackInfo(l,j.id,j.index,j.adaptation.period.index,h.streamProcessor.getType(),j.presentationTimeOffset,j.startNumber,j.segmentInfoType),i()&&(d=!1,h.metricsModel.updateManifestUpdateInfo(l,{latency:a.segmentAvailabilityRange.end-h.streamProcessor.playbackController.getTime()}),this.notify(this.eventList.ENAME_DATA_UPDATE_COMPLETED,b,a),g.call(h))},m=function(a,b){k.call(this,b)},n=function(){k.call(this,!0),this.indexHandler.updateRepresentation(a,!1)},o=function(b){var c=b.streamProcessor,d=this,e=d.timelineConverter.calcSegmentAvailabilityRange(a,c.isDynamic());d.metricsModel.addDVRInfo(c.getType(),c.playbackController.getTime(),c.getStreamInfo().manifestInfo,e)},p=function(b,c,d,e){var f=this;c===f.streamProcessor.getType()&&(a=f.getRepresentationForQuality(e),g.call(f))};return{system:void 0,debug:void 0,manifestExt:void 0,manifestModel:void 0,metricsModel:void 0,metricsExt:void 0,abrController:void 0,timelineConverter:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_DATA_UPDATE_COMPLETED:"dataUpdateCompleted",ENAME_DATA_UPDATE_STARTED:"dataUpdateStarted"},setup:function(){this.qualityChanged=p,this.representationUpdated=l,this.wallclockTimeUpdated=m,this.liveEdgeFound=n,this.bufferLevelUpdated=o},initialize:function(a){this.streamProcessor=a,this.indexHandler=a.indexHandler},getData:function(){return b},getDataIndex:function(){return c},isUpdating:function(){return d},updateData:f,getRepresentationForQuality:h,getCurrentRepresentation:function(){return a}}},Dash.dependencies.RepresentationController.prototype={constructor:Dash.dependencies.RepresentationController},Dash.dependencies.TimelineConverter=function(){"use strict";var a=0,b=!1,c=NaN,d=function(b,c,d,e){var f=NaN;return f=e?d&&c.timeShiftBufferDepth!=Number.POSITIVE_INFINITY?new Date(c.availabilityStartTime.getTime()+1e3*(b+c.timeShiftBufferDepth)):c.availabilityEndTime:d?new Date(c.availabilityStartTime.getTime()+1e3*(b-a)):c.availabilityStartTime},e=function(a,b,c){return d.call(this,a,b,c)},f=function(a,b,c){return d.call(this,a,b,c,!0)},g=function(b,c){return(b.getTime()-c.mpd.availabilityStartTime.getTime()+1e3*a)/1e3},h=function(a,b){var c=b.adaptation.period.start,d=b.presentationTimeOffset;return a+(c-d)},i=function(a,b){var c=b.adaptation.period.start,d=b.presentationTimeOffset;return a-c+d},j=function(a,b){var c,d,e;return b&&(c=a.representation.adaptation.period.mpd.suggestedPresentationDelay,d=a.presentationStartTime+c,e=new Date(a.availabilityStartTime.getTime()+1e3*d)),e},k=function(a,c){var d,e,f=a.segmentDuration,h=a.adaptation.period.start,i=h+a.adaptation.period.duration,j={start:h,end:i};return c?b&&!isNaN(f)||!a.segmentAvailabilityRange?(d=a.adaptation.period.mpd.checkTime,e=g(new Date((new Date).getTime()),a.adaptation.period),h=Math.max(e-a.adaptation.period.mpd.timeShiftBufferDepth,0),i=isNaN(d)?e:Math.min(d,e),j={start:h,end:i}):a.segmentAvailabilityRange:j},l=function(a,b){var c=a.adaptation.period.start;return b-c},m=function(a,b){var c=a.adaptation.period.start;return b+c},n=function(d,e,f){b||(a=e-(c+f),b=!0)},o=function(a){var b=a.presentationTimeOffset,c=a.adaptation.period.start;return c-b},p=function(){a=0,b=!1,c=NaN};return{notifier:void 0,uriQueryFragModel:void 0,setup:function(){this.liveEdgeFound=n},calcAvailabilityStartTimeFromPresentationTime:e,calcAvailabilityEndTimeFromPresentationTime:f,calcPresentationTimeFromWallTime:g,calcPresentationTimeFromMediaTime:h,calcPeriodRelativeTimeFromMpdRelativeTime:l,calcMpdRelativeTimeFromPeriodRelativeTime:m,calcMediaTimeFromPresentationTime:i,calcSegmentAvailabilityRange:k,calcWallTimeForSegment:j,calcMSETimeOffset:o,reset:p,isTimeSyncCompleted:function(){return b},getClientTimeOffset:function(){return a},getExpectedLiveEdge:function(){return c},setExpectedLiveEdge:function(a){c=a}}},Dash.dependencies.TimelineConverter.prototype={constructor:Dash.dependencies.TimelineConverter},Dash.vo.AdaptationSet=function(){"use strict";this.period=null,this.index=-1,this.type=null},Dash.vo.AdaptationSet.prototype={constructor:Dash.vo.AdaptationSet},Dash.vo.Event=function(){"use strict";this.duration=NaN,this.presentationTime=NaN,this.id=NaN,this.messageData="",this.eventStream=null,this.presentationTimeDelta=NaN},Dash.vo.Event.prototype={constructor:Dash.vo.Event},Dash.vo.EventStream=function(){"use strict";this.adaptionSet=null,this.representation=null,this.period=null,this.timescale=1,this.value="",this.schemeIdUri=""},Dash.vo.EventStream.prototype={constructor:Dash.vo.EventStream},Dash.vo.Mpd=function(){"use strict";this.manifest=null,this.suggestedPresentationDelay=0,this.availabilityStartTime=null,this.availabilityEndTime=Number.POSITIVE_INFINITY,this.timeShiftBufferDepth=Number.POSITIVE_INFINITY,this.maxSegmentDuration=Number.POSITIVE_INFINITY,this.checkTime=NaN,this.clientServerTimeShift=0,this.isClientServerTimeSyncCompleted=!1},Dash.vo.Mpd.prototype={constructor:Dash.vo.Mpd},Dash.vo.Period=function(){"use strict";this.id=null,this.index=-1,this.duration=NaN,this.start=NaN,this.mpd=null},Dash.vo.Period.prototype={constructor:Dash.vo.Period},Dash.vo.Representation=function(){"use strict";this.id=null,this.index=-1,this.adaptation=null,this.segmentInfoType=null,this.initialization=null,this.segmentDuration=NaN,this.timescale=1,this.startNumber=1,this.indexRange=null,this.range=null,this.presentationTimeOffset=0,this.MSETimeOffset=NaN,this.segmentAvailabilityRange=null,this.availableSegmentsNumber=0},Dash.vo.Representation.prototype={constructor:Dash.vo.Representation},Dash.vo.Segment=function(){"use strict";this.indexRange=null,this.index=null,this.mediaRange=null,this.media=null,this.duration=NaN,this.replacementTime=null,this.replacementNumber=NaN,this.mediaStartTime=NaN,this.presentationStartTime=NaN,this.availabilityStartTime=NaN,this.availabilityEndTime=NaN,this.availabilityIdx=NaN,this.wallStartTime=NaN,this.representation=null},Dash.vo.Segment.prototype={constructor:Dash.vo.Segment},MediaPlayer.dependencies.AbrController=function(){"use strict";var a=!0,b={},c={},d={},e=function(a){var b;return c.hasOwnProperty(a)||(c[a]=0),b=c[a]},f=function(a,b){c[a]=b},g=function(a){var b;return d.hasOwnProperty(a)||(d[a]=0),b=d[a]},h=function(a,b){d[a]=b},i=function(a,c){b[a]=c},j=function(a){var c;return b.hasOwnProperty(a)||(b[a]=0),c=b[a]},k=function(a,b,c){var d,e=this,f=this.adapter.convertDataToTrack(c).mediaInfo,g=f.type;d=f.trackCount-1,j(g)!==d&&(i(g,d),e.notify(e.eventList.ENAME_TOP_QUALITY_INDEX_CHANGED,g,d))};return{debug:void 0,adapter:void 0,abrRulesCollection:void 0,rulesController:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_QUALITY_CHANGED:"qualityChanged",ENAME_TOP_QUALITY_INDEX_CHANGED:"topQualityIndexChanged"},setup:function(){this.dataUpdateCompleted=k},getAutoSwitchBitrate:function(){return a},setAutoSwitchBitrate:function(b){a=b},getPlaybackQuality:function(b){var c,d,i,k,l=this,m=b.getType(),n=function(a){var b=j(m);c=a.value,k=a.confidence,0>c&&(c=0),c>b&&(c=b),d=e(m),c!==d&&(f(m,c),h(m,k),l.notify(l.eventList.ENAME_QUALITY_CHANGED,m,d,c))};c=e(m),k=g(m),a&&(l.abrRulesCollection.downloadRatioRule&&l.abrRulesCollection.downloadRatioRule.setStreamProcessor(b),i=l.abrRulesCollection.getRules(MediaPlayer.rules.ABRRulesCollection.prototype.QUALITY_SWITCH_RULES),l.rulesController.applyRules(i,b,n.bind(l),c,function(a,b){return Math.min(a,b)}))},setPlaybackQuality:function(a,c){var d=e(a),g=null!==c&&!isNaN(c)&&c%1===0;if(!g)throw"argument is not an integer";c!==d&&c>=0&&b.hasOwnProperty(a)&&c<=b[a]&&(f(a,c),this.notify(this.eventList.ENAME_QUALITY_CHANGED,a,d,c))},getQualityFor:function(a){return e(a)},getConfidenceFor:function(a){return g(a)},isPlayingAtTopQuality:function(){var a,b=this,c=b.getQualityFor("audio"),d=b.getQualityFor("video");return a=c===j("audio")&&d===j("video")},reset:function(){var e,f=this.abrRulesCollection.getRules(MediaPlayer.rules.ABRRulesCollection.prototype.QUALITY_SWITCH_RULES),g=f.length,h=0;for(h;g>h;h+=1)e=f[h],"function"==typeof e.reset&&e.reset();a=!0,b={},c={},d={}}}},MediaPlayer.dependencies.AbrController.prototype={constructor:MediaPlayer.dependencies.AbrController},MediaPlayer.dependencies.BufferController=function(){"use strict";var a,b,c,d,e=.5,f=22,g=[],h=0,i=-1,j=!1,k=0,l=Number.POSITIVE_INFINITY,m=-1,n=-1,o=null,p=null,q=!1,r=!1,s=[],t=!1,u=function(){var a=this.streamProcessor.getFragmentModel().getLoadingRequests();return i>h&&(v(s,i)||v(a,i))?!1:i!==h},v=function(a,b){var c=0,d=a.length;for(c;d>c;c+=1)if(a[c].quality===b)return!0;return!1},w=function(a,b){var c=function(a,c){return a[b]<c[b]?-1:a[b]>c[b]?1:0};a.sort(c)},x=function(a,c,d,e){var f=this;c===f.streamProcessor.getFragmentModel()&&(f.debug.log("Initialization finished loading: "+b),g[e]=d,e===h&&u.call(f)&&Y.call(f))},y=function(a,b,c,d,e){if(b===this.streamProcessor.getFragmentModel()){var f,g=this.streamProcessor.getFragmentModel().getExecutedRequestForQualityAndIndex(d,e),h=this.streamProcessor.getTrackForQuality(d),i=this.adapter.getEventsFor(h.mediaInfo,this.streamProcessor),j=this.adapter.getEventsFor(h,this.streamProcessor);(i.length>0||j.length>0)&&(f=C.call(this,c,g,i,j),this.streamProcessor.getEventController().addInbandEvents(f)),c=D.call(this,c),s.push({bytes:c,quality:d,index:e}),w(s,"index"),P.call(this)}},z=function(a,b,c){r=!0,d={quality:b,index:c};var e=this,f=isNaN(c);return b!==h&&f||b!==i&&!f?void R.call(e,b,c):void e.sourceBufferExt.append(o,a)},A=function(c,e,g,h){if(o===e){this.isBufferingCompleted()&&this.mediaSourceExt.signalEndOfStream(a);var i,j=this;if(h)return h.code===f&&(s.unshift({bytes:g,quality:d.quality,index:d.index}),l=.8*J.call(j),j.notify(j.eventList.ENAME_QUOTA_EXCEEDED,l),H.call(j)),void(r=!1);if(B.call(j),G.call(j)||(j.notify(j.eventList.ENAME_QUOTA_EXCEEDED,l),H.call(j)),i=j.sourceBufferExt.getAllRanges(o),i&&i.length>0){var k,m;for(k=0,m=i.length;m>k;k+=1)j.debug.log("Buffered "+b+" Range: "+i.start(k)+" - "+i.end(k))}Q.call(j,d.quality,d.index),j.notify(j.eventList.ENAME_BYTES_APPENDED,d.quality,d.index)}},B=function(){var a=this,b=a.playbackController.getTime();return k=a.sourceBufferExt.getBufferLength(o,b),a.notify(a.eventList.ENAME_BUFFER_LEVEL_UPDATED,k),E.call(a),L.call(a),e>k&&M.call(a,!1),!0},C=function(a,b,c,d){var e,f,g,h,i=[],j=0,k=Math.pow(256,2),l=Math.pow(256,3),m=Math.max(isNaN(b.startTime)?0:b.startTime,0),n=[];t=!1,h=c.concat(d);for(var o=0;o<h.length;o++)n[h[o].schemeIdUri]=h[o];for(;j<a.length&&(e=String.fromCharCode(a[j+4],a[j+5],a[j+6],a[j+7]),f=a[j]*l+a[j+1]*k+256*a[j+2]+1*a[j+3],"moov"!=e&&"moof"!=e);){if("emsg"==e){t=!0;for(var p=["","",0,0,0,0,""],q=0,r=j+12;f+j>r;)0===q||1==q||6==q?(0!==a[r]?p[q]+=String.fromCharCode(a[r]):q+=1,r+=1):(p[q]=a[r]*l+a[r+1]*k+256*a[r+2]+1*a[r+3],r+=4,q+=1);g=this.adapter.getEvent(p,n,m),g&&i.push(g)}j+=f}return i},D=function(a){if(!t)return a;for(var b,c,d=a.length,e=0,f=0,g=Math.pow(256,2),h=Math.pow(256,3),i=new Uint8Array(a.length);d>e;){if(b=String.fromCharCode(a[e+4],a[e+5],a[e+6],a[e+7]),c=a[e]*h+a[e+1]*g+256*a[e+2]+1*a[e+3],"emsg"!=b)for(var j=e;e+c>j;j++)i[f]=a[j],f+=1;e+=c}return i.subarray(0,f)},E=function(){var a=F.call(this),b=2*c,d=k-a;d>=b&&!q?(q=!0,this.notify(this.eventList.ENAME_BUFFER_LEVEL_OUTRUN)):b/2>d&&q&&(this.notify(this.eventList.ENAME_BUFFER_LEVEL_BALANCED),q=!1,P.call(this))},F=function(){var a=this.metricsModel.getReadOnlyMetricsFor("video"),b=this.metricsExt.getCurrentBufferLevel(a),c=this.metricsModel.getReadOnlyMetricsFor("audio"),d=this.metricsExt.getCurrentBufferLevel(c),e=null;return e=null===b||null===d?null!==d?d.level:null!==b?b.level:null:Math.min(d.level,b.level)},G=function(){var a=this,b=J.call(a);return l>b},H=function(){var b,c,d,e,f=this,g=f.playbackController.getTime();o&&(e=f.fragmentController.getExecutedRequestForTime(f.streamProcessor.getFragmentModel(),g),c=e&&!isNaN(e.startTime)?e.startTime:Math.floor(g),d=f.sourceBufferExt.getBufferRange(o,g),null===d&&o.buffered.length>0&&(c=o.buffered.end(o.buffered.length-1)),b=o.buffered.start(0),f.sourceBufferExt.remove(o,b,c,a))},I=function(a,b,d,e){o===b&&(B.call(this),this.notify(this.eventList.ENAME_BUFFER_CLEARED,d,e,G.call(this)),G.call(this)||setTimeout(H.bind(this),1e3*c))},J=function(){var a,b,c=this,d=c.sourceBufferExt.getAllRanges(o),e=0;if(!d)return e;for(b=0,a=d.length;a>b;b+=1)e+=d.end(b)-d.start(b);return e},K=function(){var a=m===n-1;a&&!j&&(j=!0,this.notify(this.eventList.ENAME_BUFFERING_COMPLETED))},L=function(){var a=this.playbackController.getTimeToStreamEnd(),b=this.streamProcessor.isDynamic()?c/2:c;b>k&&(a>c||c>=a&&!j)?M.call(this,!1):M.call(this,!0)},M=function(a){p!==a&&(p=a,this.debug.log(p?"Got enough "+b+" buffer to start.":"Waiting for more "+b+" buffer before starting playback."),this.eventBus.dispatchEvent({type:p?"bufferLoaded":"bufferStalled",data:{bufferType:b}}),this.notify(this.eventList.ENAME_BUFFER_LEVEL_STATE_CHANGED,a))},N=function(a){o.timestampOffset!==a&&(o.timestampOffset=a)},O=function(){var a=this;B.call(a),P.call(a)},P=function(){u.call(this)?Y.call(this):U.call(this)},Q=function(a,b){r=!1,isNaN(b)?S.call(this,a):T.call(this,b),P.call(this)},R=function(a,b){r=!1,this.notify(this.eventList.ENAME_BYTES_REJECTED,a,b),P.call(this)},S=function(a){i=a},T=function(a){m=Math.max(a,m),K.call(this)},U=function(){var a;0===s.length||q||r||u.call(this)||!G.call(this)||(a=s.shift(),z.call(this,a.bytes,a.quality,a.index))},V=function(a,b,d){var e,f=this;N.call(f,d.MSETimeOffset),e=f.streamProcessor.getStreamInfo().manifestInfo.minBufferTime,c!==e&&(f.setMinBufferTime(e),f.notify(f.eventList.ENAME_MIN_BUFFER_TIME_UPDATED,e))},W=function(a,b,c){var d=this;b===d.streamProcessor.getFragmentModel()&&(n=c.index,K.call(d))},X=function(a,c,d,e){if(b===c){var f=this;h!==e&&(N.call(f,f.streamProcessor.getTrackForQuality(e).MSETimeOffset),h=e,u.call(f)&&Y.call(f))}},Y=function(){var a=this;if(g[h]){if(r)return;z.call(a,g[h],h)}else a.notify(a.eventList.ENAME_INIT_REQUESTED,h)},Z=function(){P.call(this)},$=function(){L.call(this)};return{manifestModel:void 0,sourceBufferExt:void 0,eventBus:void 0,bufferMax:void 0,mediaSourceExt:void 0,metricsModel:void 0,metricsExt:void 0,adapter:void 0,debug:void 0,system:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_CLOSED_CAPTIONING_REQUESTED:"closedCaptioningRequested",ENAME_BUFFER_LEVEL_STATE_CHANGED:"bufferLevelStateChanged",ENAME_BUFFER_LEVEL_UPDATED:"bufferLevelUpdated",ENAME_QUOTA_EXCEEDED:"quotaExceeded",ENAME_BYTES_APPENDED:"bytesAppended",ENAME_BYTES_REJECTED:"bytesRejected",ENAME_BUFFERING_COMPLETED:"bufferingCompleted",ENAME_BUFFER_CLEARED:"bufferCleared",ENAME_INIT_REQUESTED:"initRequested",ENAME_BUFFER_LEVEL_OUTRUN:"bufferLevelOutrun",ENAME_BUFFER_LEVEL_BALANCED:"bufferLevelBalanced",ENAME_MIN_BUFFER_TIME_UPDATED:"minBufferTimeUpdated"},setup:function(){this.dataUpdateCompleted=V,this.initFragmentLoaded=x,this.mediaFragmentLoaded=y,this.streamCompleted=W,this.qualityChanged=X,this.playbackProgress=O,this.playbackSeeking=O,this.playbackTimeUpdated=O,this.playbackRateChanged=$,this.wallclockTimeUpdated=Z,A=A.bind(this),I=I.bind(this),this.sourceBufferExt.subscribe(this.sourceBufferExt.eventList.ENAME_SOURCEBUFFER_APPEND_COMPLETED,this,A),this.sourceBufferExt.subscribe(this.sourceBufferExt.eventList.ENAME_SOURCEBUFFER_REMOVE_COMPLETED,this,I)},initialize:function(a,c,d,e){var f=this;b=a,f.setMediaSource(d),f.setBuffer(c),f.streamProcessor=e,f.fragmentController=e.fragmentController,f.scheduleController=e.scheduleController,f.playbackController=e.playbackController},getStreamProcessor:function(){return this.streamProcessor},setStreamProcessor:function(a){this.streamProcessor=a},getBuffer:function(){return o},setBuffer:function(a){o=a},getBufferLevel:function(){return k},getMinBufferTime:function(){return c},setMinBufferTime:function(a){c=a},getCriticalBufferLevel:function(){return l},setMediaSource:function(b){a=b},isBufferingCompleted:function(){return j},reset:function(b){var e=this;g=[],l=Number.POSITIVE_INFINITY,p=null,c=null,i=-1,h=0,e.sourceBufferExt.unsubscribe(e.sourceBufferExt.eventList.ENAME_SOURCEBUFFER_APPEND_COMPLETED,e,A),e.sourceBufferExt.unsubscribe(e.sourceBufferExt.eventList.ENAME_SOURCEBUFFER_REMOVE_COMPLETED,e,I),d=null,q=!1,r=!1,s=[],b||(e.sourceBufferExt.abort(a,o),e.sourceBufferExt.removeSourceBuffer(a,o)),o=null}}},MediaPlayer.dependencies.BufferController.BUFFER_SIZE_REQUIRED="required",MediaPlayer.dependencies.BufferController.BUFFER_SIZE_MIN="min",MediaPlayer.dependencies.BufferController.BUFFER_SIZE_INFINITY="infinity",MediaPlayer.dependencies.BufferController.DEFAULT_MIN_BUFFER_TIME=8,MediaPlayer.dependencies.BufferController.BUFFER_TIME_AT_TOP_QUALITY=30,MediaPlayer.dependencies.BufferController.BUFFER_TIME_AT_TOP_QUALITY_LONG_FORM=300,MediaPlayer.dependencies.BufferController.LONG_FORM_CONTENT_DURATION_THRESHOLD=600,MediaPlayer.dependencies.BufferController.prototype={constructor:MediaPlayer.dependencies.BufferController},MediaPlayer.utils.Capabilities=function(){"use strict"},MediaPlayer.utils.Capabilities.prototype={constructor:MediaPlayer.utils.Capabilities,supportsMediaSource:function(){"use strict";var a="WebKitMediaSource"in window,b="MediaSource"in window;return a||b},supportsMediaKeys:function(){"use strict";var a="WebKitMediaKeys"in window,b="MSMediaKeys"in window,c="MediaKeys"in window;return a||b||c},supportsCodec:function(a,b){"use strict";if(!(a instanceof HTMLMediaElement))throw"element must be of type HTMLMediaElement.";var c=a.canPlayType(b);return"probably"===c||"maybe"===c}},MediaPlayer.utils.Debug=function(){"use strict";var a=!0;return{eventBus:void 0,setLogToBrowserConsole:function(b){a=b},getLogToBrowserConsole:function(){return a},log:function(b){a&&console.log(b),this.eventBus.dispatchEvent({type:"log",message:b})}}},MediaPlayer.dependencies.ErrorHandler=function(){"use strict";return{eventBus:void 0,capabilityError:function(a){this.eventBus.dispatchEvent({type:"error",error:"capability",event:a})},downloadError:function(a,b,c){this.eventBus.dispatchEvent({type:"error",error:"download",event:{id:a,url:b,request:c}})},manifestError:function(a,b,c){this.eventBus.dispatchEvent({type:"error",error:"manifestError",event:{message:a,id:b,manifest:c}})},closedCaptionsError:function(a,b,c){this.eventBus.dispatchEvent({type:"error",error:"cc",event:{message:a,id:b,cc:c}})},mediaSourceError:function(a){this.eventBus.dispatchEvent({type:"error",error:"mediasource",event:a})},mediaKeySessionError:function(a){this.eventBus.dispatchEvent({type:"error",error:"key_session",event:a})},mediaKeyMessageError:function(a){this.eventBus.dispatchEvent({type:"error",error:"key_message",event:a})},mediaKeySystemSelectionError:function(a){this.eventBus.dispatchEvent({type:"error",error:"key_system_selection",event:a})}}},MediaPlayer.dependencies.ErrorHandler.prototype={constructor:MediaPlayer.dependencies.ErrorHandler},MediaPlayer.utils.EventBus=function(){"use strict";var a,b=function(b,c){var d=(c?"1":"0")+b;return d in a||(a[d]=[]),a[d]},c=function(){a={}};return c(),{addEventListener:function(a,c,d){var e=b(a,d),f=e.indexOf(c);-1===f&&e.push(c)},removeEventListener:function(a,c,d){var e=b(a,d),f=e.indexOf(c);-1!==f&&e.splice(f,1)},dispatchEvent:function(a){for(var c=b(a.type,!1).slice(),d=0;d<c.length;d++)c[d].call(this,a);return!a.defaultPrevented}}},MediaPlayer.dependencies.EventController=function(){"use strict";var a=[],b=[],c=[],d=null,e=100,f=e/1e3,g="urn:mpeg:dash:event:2012",h=1,i=function(){null!==d&&(clearInterval(d),d=null),a=null,b=null,c=null},j=function(){null!==d&&(clearInterval(d),d=null)},k=function(){var a=this;a.debug.log("Start Event Controller"),isNaN(e)||(d=setInterval(n.bind(this),e))},l=function(b){var c=this;a=[],b&&b.length>0&&(a=b),c.debug.log("Added "+b.length+" inline events")},m=function(a){for(var c=this,d=0;d<a.length;d++){var e=a[d];b[e.id]=e,c.debug.log("Add inband event with id "+e.id)}},n=function(){o.call(this,b),o.call(this,a),p.call(this)},o=function(a){var b,d=this,e=this.videoModel.getCurrentTime();if(a)for(var i=0;i<a.length;i++){var j=a[i];void 0!==j&&(b=j.presentationTime/j.eventStream.timescale,(0===b||e>=b&&b+f>e)&&(d.debug.log("Start Event at "+e),j.duration>0&&c.push(j),j.eventStream.schemeIdUri==g&&j.eventStream.value==h&&q.call(this),a.splice(i,1)))}},p=function(){var a=this;if(c)for(var b=this.videoModel.getCurrentTime(),d=0;d<c.length;d++){var e=c[d];null!==e&&(e.duration+e.presentationTime)/e.eventStream.timescale<b&&(a.debug.log("Remove Event at time "+b),e=null,c.splice(d,1))}},q=function(){var a=this,b=a.manifestModel.getValue(),c=b.url;b.hasOwnProperty("Location")&&(c=b.Location),a.debug.log("Refresh manifest @ "+c),a.manifestLoader.load(c)};return{manifestModel:void 0,manifestLoader:void 0,debug:void 0,
system:void 0,errHandler:void 0,videoModel:void 0,addInlineEvents:l,addInbandEvents:m,reset:i,clear:j,start:k,getVideoModel:function(){return this.videoModel},setVideoModel:function(a){this.videoModel=a},initialize:function(a){this.setVideoModel(a)}}},MediaPlayer.dependencies.EventController.prototype={constructor:MediaPlayer.dependencies.EventController},MediaPlayer.dependencies.FragmentController=function(){"use strict";var a=[],b=!1,c=function(b){for(var c=a.length,d=0;c>d;d++)if(a[d].getContext()==b)return a[d];return null},d=function(b,c){var d=this,e=a[0].getContext().streamProcessor,f=e.getStreamInfo().id,g=d.scheduleRulesCollection.getRules(MediaPlayer.rules.ScheduleRulesCollection.prototype.FRAGMENTS_TO_EXECUTE_RULES);-1!==g.indexOf(this.scheduleRulesCollection.sameTimeRequestRule)&&this.scheduleRulesCollection.sameTimeRequestRule.setFragmentModels(a,f),d.rulesController.applyRules(g,e,c,b,function(a,b){return b})},e=function(a,b){var c=this;c.isInitializationRequest(b)?c.notify(c.eventList.ENAME_INIT_FRAGMENT_LOADING_START,a,b):c.notify(c.eventList.ENAME_MEDIA_FRAGMENT_LOADING_START,a,b)},f=function(a,b,c){var d=this,e=d.process(c);return null===e?void d.debug.log("No "+b.mediaType+" bytes to push."):(d.isInitializationRequest(b)?d.notify(d.eventList.ENAME_INIT_FRAGMENT_LOADED,a,e,b.quality):d.notify(d.eventList.ENAME_MEDIA_FRAGMENT_LOADED,a,e,b.quality,b.index),void j.call(this))},g=function(a,b){this.notify(this.eventList.ENAME_STREAM_COMPLETED,a,b)},h=function(){j.call(this)},i=function(c){var d,e,f,g,h,i=c.value;for(g=0;g<i.length;g+=1)if(e=i[g])for(h=0;h<a.length;h+=1)f=a[h],d=f.getContext().streamProcessor.getType(),e.mediaType===d&&(e instanceof MediaPlayer.vo.FragmentRequest||(e=f.getPendingRequestForTime(e.startTime)),f.executeRequest(e));b=!1},j=function(a){b||(b=!0,d.call(this,a,i.bind(this)))};return{system:void 0,debug:void 0,scheduleRulesCollection:void 0,rulesController:void 0,fragmentLoader:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_STREAM_COMPLETED:"streamCompleted",ENAME_INIT_FRAGMENT_LOADING_START:"initFragmentLoadingStart",ENAME_MEDIA_FRAGMENT_LOADING_START:"mediaFragmentLoadingStart",ENAME_INIT_FRAGMENT_LOADED:"initFragmentLoaded",ENAME_MEDIA_FRAGMENT_LOADED:"mediaFragmentLoaded"},setup:function(){this.fragmentLoadingStarted=e,this.fragmentLoadingCompleted=f,this.streamCompleted=g,this.bufferLevelBalanced=h},process:function(a){var b=null;return null!==a&&void 0!==a&&a.byteLength>0&&(b=new Uint8Array(a)),b},getModel:function(b){if(!b)return null;var d=c(b);return d||(d=this.system.getObject("fragmentModel"),d.setContext(b),a.push(d)),d},detachModel:function(b){var c=a.indexOf(b);c>-1&&a.splice(c,1)},isFragmentLoadedOrPending:function(a,b){var d,e=c(a);return e?d=e.isFragmentLoadedOrPending(b):!1},getPendingRequests:function(a){var b=c(a);return b?b.getPendingRequests():null},getLoadingRequests:function(a){var b=c(a);return b?b.getLoadingRequests():null},isInitializationRequest:function(a){return a&&a.type&&-1!==a.type.toLowerCase().indexOf("initialization")},getLoadingTime:function(a){var b=c(a);return b?b.getLoadingTime():null},getExecutedRequestForTime:function(a,b){return a?a.getExecutedRequestForTime(b):null},removeExecutedRequest:function(a,b){a&&a.removeExecutedRequest(b)},removeExecutedRequestsBeforeTime:function(a,b){a&&a.removeExecutedRequestsBeforeTime(b)},cancelPendingRequestsForModel:function(a){a&&a.cancelPendingRequests()},abortRequestsForModel:function(a){a&&a.abortRequests(),j.call(this)},prepareFragmentForLoading:function(a,b){var d=c(a);d&&b&&d.addRequest(b)&&j.call(this,b)},executePendingRequests:function(){j.call(this)},resetModel:function(a){this.abortRequestsForModel(a),this.cancelPendingRequestsForModel(a)}}},MediaPlayer.dependencies.FragmentController.prototype={constructor:MediaPlayer.dependencies.FragmentController},MediaPlayer.dependencies.FragmentLoader=function(){"use strict";var a=3,b=500,c=[],d=function(a,e){var f=new XMLHttpRequest,g=null,h=!0,i=!0,j=null,k=this;c.push(f),a.requestStartDate=new Date,g=k.metricsModel.addHttpRequest(a.mediaType,null,a.type,a.url,null,a.range,a.requestStartDate,null,null,null,null,a.duration),k.metricsModel.appendHttpTrace(g,a.requestStartDate,a.requestStartDate.getTime()-a.requestStartDate.getTime(),[0]),j=a.requestStartDate,f.open("GET",k.tokenAuthentication.addTokenAsQueryArg(a.url),!0),f.responseType="arraybuffer",f=k.tokenAuthentication.setTokenInRequestHeader(f),a.range&&f.setRequestHeader("Range","bytes="+a.range),f.onprogress=function(b){var c=new Date;h&&(h=!1,(!b.lengthComputable||b.lengthComputable&&b.total!=b.loaded)&&(a.firstByteDate=c,g.tresponse=c)),k.metricsModel.appendHttpTrace(g,c,c.getTime()-j.getTime(),[f.response?f.response.byteLength:0]),j=c},f.onload=function(){if(!(f.status<200||f.status>299)){i=!1;var b,c,d=new Date,e=f.response;a.firstByteDate||(a.firstByteDate=a.requestStartDate),a.requestEndDate=d,b=a.firstByteDate.getTime()-a.requestStartDate.getTime(),c=a.requestEndDate.getTime()-a.firstByteDate.getTime(),k.debug.log("loaded "+a.mediaType+":"+a.type+":"+a.startTime+" ("+f.status+", "+b+"ms, "+c+"ms)"),g.tresponse=a.firstByteDate,g.tfinish=a.requestEndDate,g.responsecode=f.status,k.metricsModel.appendHttpTrace(g,d,d.getTime()-j.getTime(),[e?e.byteLength:0]),j=d,k.notify(k.eventList.ENAME_LOADING_COMPLETED,a,e)}},f.onloadend=f.onerror=function(){if(-1!==c.indexOf(f)&&(c.splice(c.indexOf(f),1),i)){i=!1;var h,l,m=new Date,n=f.response;a.firstByteDate||(a.firstByteDate=a.requestStartDate),a.requestEndDate=m,h=a.firstByteDate.getTime()-a.requestStartDate.getTime(),l=a.requestEndDate.getTime()-a.firstByteDate.getTime(),k.debug.log("failed "+a.mediaType+":"+a.type+":"+a.startTime+" ("+f.status+", "+h+"ms, "+l+"ms)"),g.tresponse=a.firstByteDate,g.tfinish=a.requestEndDate,g.responsecode=f.status,k.metricsModel.appendHttpTrace(g,m,m.getTime()-j.getTime(),[n?n.byteLength:0]),j=m,e>0?(k.debug.log("Failed loading fragment: "+a.mediaType+":"+a.type+":"+a.startTime+", retry in "+b+"ms attempts: "+e),e--,setTimeout(function(){d.call(k,a,e)},b)):(k.debug.log("Failed loading fragment: "+a.mediaType+":"+a.type+":"+a.startTime+" no retry attempts left"),k.errHandler.downloadError("content",a.url,f),k.notify(k.eventList.ENAME_LOADING_COMPLETED,a,null,new Error("failed loading fragment")))}},f.send()},e=function(a){var b=this,c=new XMLHttpRequest,d=!1;c.open("HEAD",a.url,!0),c.onload=function(){c.status<200||c.status>299||(d=!0,b.notify(b.eventList.ENAME_CHECK_FOR_EXISTENCE_COMPLETED,!0,a))},c.onloadend=c.onerror=function(){d||b.notify(b.eventList.ENAME_CHECK_FOR_EXISTENCE_COMPLETED,!1,a)},c.send()};return{metricsModel:void 0,errHandler:void 0,debug:void 0,tokenAuthentication:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_LOADING_COMPLETED:"loadingCompleted",ENAME_CHECK_FOR_EXISTENCE_COMPLETED:"checkForExistenceCompleted"},load:function(b){b?d.call(this,b,a):this.notify(this.eventList.ENAME_LOADING_COMPLETED,b,null,new Error("request is null"))},checkForExistence:function(a){return a?void e.call(this,a):void this.notify(this.eventList.ENAME_CHECK_FOR_EXISTENCE_COMPLETED,!1,a)},abort:function(){var a,b,d=c.length;for(a=0;d>a;a+=1)b=c[a],c[a]=null,b.abort(),b=null;c=[]}}},MediaPlayer.dependencies.FragmentLoader.prototype={constructor:MediaPlayer.dependencies.FragmentLoader},MediaPlayer.dependencies.FragmentModel=function(){"use strict";var a,b=[],c=[],d=[],e=[],f=!1,g=function(a){var b=this;b.notify(b.eventList.ENAME_FRAGMENT_LOADING_STARTED,a),b.fragmentLoader.load(a)},h=function(a){var c=b.indexOf(a);-1!==c&&b.splice(c,1)},i=function(a,b){var c,d=a.length-1,e=NaN,f=NaN,g=null;for(c=d;c>=0;c-=1)if(g=a[c],e=g.startTime,f=e+g.duration,!isNaN(e)&&!isNaN(f)&&b>=e&&f>b||isNaN(e)&&isNaN(b))return g;return null},j=function(a,b){if(a){var c=a.mediaType,d=new Date,e=a.type,f=a.startTime,g=a.availabilityStartTime,h=a.duration,i=a.quality,j=a.range;this.metricsModel.addSchedulingInfo(c,d,e,f,g,h,i,j,b)}},k=function(a,c,e,f){d.splice(d.indexOf(c),1),e&&!f?(b.push(c),j.call(this,c,MediaPlayer.vo.metrics.SchedulingInfo.EXECUTED_STATE),this.notify(this.eventList.ENAME_FRAGMENT_LOADING_COMPLETED,c,e)):(j.call(this,c,MediaPlayer.vo.metrics.SchedulingInfo.FAILED_STATE),this.notify(this.eventList.ENAME_FRAGMENT_LOADING_FAILED,c))},l=function(a,b,c){var d=this.getExecutedRequestForQualityAndIndex(b,c);d&&(this.removeExecutedRequest(d),isNaN(c)||(e.push(d),j.call(this,d,MediaPlayer.vo.metrics.SchedulingInfo.REJECTED_STATE)))},m=function(){f=!0},n=function(){f=!1};return{system:void 0,debug:void 0,metricsModel:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_STREAM_COMPLETED:"streamCompleted",ENAME_FRAGMENT_LOADING_STARTED:"fragmentLoadingStarted",ENAME_FRAGMENT_LOADING_COMPLETED:"fragmentLoadingCompleted",ENAME_FRAGMENT_LOADING_FAILED:"fragmentLoadingFailed"},setup:function(){this.bufferLevelOutrun=m,this.bufferLevelBalanced=n,this.bytesRejected=l,this.loadingCompleted=k},setLoader:function(a){this.fragmentLoader=a},setContext:function(b){a=b},getContext:function(){return a},getIsPostponed:function(){return f},addRequest:function(a){return!a||this.isFragmentLoadedOrPending(a)?!1:(c.push(a),j.call(this,a,MediaPlayer.vo.metrics.SchedulingInfo.PENDING_STATE),!0)},isFragmentLoadedOrPending:function(a){var e=function(a,b){return"complete"===a.action&&a.action===b.action},f=function(a,b){return a.url===b.url&&a.startTime===b.startTime},g=function(a,b){return isNaN(a.index)&&isNaN(b.index)&&a.quality===b.quality},h=function(b){var c,d,h=!1,i=b.length;for(d=0;i>d;d+=1)if(c=b[d],f(a,c)||g(a,c)||e(a,c)){h=!0;break}return h};return h(c)||h(d)||h(b)},getPendingRequests:function(){return c},getLoadingRequests:function(){return d},getExecutedRequests:function(){return b},getRejectedRequests:function(){return e},getLoadingTime:function(){var a,c,d=0;for(c=b.length-1;c>=0;c-=1)if(a=b[c],a.requestEndDate instanceof Date&&a.firstByteDate instanceof Date){d=a.requestEndDate.getTime()-a.firstByteDate.getTime();break}return d},getExecutedRequestForTime:function(a){return i(b,a)},getPendingRequestForTime:function(a){return i(c,a)},getLoadingRequestForTime:function(a){return i(d,a)},getExecutedRequestForQualityAndIndex:function(a,c){var d,e=b.length-1,f=null;for(d=e;d>=0;d-=1)if(f=b[d],f.quality===a&&f.index===c)return f;return null},removeExecutedRequest:function(a){h.call(this,a)},removeExecutedRequestsBeforeTime:function(a){var c,d=b.length-1,e=NaN,f=null;for(c=d;c>=0;c-=1)f=b[c],e=f.startTime,!isNaN(e)&&a>e&&h.call(this,f)},cancelPendingRequests:function(a){var b=this,d=c,e=d;return c=[],void 0!==a&&(c=d.filter(function(b){return b.quality===a?!1:(e.splice(e.indexOf(b),1),!0)})),e.forEach(function(a){j.call(b,a,MediaPlayer.vo.metrics.SchedulingInfo.CANCELED_STATE)}),e},abortRequests:function(){this.fragmentLoader.abort();for(var a=0,b=d.length;b>a;a+=1)this.removeExecutedRequest(d[a]);d=[]},executeRequest:function(a){var e=this,f=c.indexOf(a);if(a&&-1!==f)switch(c.splice(f,1),a.action){case"complete":b.push(a),j.call(e,a,MediaPlayer.vo.metrics.SchedulingInfo.EXECUTED_STATE),e.notify(e.eventList.ENAME_STREAM_COMPLETED,a);break;case"download":d.push(a),j.call(e,a,MediaPlayer.vo.metrics.SchedulingInfo.LOADING_STATE),g.call(e,a);break;default:this.debug.log("Unknown request action.")}}}},MediaPlayer.dependencies.FragmentModel.prototype={constructor:MediaPlayer.dependencies.FragmentModel},MediaPlayer.dependencies.LiveEdgeFinder=function(){"use strict";var a,b=!1,c=function(a){var b=a.value,c=((new Date).getTime()-this.streamProcessor.getStreamInfo().manifestInfo.loadedTime.getTime())/1e3;null!==b?this.notify(this.eventList.ENAME_LIVE_EDGE_FOUND,b,c):this.notify(this.eventList.ENAME_LIVE_EDGE_SEARCH_ERROR,c)},d=function(){if(this.streamProcessor.isDynamic()&&!b){var d=this;a=d.scheduleRulesCollection.getRules(MediaPlayer.rules.ScheduleRulesCollection.prototype.LIVE_EDGE_RULES),b=!0,this.rulesController.applyRules(a,d.streamProcessor,c.bind(d),null,function(a,b){return b})}};return{system:void 0,scheduleRulesCollection:void 0,rulesController:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_LIVE_EDGE_FOUND:"liveEdgeFound",ENAME_LIVE_EDGE_SEARCH_ERROR:"liveEdgeSearchError"},setup:function(){this.streamUpdated=d},initialize:function(a){this.streamProcessor=a,this.fragmentLoader=a.fragmentLoader,this.scheduleRulesCollection.liveEdgeBinarySearchRule&&this.scheduleRulesCollection.liveEdgeBinarySearchRule.setFinder(this)},abortSearch:function(){if(b=!1,a)for(var c=0,d=a.length;d>c;c+=1)a[c].reset()}}},MediaPlayer.dependencies.LiveEdgeFinder.prototype={constructor:MediaPlayer.dependencies.LiveEdgeFinder},MediaPlayer.dependencies.ManifestLoader=function(){"use strict";var a=3,b=500,c=function(a){var b=null;return-1!==a.indexOf("/")&&(-1!==a.indexOf("?")&&(a=a.substring(0,a.indexOf("?"))),b=a.substring(0,a.lastIndexOf("/")+1)),b},d=function(a,e){var f,g=c(a),h=new XMLHttpRequest,i=new Date,j=null,k=!0,l=null,m=null,n=this;l=function(){h.status<200||h.status>299||(k=!1,j=new Date,n.tokenAuthentication.checkRequestHeaderForToken(h),n.metricsModel.addHttpRequest("stream",null,"MPD",a,null,null,i,j,h.status,null,null),f=n.parser.parse(h.responseText,g),f?(f.url=a,f.loadedTime=j,n.metricsModel.addManifestUpdate("stream",f.type,i,j,f.availabilityStartTime),n.notify(n.eventList.ENAME_MANIFEST_LOADED,f)):n.notify(n.eventList.ENAME_MANIFEST_LOADED,null,new Error("Failed loading manifest: "+a)))},m=function(){k&&(k=!1,n.metricsModel.addHttpRequest("stream",null,"MPD",a,null,null,i,new Date,h.status,null,null),e>0?(n.debug.log("Failed loading manifest: "+a+", retry in "+b+"ms attempts: "+e),e--,setTimeout(function(){d.call(n,a,e)},b)):(n.debug.log("Failed loading manifest: "+a+" no retry attempts left"),n.errHandler.downloadError("manifest",a,h),n.notify(n.eventList.ENAME_MANIFEST_LOADED,null,new Error("Failed loading manifest: "+a+" no retry attempts left"))))};try{h.onload=l,h.onloadend=m,h.onerror=m,h.open("GET",a,!0),h.send()}catch(o){h.onerror()}};return{debug:void 0,parser:void 0,errHandler:void 0,metricsModel:void 0,tokenAuthentication:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_MANIFEST_LOADED:"manifestLoaded"},load:function(b){d.call(this,b,a)}}},MediaPlayer.dependencies.ManifestLoader.prototype={constructor:MediaPlayer.dependencies.ManifestLoader},MediaPlayer.models.ManifestModel=function(){"use strict";var a;return{system:void 0,eventBus:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_MANIFEST_UPDATED:"manifestUpdated"},getValue:function(){return a},setValue:function(b){a=b,this.eventBus.dispatchEvent({type:"manifestLoaded",data:b}),this.notify(this.eventList.ENAME_MANIFEST_UPDATED,b)}}},MediaPlayer.models.ManifestModel.prototype={constructor:MediaPlayer.models.ManifestModel},MediaPlayer.dependencies.ManifestUpdater=function(){"use strict";var a=NaN,b=null,c=!1,d=!1,e=function(){null!==b&&(clearInterval(b),b=null)},f=function(){e.call(this),isNaN(a)||(this.debug.log("Refresh manifest in "+a+" seconds."),b=setTimeout(h.bind(this),Math.min(1e3*a,Math.pow(2,31)-1),this))},g=function(){var b,c,d=this,e=d.manifestModel.getValue();void 0!==e&&null!==e&&(b=d.manifestExt.getRefreshDelay(e),c=((new Date).getTime()-e.loadedTime.getTime())/1e3,a=Math.max(b-c,0),f.call(d))},h=function(){var a,b,c=this;d||(d=!0,a=c.manifestModel.getValue(),b=a.url,a.hasOwnProperty("Location")&&(b=a.Location),c.manifestLoader.load(b))},i=function(a,b,d){d||(this.manifestModel.setValue(b),this.debug.log("Manifest has been refreshed."),c||g.call(this))},j=function(){this.start()},k=function(){this.stop()},l=function(){d=!1};return{debug:void 0,system:void 0,manifestModel:void 0,manifestExt:void 0,manifestLoader:void 0,setup:function(){g.call(this),this.streamsComposed=l,this.manifestLoaded=i,this.playbackStarted=j,this.playbackPaused=k},start:function(){c=!1,g.call(this)},stop:function(){c=!0,e.call(this)}}},MediaPlayer.dependencies.ManifestUpdater.prototype={constructor:MediaPlayer.dependencies.ManifestUpdater},MediaPlayer.dependencies.MediaSourceExtensions=function(){"use strict"},MediaPlayer.dependencies.MediaSourceExtensions.prototype={constructor:MediaPlayer.dependencies.MediaSourceExtensions,createMediaSource:function(){"use strict";var a="WebKitMediaSource"in window,b="MediaSource"in window;return b?new MediaSource:a?new WebKitMediaSource:null},attachMediaSource:function(a,b){"use strict";b.setSource(window.URL.createObjectURL(a))},detachMediaSource:function(a){"use strict";a.setSource("")},setDuration:function(a,b){"use strict";return a.duration=b,a.duration},signalEndOfStream:function(a){"use strict";"open"===a.readyState&&a.endOfStream()}},MediaPlayer.models.MetricsModel=function(){"use strict";return{system:void 0,eventBus:void 0,adapter:void 0,streamMetrics:{},metricsChanged:function(){this.eventBus.dispatchEvent({type:"metricsChanged",data:{}})},metricChanged:function(a){this.eventBus.dispatchEvent({type:"metricChanged",data:{stream:a}}),this.metricsChanged()},metricUpdated:function(a,b,c){this.eventBus.dispatchEvent({type:"metricUpdated",data:{stream:a,metric:b,value:c}}),this.metricChanged(a)},metricAdded:function(a,b,c){this.eventBus.dispatchEvent({type:"metricAdded",data:{stream:a,metric:b,value:c}}),this.metricChanged(a)},clearCurrentMetricsForType:function(a){delete this.streamMetrics[a],this.metricChanged(a)},clearAllCurrentMetrics:function(){var a=this;this.streamMetrics={},this.metricsChanged.call(a)},getReadOnlyMetricsFor:function(a){return this.streamMetrics.hasOwnProperty(a)?this.streamMetrics[a]:null},getMetricsFor:function(a){var b;return this.streamMetrics.hasOwnProperty(a)?b=this.streamMetrics[a]:(b=this.system.getObject("metrics"),this.streamMetrics[a]=b),b},addTcpConnection:function(a,b,c,d,e,f){var g=new MediaPlayer.vo.metrics.TCPConnection;return g.tcpid=b,g.dest=c,g.topen=d,g.tclose=e,g.tconnect=f,this.getMetricsFor(a).TcpList.push(g),this.metricAdded(a,this.adapter.metricsList.TCP_CONNECTION,g),g},addHttpRequest:function(a,b,c,d,e,f,g,h,i,j,k,l){var m=new MediaPlayer.vo.metrics.HTTPRequest;return m.stream=a,m.tcpid=b,m.type=c,m.url=d,m.actualurl=e,m.range=f,m.trequest=g,m.tresponse=h,m.tfinish=i,m.responsecode=j,m.interval=k,m.mediaduration=l,this.getMetricsFor(a).HttpList.push(m),this.metricAdded(a,this.adapter.metricsList.HTTP_REQUEST,m),m},appendHttpTrace:function(a,b,c,d){var e=new MediaPlayer.vo.metrics.HTTPRequest.Trace;return e.s=b,e.d=c,e.b=d,a.trace.push(e),this.metricUpdated(a.stream,this.adapter.metricsList.HTTP_REQUEST_TRACE,a),e},addTrackSwitch:function(a,b,c,d,e){var f=new MediaPlayer.vo.metrics.TrackSwitch;return f.t=b,f.mt=c,f.to=d,f.lto=e,this.getMetricsFor(a).RepSwitchList.push(f),this.metricAdded(a,this.adapter.metricsList.TRACK_SWITCH,f),f},addBufferLevel:function(a,b,c){var d=new MediaPlayer.vo.metrics.BufferLevel;return d.t=b,d.level=c,this.getMetricsFor(a).BufferLevel.push(d),this.metricAdded(a,this.adapter.metricsList.BUFFER_LEVEL,d),d},addDVRInfo:function(a,b,c,d){var e=new MediaPlayer.vo.metrics.DVRInfo;return e.time=b,e.range=d,e.manifestInfo=c,this.getMetricsFor(a).DVRInfo.push(e),this.metricAdded(a,this.adapter.metricsList.DVR_INFO,e),e},addDroppedFrames:function(a,b){var c=new MediaPlayer.vo.metrics.DroppedFrames,d=this.getMetricsFor(a).DroppedFrames;return c.time=b.creationTime,c.droppedFrames=b.droppedVideoFrames,d.length>0&&d[d.length-1]==c?d[d.length-1]:(d.push(c),this.metricAdded(a,this.adapter.metricsList.DROPPED_FRAMES,c),c)},addSchedulingInfo:function(a,b,c,d,e,f,g,h,i){var j=new MediaPlayer.vo.metrics.SchedulingInfo;return j.mediaType=a,j.t=b,j.type=c,j.startTime=d,j.availabilityStartTime=e,j.duration=f,j.quality=g,j.range=h,j.state=i,this.getMetricsFor(a).SchedulingInfo.push(j),this.metricAdded(a,this.adapter.metricsList.SCHEDULING_INFO,j),j},addManifestUpdate:function(a,b,c,d,e,f,g,h,i,j){var k=new MediaPlayer.vo.metrics.ManifestUpdate,l=this.getMetricsFor("stream");return k.mediaType=a,k.type=b,k.requestTime=c,k.fetchTime=d,k.availabilityStartTime=e,k.presentationStartTime=f,k.clientTimeOffset=g,k.currentTime=h,k.buffered=i,k.latency=j,l.ManifestUpdate.push(k),this.metricAdded(a,this.adapter.metricsList.MANIFEST_UPDATE,k),k},updateManifestUpdateInfo:function(a,b){for(var c in b)a[c]=b[c];this.metricUpdated(a.mediaType,this.adapter.metricsList.MANIFEST_UPDATE,a)},addManifestUpdateStreamInfo:function(a,b,c,d,e){var f=new MediaPlayer.vo.metrics.ManifestUpdate.StreamInfo;return f.id=b,f.index=c,f.start=d,f.duration=e,a.streamInfo.push(f),this.metricUpdated(a.mediaType,this.adapter.metricsList.MANIFEST_UPDATE_STREAM_INFO,a),f},addManifestUpdateTrackInfo:function(a,b,c,d,e,f,g,h){var i=new MediaPlayer.vo.metrics.ManifestUpdate.TrackInfo;return i.id=b,i.index=c,i.streamIndex=d,i.mediaType=e,i.startNumber=g,i.fragmentInfoType=h,i.presentationTimeOffset=f,a.trackInfo.push(i),this.metricUpdated(a.mediaType,this.adapter.metricsList.MANIFEST_UPDATE_TRACK_INFO,a),i},addPlayList:function(a,b,c,d){var e=new MediaPlayer.vo.metrics.PlayList;return e.stream=a,e.start=b,e.mstart=c,e.starttype=d,this.getMetricsFor(a).PlayList.push(e),this.metricAdded(a,this.adapter.metricsList.PLAY_LIST,e),e},appendPlayListTrace:function(a,b,c,d,e,f,g,h){var i=new MediaPlayer.vo.metrics.PlayList.Trace;return i.representationid=b,i.subreplevel=c,i.start=d,i.mstart=e,i.duration=f,i.playbackspeed=g,i.stopreason=h,a.trace.push(i),this.metricUpdated(a.stream,this.adapter.metricsList.PLAY_LIST_TRACE,a),i}}},MediaPlayer.models.MetricsModel.prototype={constructor:MediaPlayer.models.MetricsModel},MediaPlayer.dependencies.Notifier=function(){"use strict";var a,b=0,c=function(){return this.id||(b+=1,this.id="_id_"+b),this.id},d=function(a){var b,c=this.eventList;for(b in c)if(c[b]===a)return!0;return!1};return{system:void 0,setup:function(){a=this.system,a.mapValue("notify",this.notify),a.mapValue("subscribe",this.subscribe),a.mapValue("unsubscribe",this.unsubscribe)},notify:function(){var b=[].slice.call(arguments);b.splice(1,0,this),b[0]+=c.call(this),a.notify.apply(a,b)},subscribe:function(b,e,f,g){if(!f&&e[b]&&(f=e[b]=e[b].bind(e)),!d.call(this,b))throw"object does not support given event "+b;if(!e)throw"observer object cannot be null or undefined";if(!f)throw"event handler cannot be null or undefined";b+=c.call(this),a.mapHandler(b,void 0,f,g)},unsubscribe:function(b,d,e){e=e||d[b],b+=c.call(this),a.unmapHandler(b,void 0,e)}}},MediaPlayer.dependencies.Notifier.prototype={constructor:MediaPlayer.dependencies.Notifier},MediaPlayer.dependencies.PlaybackController=function(){"use strict";var a,b,c,d,e,f=1e3,g=0,h=NaN,i=function(a){var b,c=parseInt(this.uriQueryFragModel.getURIFragmentData.s);return e?(!isNaN(c)&&c>1262304e3&&(b=c-a.manifestInfo.availableFrom.getTime()/1e3,(b>h||b<h-a.manifestInfo.DVRWindowSize)&&(b=null)),b=b||h):b=!isNaN(c)&&c<a.duration&&c>=0?c:a.start,b},j=function(){var a,c=this,e=c.getTime(),f=c.metricsModel.getMetricsFor(d.mediaInfo.type),g=c.metricsExt.getCurrentDVRInfo(f),h=g?g.range:null;return h?e>=h.start&&e<=h.end?e:a=Math.max(h.end-2*b.manifestInfo.minBufferTime,h.start):NaN},k=function(){var b=this,c=function(){A.call(b)};null!==a&&l.call(this),a=setInterval(c,f)},l=function(){clearInterval(a),a=null},m=function(){var a=i.call(this,b);this.debug.log("Starting playback at offset: "+a),this.seek(a)},n=function(){if(!this.isPaused()&&e){var a=this.getTime(),b=j.call(this),c=!isNaN(b)&&b!==a;c&&this.seek(b)}},o=function(a,c,f){d=this.adapter.convertDataToTrack(f),b=d.mediaInfo.streamInfo,e=a.streamProcessor.isDynamic(),n.call(this)},p=function(){0!==c.getElement().readyState&&m.call(this)},q=function(){c&&(c.unlisten("play",r),c.unlisten("pause",s),c.unlisten("error",z),c.unlisten("seeking",t),c.unlisten("seeked",u),c.unlisten("timeupdate",v),c.unlisten("progress",w),c.unlisten("ratechange",x),c.unlisten("loadedmetadata",y))},r=function(){n.call(this),this.notify(this.eventList.ENAME_PLAYBACK_STARTED,this.getTime())},s=function(){this.notify(this.eventList.ENAME_PLAYBACK_PAUSED)},t=function(){this.notify(this.eventList.ENAME_PLAYBACK_SEEKING,this.getTime(),!1)},u=function(){this.notify(this.eventList.ENAME_PLAYBACK_SEEKED)},v=function(){var a=this.getTime();a!==g&&(g=a,this.notify(this.eventList.ENAME_PLAYBACK_TIME_UPDATED,this.getTimeToStreamEnd()))},w=function(){var a,d,e,f=c.getElement().buffered;f.length&&(a=f.length-1,d=f.end(a),e=i.call(this,b)+b.duration-d),this.notify(this.eventList.ENAME_PLAYBACK_PROGRESS,c.getElement().buffered,e)},x=function(){this.notify(this.eventList.ENAME_PLAYBACK_RATE_CHANGED)},y=function(){this.debug.log("Got loadmetadata event."),(!e||this.timelineConverter.isTimeSyncCompleted())&&m.call(this),this.notify(this.eventList.ENAME_PLAYBACK_METADATA_LOADED),k.call(this)},z=function(a){this.notify(this.eventList.ENAME_PLAYBACK_ERROR,a.srcElement.error)},A=function(){this.notify(this.eventList.ENAME_WALLCLOCK_TIME_UPDATED,e,new Date)},B=function(a){c=a,c.listen("play",r),c.listen("pause",s),c.listen("error",z),c.listen("seeking",t),c.listen("seeked",u),c.listen("timeupdate",v),c.listen("progress",w),c.listen("ratechange",x),c.listen("loadedmetadata",y)};return{debug:void 0,timelineConverter:void 0,uriQueryFragModel:void 0,metricsModel:void 0,metricsExt:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,adapter:void 0,eventList:{ENAME_PLAYBACK_STARTED:"playbackStarted",ENAME_PLAYBACK_STOPPED:"playbackStopped",ENAME_PLAYBACK_PAUSED:"playbackPaused",ENAME_PLAYBACK_SEEKING:"playbackSeeking",ENAME_PLAYBACK_SEEKED:"playbackSeeked",ENAME_PLAYBACK_TIME_UPDATED:"playbackTimeUpdated",ENAME_PLAYBACK_PROGRESS:"playbackProgress",ENAME_PLAYBACK_RATE_CHANGED:"playbackRateChanged",ENAME_PLAYBACK_METADATA_LOADED:"playbackMetaDataLoaded",ENAME_PLAYBACK_ERROR:"playbackError",ENAME_WALLCLOCK_TIME_UPDATED:"wallclockTimeUpdated"},setup:function(){this.dataUpdateCompleted=o,this.liveEdgeFound=p,r=r.bind(this),s=s.bind(this),z=z.bind(this),t=t.bind(this),u=u.bind(this),v=v.bind(this),w=w.bind(this),x=x.bind(this),y=y.bind(this)},initialize:function(a,d){b=a,c!==d&&(q.call(this),B.call(this,d))},getTimeToStreamEnd:function(){var a=c.getCurrentTime();return i.call(this,b)+b.duration-a},getStreamId:function(){return b.id},getStreamDuration:function(){return b.duration},getTime:function(){return c.getCurrentTime()},getPlaybackRate:function(){return c.getPlaybackRate()},setLiveStartTime:function(a){h=a},start:function(){c.play()},isPaused:function(){return c.isPaused()},pause:function(){c&&c.pause()},isSeeking:function(){return c.getElement().seeking},seek:function(a){a!==this.getTime()&&(c.setCurrentTime(a),this.notify(this.eventList.ENAME_PLAYBACK_SEEKING,a,!0))},reset:function(){l.call(this),q.call(this),c=null,b=null,g=0,h=NaN}}},MediaPlayer.dependencies.PlaybackController.prototype={constructor:MediaPlayer.dependencies.PlaybackController},MediaPlayer.dependencies.ProtectionController=function(){"use strict";var a=null,b=null,c=function(a){var b=this;b.protectionModel.removeKeySystem(a)},d=function(a){for(var c=this,d=a.codec,e=a.contentProtection,f=0;f<b.length;++f)for(var g=0;g<e.length;++g)if(b[f].isSupported(e[g])&&c.protectionExt.supportsCodec(b[f].keysTypeString,d)){var h=e[g].KID;return h||(h="unknown"),c.protectionModel.addKeySystem(h,e[g],b[f]),c.debug.log("DRM: Selected Key System: "+b[f].keysTypeString+" For KID: "+h),h}throw new Error("DRM: The protection system for this content is not supported.")},e=function(a,b,c){var d=this,e=null,f=null;d.protectionModel.needToAddKeySession(a)&&(f=d.protectionModel.getInitData(a),!f&&c?(f=c,d.debug.log("DRM: Using initdata from needskey event. length: "+f.length)):f&&d.debug.log("DRM: Using initdata from prheader in mpd. length: "+f.length),f?(e=d.protectionModel.addKeySession(a,b,f),d.debug.log("DRM: Added Key Session ["+e.sessionId+"] for KID: "+a+" type: "+b+" initData length: "+f.length)):d.debug.log("DRM: initdata is null."))},f=function(a,b,c,d){this.protectionModel.updateFromMessage(a,b,c,d)};return{system:void 0,debug:void 0,capabilities:void 0,protectionModel:void 0,protectionExt:void 0,setup:function(){b=this.protectionExt.getKeySystems()},init:function(b,c){this.videoModel=b,this.protectionModel=c,a=this.videoModel.getElement()},selectKeySystem:d,ensureKeySession:e,updateFromMessage:f,teardownKeySystem:c}},MediaPlayer.dependencies.ProtectionController.prototype={constructor:MediaPlayer.dependencies.ProtectionController},MediaPlayer.dependencies.ProtectionExtensions=function(){"use strict"},MediaPlayer.dependencies.ProtectionExtensions.prototype={constructor:MediaPlayer.dependencies.ProtectionExtensions,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_KEY_SYSTEM_UPDATE_COMPLETED:"keySystemUpdateCompleted"},supportsCodec:function(a,b){"use strict";var c="WebKitMediaKeys"in window,d="MSMediaKeys"in window,e="MediaKeys"in window;return e?MediaKeys.isTypeSupported(a,b):c?WebKitMediaKeys.isTypeSupported(a,b):d?MSMediaKeys.isTypeSupported(a,b):!1},createMediaKeys:function(a){"use strict";var b="WebKitMediaKeys"in window,c="MSMediaKeys"in window,d="MediaKeys"in window;return d?new MediaKeys(a):b?new WebKitMediaKeys(a):c?new MSMediaKeys(a):null},setMediaKey:function(a,b){var c="WebKitSetMediaKeys"in a,d="msSetMediaKeys"in a,e="SetMediaKeys"in a;return e?a.SetMediaKeys(b):c?a.WebKitSetMediaKeys(b):d?a.msSetMediaKeys(b):void this.debug.log("no setmediakeys function in element")},createSession:function(a,b,c){return a.createSession(b,c)},getKeySystems:function(){var a=this,b=function(b,c){var d=null,e=[],f=new DOMParser,g=f.parseFromString(b,"application/xml");if(g.getElementsByTagName("Challenge")[0]){var h=g.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue;h&&(d=BASE64.decode(h))}else a.notify(a.eventList.ENAME_KEY_SYSTEM_UPDATE_COMPLETED,null,new Error("DRM: playready update, can not find Challenge in keyMessage"));var i=g.getElementsByTagName("name"),j=g.getElementsByTagName("value");i.length!=j.length&&a.notify(a.eventList.ENAME_KEY_SYSTEM_UPDATE_COMPLETED,null,new Error("DRM: playready update, invalid header name/value pair in keyMessage"));for(var k=0;k<i.length;k++)e[k]={name:i[k].childNodes[0].nodeValue,value:j[k].childNodes[0].nodeValue};var l=new XMLHttpRequest;l.onload=function(){200==l.status?a.notify(a.eventList.ENAME_KEY_SYSTEM_UPDATE_COMPLETED,new Uint8Array(l.response)):a.notify(a.eventList.ENAME_KEY_SYSTEM_UPDATE_COMPLETED,null,new Error('DRM: playready update, XHR status is "'+l.statusText+'" ('+l.status+"), expected to be 200. readyState is "+l.readyState))},l.onabort=function(){a.notify(a.eventList.ENAME_KEY_SYSTEM_UPDATE_COMPLETED,null,new Error('DRM: playready update, XHR aborted. status is "'+l.statusText+'" ('+l.status+"), readyState is "+l.readyState))},l.onerror=function(){a.notify(a.eventList.ENAME_KEY_SYSTEM_UPDATE_COMPLETED,null,new Error('DRM: playready update, XHR error. status is "'+l.statusText+'" ('+l.status+"), readyState is "+l.readyState))},l.open("POST",c),l.responseType="arraybuffer",e&&e.forEach(function(a){l.setRequestHeader(a.name,a.value)}),l.send(d)},c=function(a,b){return null===a&&0===b.length},d=function(a){var b=0,c=0,d=0,e=new Uint8Array([112,115,115,104,0,0,0,0]),f=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]),g=null,h=null,i=null,j=null;if("pro"in a)g=BASE64.decodeArray(a.pro.__text);else{if(!("prheader"in a))return null;g=BASE64.decodeArray(a.prheader.__text)}return c=g.length,d=4+e.length+f.length+4+c,h=new ArrayBuffer(d),i=new Uint8Array(h),j=new DataView(h),j.setUint32(b,d),b+=4,i.set(e,b),b+=e.length,i.set(f,b),b+=f.length,j.setUint32(b,c),b+=4,i.set(g,b),b+=c,i};return[{schemeIdUri:"urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95",keysTypeString:"com.microsoft.playready",isSupported:function(a){return this.schemeIdUri===a.schemeIdUri.toLowerCase()},needToAddKeySession:c,getInitData:d,getUpdate:b},{schemeIdUri:"urn:mpeg:dash:mp4protection:2011",keysTypeString:"com.microsoft.playready",
isSupported:function(a){return this.schemeIdUri===a.schemeIdUri.toLowerCase()&&"cenc"===a.value.toLowerCase()},needToAddKeySession:c,getInitData:function(){return null},getUpdate:b},{schemeIdUri:"urn:uuid:00000000-0000-0000-0000-000000000000",keysTypeString:"webkit-org.w3.clearkey",isSupported:function(a){return this.schemeIdUri===a.schemeIdUri.toLowerCase()},needToAddKeySession:function(){return!0},getInitData:function(){return null},getUpdate:function(a){return a}}]},addKey:function(a,b,c,d,e){a.webkitAddKey(b,c,d,e)},generateKeyRequest:function(a,b,c){a.webkitGenerateKeyRequest(b,c)},listenToNeedKey:function(a,b){a.listen("webkitneedkey",b),a.listen("msneedkey",b),a.listen("needKey",b)},listenToKeyError:function(a,b){a.addEventListener("webkitkeyerror",b,!1),a.addEventListener("mskeyerror",b,!1),a.addEventListener("keyerror",b,!1)},listenToKeyMessage:function(a,b){a.addEventListener("webkitkeymessage",b,!1),a.addEventListener("mskeymessage",b,!1),a.addEventListener("keymessage",b,!1)},listenToKeyAdded:function(a,b){a.addEventListener("webkitkeyadded",b,!1),a.addEventListener("mskeyadded",b,!1),a.addEventListener("keyadded",b,!1)},unlistenToKeyError:function(a,b){a.removeEventListener("webkitkeyerror",b),a.removeEventListener("mskeyerror",b),a.removeEventListener("keyerror",b)},unlistenToKeyMessage:function(a,b){a.removeEventListener("webkitkeymessage",b),a.removeEventListener("mskeymessage",b),a.removeEventListener("keymessage",b)},unlistenToKeyAdded:function(a,b){a.removeEventListener("webkitkeyadded",b),a.removeEventListener("mskeyadded",b),a.removeEventListener("keyadded",b)}},MediaPlayer.models.ProtectionModel=function(){"use strict";var a,b=null,c=null,d=null,e=null,f=[],g=function(b,c,d){d||a.update(c)};return{system:void 0,protectionExt:void 0,setup:function(){this.keySystemUpdateCompleted=g},init:function(a){this.videoModel=a,b=this.videoModel.getElement()},addKeySession:function(a,b,g){var h=null;return h=this.protectionExt.createSession(f[a].keys,b,g),this.protectionExt.listenToKeyAdded(h,c),this.protectionExt.listenToKeyError(h,d),this.protectionExt.listenToKeyMessage(h,e),f[a].initData=g,f[a].keySessions.push(h),h},addKeySystem:function(a,c,d){var e=null;e=this.protectionExt.createMediaKeys(d.keysTypeString),this.protectionExt.setMediaKey(b,e),f[a]={kID:a,contentProtection:c,keySystem:d,keys:e,initData:null,keySessions:[]}},removeKeySystem:function(a){if(null!==a&&void 0!==f[a]&&0!==f[a].keySessions.length){for(var b=f[a].keySessions,g=0;g<b.length;++g)this.protectionExt.unlistenToKeyError(b[g],d),this.protectionExt.unlistenToKeyAdded(b[g],c),this.protectionExt.unlistenToKeyMessage(b[g],e),b[g].close();f[a]=void 0}},needToAddKeySession:function(a){var b=null;return b=f[a],b.keySystem.needToAddKeySession(b.initData,b.keySessions)},getInitData:function(a){var b=null;return b=f[a],b.keySystem.getInitData(b.contentProtection)},updateFromMessage:function(b,c,d,e){a=c,f[b].keySystem.getUpdate(d,e)},listenToNeedKey:function(a){this.protectionExt.listenToNeedKey(this.videoModel,a)},listenToKeyError:function(a){d=a;for(var b=0;b<f.length;++b)for(var c=f[b].keySessions,e=0;e<c.length;++e)this.protectionExt.listenToKeyError(c[e],a)},listenToKeyMessage:function(a){e=a;for(var b=0;b<f.length;++b)for(var c=f[b].keySessions,d=0;d<c.length;++d)this.protectionExt.listenToKeyMessage(c[d],a)},listenToKeyAdded:function(a){c=a;for(var b=0;b<f.length;++b)for(var d=f[b].keySessions,e=0;e<d.length;++e)this.protectionExt.listenToKeyAdded(d[e],a)}}},MediaPlayer.models.ProtectionModel.prototype={constructor:MediaPlayer.models.ProtectionModel},MediaPlayer.dependencies.ScheduleController=function(){"use strict";var a,b,c,d,e,f=0,g=!0,h=null,i=!1,j=null,k=null,l=!0,m=function(a,b){var c=0,d=null;l===!1&&(d=k.start,c=a.getTime()-d.getTime(),k.duration=c,k.stopreason=b,l=!0)},n=function(){if(b){i=!1;var c=new Date;m(c,MediaPlayer.vo.metrics.PlayList.Trace.USER_REQUEST_STOP_REASON),j=this.metricsModel.addPlayList(a,c,0,MediaPlayer.vo.metrics.PlayList.INITIAL_PLAY_START_REASON),g&&(g=!1),this.debug.log("ScheduleController "+a+" start."),w.call(this)}},o=function(){g&&r.call(this,e.quality),n.call(this)},p=function(b){i||(i=!0,this.debug.log("ScheduleController "+a+" stop."),b&&this.fragmentController.cancelPendingRequestsForModel(c),m(new Date,MediaPlayer.vo.metrics.PlayList.Trace.USER_REQUEST_STOP_REASON))},q=function(a){var b=this,c=b.scheduleRulesCollection.getRules(MediaPlayer.rules.ScheduleRulesCollection.prototype.NEXT_FRAGMENT_RULES);b.rulesController.applyRules(c,b.streamProcessor,a,null,function(a,b){return b})},r=function(a){var b,c=this;return b=c.adapter.getInitRequest(c.streamProcessor,a),null!==b&&c.fragmentController.prepareFragmentForLoading(c,b),b},s=function(a){var b=this,c=b.scheduleRulesCollection.getRules(MediaPlayer.rules.ScheduleRulesCollection.prototype.FRAGMENTS_TO_SCHEDULE_RULES);b.rulesController.applyRules(c,b.streamProcessor,a,f,function(a,b){return Math.min(a,b)})},t=function(a){var b,c,d,f=a.length;for(d=0;f>d;d+=1)b=a[d],c=b.startTime+b.duration/2,b=this.adapter.getFragmentRequestForTime(this.streamProcessor,e,c,!1),this.fragmentController.prepareFragmentForLoading(this,b)},u=function(a){var b=this;return f=a.value,0>=f?void b.fragmentController.executePendingRequests():(b.abrController.getPlaybackQuality(b.streamProcessor),void q.call(b,v.bind(b)))},v=function(a){var b=a.value;null===b||b instanceof MediaPlayer.vo.FragmentRequest||(b=this.adapter.getFragmentRequestForTime(this.streamProcessor,e,b.startTime)),b&&(f--,this.fragmentController.prepareFragmentForLoading(this,b))},w=function(){var a=(new Date).getTime(),b=h?a-h>this.fragmentController.getLoadingTime(this):!0;!b||i||this.playbackController.isPaused()&&(!this.scheduleWhilePaused||d)||(h=a,s.call(this,u.bind(this)))},x=function(){var b=this;null!==a&&""!==a&&b.metricsModel.clearCurrentMetricsForType(a)},y=function(a,c,f){e=this.adapter.convertDataToTrack(f),d||(b=!0),b&&o.call(this)},z=function(b,c){c===this.streamProcessor.getFragmentModel()&&(this.debug.log(a+" Stream is complete."),m(new Date,MediaPlayer.vo.metrics.PlayList.Trace.END_OF_CONTENT_STOP_REASON))},A=function(a,b){var c=this;b===c.streamProcessor.getFragmentModel()&&w.call(c)},B=function(){p.call(this)},C=function(){K.call(this)},D=function(){p.call(this,!1)},E=function(a,b){r.call(this,b)},F=function(a,b,d,e){this.fragmentController.removeExecutedRequestsBeforeTime(c,d),e&&n.call(this)},G=function(b,c){var d=this;c||d.playbackController.isSeeking()||(d.debug.log("Stalling "+a+" Buffer: "+a),m(new Date,MediaPlayer.vo.metrics.PlayList.Trace.REBUFFERING_REASON))},H=function(b,c){var d=this;d.metricsModel.addBufferLevel(a,new Date,c),w.call(this)},I=function(){p.call(this,!1)},J=function(b,d,f,g){if(a===d){var h,i=this;if(h=c.cancelPendingRequests(f),e=i.streamProcessor.getTrackForQuality(g),null===e||void 0===e)throw"Unexpected error!";t.call(i,h),m(new Date,MediaPlayer.vo.metrics.PlayList.Trace.REPRESENTATION_SWITCH_STOP_REASON)}},K=function(){var a=this,b=a.playbackController.getTime(),c=a.playbackController.getPlaybackRate(),d=new Date;l===!0&&e&&j&&(l=!1,k=a.metricsModel.appendPlayListTrace(j,e.id,null,d,b,null,c,null))},L=function(a,b){var d=this,e=r.call(d,b);c.executeRequest(e)},M=function(){n.call(this)},N=function(b,d){g||this.fragmentController.cancelPendingRequestsForModel(c);var f,h=this.metricsModel.getMetricsFor("stream"),i=this.metricsExt.getCurrentManifestUpdate(h);this.debug.log("ScheduleController "+a+" seek: "+d),f=new Date,m(f,MediaPlayer.vo.metrics.PlayList.Trace.USER_REQUEST_STOP_REASON),j=this.metricsModel.addPlayList(a,f,d,MediaPlayer.vo.metrics.PlayList.SEEK_START_REASON),n.call(this),this.metricsModel.updateManifestUpdateInfo(i,{latency:e.DVRWindow.end-this.playbackController.getTime()})},O=function(){K.call(this)},P=function(){w.call(this)},Q=function(a,c){var d,f,g=this,h=e.mediaInfo.streamInfo.manifestInfo,i=c-Math.min(2*h.minBufferTime,h.DVRWindowSize/2),j=g.metricsModel.getMetricsFor("stream"),k=g.metricsExt.getCurrentManifestUpdate(j);d=g.adapter.getFragmentRequestForTime(g.streamProcessor,e,i),f=d.startTime+d.duration/2,g.playbackController.setLiveStartTime(f),g.metricsModel.updateManifestUpdateInfo(k,{currentTime:f,presentationStartTime:c,latency:c-f,clientTimeOffset:g.timelineConverter.getClientTimeOffset()}),b=!0,o.call(g)};return{debug:void 0,system:void 0,metricsModel:void 0,metricsExt:void 0,scheduleWhilePaused:void 0,timelineConverter:void 0,abrController:void 0,adapter:void 0,scheduleRulesCollection:void 0,rulesController:void 0,eventList:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,setup:function(){this.liveEdgeFound=Q,this.qualityChanged=J,this.dataUpdateStarted=D,this.dataUpdateCompleted=y,this.mediaFragmentLoadingStart=A,this.fragmentLoadingFailed=B,this.streamCompleted=z,this.bufferCleared=F,this.bytesAppended=C,this.bufferLevelStateChanged=G,this.bufferLevelUpdated=H,this.initRequested=E,this.quotaExceeded=I,this.closedCaptioningRequested=L,this.playbackStarted=M,this.playbackSeeking=N,this.playbackRateChanged=O,this.wallclockTimeUpdated=P},initialize:function(b,e){var f=this;a=b,f.streamProcessor=e,f.playbackController=e.playbackController,f.fragmentController=e.fragmentController,f.liveEdgeFinder=e.liveEdgeFinder,f.bufferController=e.bufferController,d=e.isDynamic(),c=this.fragmentController.getModel(this),f.scheduleRulesCollection.bufferLevelRule&&f.scheduleRulesCollection.bufferLevelRule.setScheduleController(f),f.scheduleRulesCollection.pendingRequestsRule&&f.scheduleRulesCollection.pendingRequestsRule.setScheduleController(f),f.scheduleRulesCollection.playbackTimeRule&&f.scheduleRulesCollection.playbackTimeRule.setScheduleController(f)},getFragmentModel:function(){return c},reset:function(){var a=this;p.call(a,!0),a.bufferController.unsubscribe(a.bufferController.eventList.ENAME_BUFFER_LEVEL_OUTRUN,a.scheduleRulesCollection.bufferLevelRule),a.bufferController.unsubscribe(a.bufferController.eventList.ENAME_BUFFER_LEVEL_BALANCED,a.scheduleRulesCollection.bufferLevelRule),a.fragmentController.abortRequestsForModel(c),a.fragmentController.detachModel(c),x.call(a),f=0},start:n,stop:p}},MediaPlayer.dependencies.ScheduleController.prototype={constructor:MediaPlayer.dependencies.ScheduleController},MediaPlayer.dependencies.SourceBufferExtensions=function(){"use strict";this.system=void 0,this.errHandler=void 0,this.notify=void 0,this.subscribe=void 0,this.unsubscribe=void 0,this.eventList={ENAME_SOURCEBUFFER_REMOVE_COMPLETED:"sourceBufferRemoveCompleted",ENAME_SOURCEBUFFER_APPEND_COMPLETED:"sourceBufferAppendCompleted"}},MediaPlayer.dependencies.SourceBufferExtensions.prototype={constructor:MediaPlayer.dependencies.SourceBufferExtensions,createSourceBuffer:function(a,b){"use strict";var c=this,d=b.codec,e=null;try{e=a.addSourceBuffer(d)}catch(f){if(!b.isText)throw f;e=c.system.getObject("textSourceBuffer")}return e},removeSourceBuffer:function(a,b){"use strict";try{a.removeSourceBuffer(b)}catch(c){}},getBufferRange:function(a,b,c){"use strict";var d,e,f=null,g=0,h=0,i=null,j=null,k=0,l=c||.15;try{f=a.buffered}catch(m){return null}if(null!==f){for(e=0,d=f.length;d>e;e+=1)if(g=f.start(e),h=f.end(e),null===i)k=Math.abs(g-b),b>=g&&h>b?(i=g,j=h):l>=k&&(i=g,j=h);else{if(k=g-j,!(l>=k))break;j=h}if(null!==i)return{start:i,end:j}}return null},getAllRanges:function(a){var b=null;try{return b=a.buffered}catch(c){return null}},getBufferLength:function(a,b,c){"use strict";var d,e,f=this;return d=f.getBufferRange(a,b,c),e=null===d?0:d.end-b},waitForUpdateEnd:function(a,b){"use strict";var c,d=50,e=function(){a.updating||(clearInterval(c),b(!0))},f=function(){a.updating||(a.removeEventListener("updateend",f,!1),b(!0))};if(!a.updating)return void b(!0);if("function"==typeof a.addEventListener)try{a.addEventListener("updateend",f,!1)}catch(g){c=setInterval(e,d)}else c=setInterval(e,d)},append:function(a,b){var c=this,d="append"in a?"append":"appendBuffer"in a?"appendBuffer":null;if(d)try{c.waitForUpdateEnd(a,function(){a[d](b),c.waitForUpdateEnd(a,function(){c.notify(c.eventList.ENAME_SOURCEBUFFER_APPEND_COMPLETED,a,b)})})}catch(e){c.notify(c.eventList.ENAME_SOURCEBUFFER_APPEND_COMPLETED,a,b,e)}},remove:function(a,b,c,d){var e=this;try{b>=0&&c>b&&"ended"!==d.readyState&&a.remove(b,c),this.waitForUpdateEnd(a,function(){e.notify(e.eventList.ENAME_SOURCEBUFFER_REMOVE_COMPLETED,a,b,c)})}catch(f){e.notify(e.eventList.ENAME_SOURCEBUFFER_REMOVE_COMPLETED,a,b,c,f)}},abort:function(a,b){"use strict";try{"open"===a.readyState&&b.abort()}catch(c){}}},MediaPlayer.dependencies.Stream=function(){"use strict";var a,b,c,d,e,f,g={},h=[],i=!0,j=!1,k=!1,l=!1,m=null,n=[],o=!0,p=null,q=null,r=function(){j&&this.playbackController.start()},s=function(){this.playbackController.pause()},t=function(a){j&&(this.debug.log("Do seek: "+a),this.playbackController.seek(a))},u=function(a){var b,c=this,d=g.video,e=g?g.video.codec:null;if(b="msneedkey"!==a.type?a.type:e,n.push({type:b,initData:a.initData}),this.debug.log("DRM: Key required for - "+b),d&&e&&!m)try{m=c.protectionController.selectKeySystem(d)}catch(f){s.call(c),c.debug.log(f),c.errHandler.mediaKeySystemSelectionError(f)}m&&c.protectionController.ensureKeySession(m,b,a.initData)},v=function(a){var b=this,c=null,d=null,e=null,f=null;this.debug.log("DRM: Got a key message..."),c=a.target,d=new Uint16Array(a.message.buffer),e=String.fromCharCode.apply(null,d),f=a.destinationURL,b.protectionController.updateFromMessage(m,c,e,f)},w=function(){this.debug.log("DRM: Key added.")},x=function(){var a,b=event.target;switch(a="DRM: MediaKeyError - sessionId: "+b.sessionId+" errorCode: "+b.error.code+" systemErrorCode: "+b.error.systemCode+" [",b.error.code){case 1:a+="MEDIA_KEYERR_UNKNOWN - An unspecified error occurred. This value is used for errors that don't match any of the other codes.";break;case 2:a+="MEDIA_KEYERR_CLIENT - The Key System could not be installed or updated.";break;case 3:a+="MEDIA_KEYERR_SERVICE - The message passed into update indicated an error from the license service.";break;case 4:a+="MEDIA_KEYERR_OUTPUT - There is no available output device with the required characteristics for the content protection system.";break;case 5:a+="MEDIA_KEYERR_HARDWARECHANGE - A hardware configuration change caused a content protection error.";break;case 6:a+="MEDIA_KEYERR_DOMAIN - An error occurred in a multi-device domain licensing configuration. The most common error is a failure to join the domain."}a+="]",this.debug.log(a),this.errHandler.mediaKeySessionError(a)},y=function(a,b){var c=this,d=function(e){c.debug.log("MediaSource is open!"),c.debug.log(e),a.removeEventListener("sourceopen",d),a.removeEventListener("webkitsourceopen",d),b(a)};a.addEventListener("sourceopen",d,!1),a.addEventListener("webkitsourceopen",d,!1),c.mediaSourceExt.attachMediaSource(a,c.videoModel)},z=function(){var c,d=this,e=h.length,f=0;for(f;e>f;f+=1)c=h[f],c.reset(l),c=null;q&&q.reset(),h=[],b&&d.mediaSourceExt.detachMediaSource(d.videoModel),j=!1,m=null,n=[],g={},b=null,a=null},A=function(a,c){var d,e,f,i=this,j=function(a){return a.codec},k=i.adapter.getMediaInfoForType(c,p,a);if("text"===a&&(j=function(a){return d=a.mimeType}),null!==k){var l,m=j.call(i,k),n=null;if(m===d)try{n=i.sourceBufferExt.createSourceBuffer(b,k)}catch(o){i.errHandler.mediaSourceError("Error creating "+a+" source buffer.")}else if(e=m,i.debug.log(a+" codec: "+e),g[a]=k,l=k.contentProtection,l&&!i.capabilities.supportsMediaKeys())i.errHandler.capabilityError("mediakeys");else if(i.capabilities.supportsCodec(i.videoModel.getElement(),e))try{n=i.sourceBufferExt.createSourceBuffer(b,k)}catch(o){i.errHandler.mediaSourceError("Error creating "+a+" source buffer.")}else{var r=a+"Codec ("+e+") is not supported.";i.errHandler.manifestError(r,"codec",c),i.debug.log(r)}null===n?i.debug.log("No buffer was created, skipping "+a+" data."):(f=i.system.getObject("streamProcessor"),h.push(f),f.initialize(d||a,n,i.videoModel,i.fragmentController,i.playbackController,b,i,q),f.setMediaInfo(k),i.adapter.updateData(f))}else i.debug.log("No "+a+" data.")},B=function(){var b,c=this;q=c.system.getObject("eventController"),q.initialize(c.videoModel),b=c.adapter.getEventsFor(p),q.addInlineEvents(b),A.call(c,"video",a),A.call(c,"audio",a),A.call(c,"text",a)},C=function(){var a,c,d=this;a=p.manifestInfo.duration,c=d.mediaSourceExt.setDuration(b,a),d.debug.log("Duration successfully set to: "+c),j=!0,F.call(d)},D=function(){this.debug.log("element loaded!"),k=!0,E.call(this)},E=function(){j&&k&&0===p.index&&(q.start(),i&&r.call(this))},F=function(){var a=this,b=h.length,c=0;if(j){for(c;b>c;c+=1)if(h[c].isUpdating())return;o=!1,a.notify(a.eventList.ENAME_STREAM_UPDATED)}},G=function(a,b){var c=b.code,d="";if(-1!==c){switch(c){case 1:d="MEDIA_ERR_ABORTED";break;case 2:d="MEDIA_ERR_NETWORK";break;case 3:d="MEDIA_ERR_DECODE";break;case 4:d="MEDIA_ERR_SRC_NOT_SUPPORTED";break;case 5:d="MEDIA_ERR_ENCRYPTED"}l=!0,this.debug.log("Video Element Error: "+d),this.debug.log(b),this.errHandler.mediaSourceError(d),this.reset()}},H=function(c){var d,e=this,f=function(c){if(b=c,B.call(e),0===h.length){var d="No streams to play.";e.errHandler.manifestError(d,"nostreams",a),e.debug.log(d)}else e.liveEdgeFinder.initialize(h[0]),e.liveEdgeFinder.subscribe(e.liveEdgeFinder.eventList.ENAME_LIVE_EDGE_FOUND,e.playbackController),C.call(e),E.call(e)};a=c,d=e.mediaSourceExt.createMediaSource(),y.call(e,d,f)},I=function(){var a=L(),c=a.length,d=0;for(d;c>d;d+=1)if(!a[d].isBufferingCompleted())return;b&&this.mediaSourceExt.signalEndOfStream(b)},J=function(){F.call(this)},K=function(a,b,c){c&&(s.call(this),this.debug.log(c),this.errHandler.mediaKeyMessageError(c))},L=function(){var a,b,c=[],d=0,e=h.length;for(d;e>d;d+=1)b=h[d],a=b.getType(),("audio"===a||"video"===a)&&c.push(b);return c},M=function(b){var c,d,e,f=this,g=h.length,i=0;for(o=!0,a=f.manifestModel.getValue(),p=b,f.debug.log("Manifest updated... set new data on buffers."),q&&(d=f.adapter.getEventsFor(p),q.addInlineEvents(d)),i;g>i;i+=1)e=h[i],c=f.adapter.getMediaInfoForType(a,p,e.getType()),e.setMediaInfo(c),this.adapter.updateData(e)};return{system:void 0,manifestModel:void 0,mediaSourceExt:void 0,sourceBufferExt:void 0,adapter:void 0,fragmentController:void 0,playbackController:void 0,protectionModel:void 0,protectionController:void 0,protectionExt:void 0,capabilities:void 0,debug:void 0,errHandler:void 0,liveEdgeFinder:void 0,abrController:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_STREAM_UPDATED:"streamUpdated"},setup:function(){this.bufferingCompleted=I,this.dataUpdateCompleted=J,this.playbackError=G,this.playbackMetaDataLoaded=D,this.keySystemUpdateCompleted=K},load:function(a){H.call(this,a)},setVideoModel:function(a){this.videoModel=a},initProtection:function(){c=u.bind(this),d=v.bind(this),e=w.bind(this),f=x.bind(this),this.protectionModel=this.system.getObject("protectionModel"),this.protectionModel.init(this.getVideoModel()),this.protectionController=this.system.getObject("protectionController"),this.protectionController.init(this.videoModel,this.protectionModel),this.protectionModel.listenToNeedKey(c),this.protectionModel.listenToKeyMessage(d),this.protectionModel.listenToKeyError(f),this.protectionModel.listenToKeyAdded(e),this.protectionExt.subscribe(this.protectionExt.eventList.ENAME_KEY_SYSTEM_UPDATE_COMPLETED,this.protectionModel),this.protectionExt.subscribe(this.protectionExt.eventList.ENAME_KEY_SYSTEM_UPDATE_COMPLETED,this)},getVideoModel:function(){return this.videoModel},setAutoPlay:function(a){i=a},getAutoPlay:function(){return i},reset:function(){s.call(this),z.call(this),this.protectionController&&this.protectionController.teardownKeySystem(m),this.protectionModel&&this.protectionExt.unsubscribe(this.protectionExt.eventList.ENAME_KEY_SYSTEM_UPDATE_COMPLETED,this.protectionModel),this.protectionExt.unsubscribe(this.protectionExt.eventList.ENAME_KEY_SYSTEM_UPDATE_COMPLETED,this),this.protectionController=void 0,this.protectionModel=void 0,this.fragmentController=void 0,this.playbackController.unsubscribe(this.playbackController.eventList.ENAME_PLAYBACK_ERROR,this),this.playbackController.unsubscribe(this.playbackController.eventList.ENAME_PLAYBACK_METADATA_LOADED,this),this.playbackController.reset(),this.liveEdgeFinder.abortSearch(),this.liveEdgeFinder.unsubscribe(this.liveEdgeFinder.eventList.ENAME_LIVE_EDGE_FOUND,this.playbackController),k=!1},getDuration:function(){return p.duration},getStartTime:function(){return p.start},getStreamIndex:function(){return p.index},getId:function(){return p.id},setStreamInfo:function(a){p=a},getStreamInfo:function(){return p},startEventController:function(){q.start()},resetEventController:function(){q.reset()},setPlaybackController:function(a){this.playbackController=a,a.initialize(p,this.videoModel)},getPlaybackController:function(){return this.playbackController},isUpdating:function(){return o},updateData:M,play:r,seek:t,pause:s}},MediaPlayer.dependencies.Stream.prototype={constructor:MediaPlayer.dependencies.Stream},MediaPlayer.dependencies.StreamController=function(){"use strict";var a,b=[],c=6,d=.2,e=!0,f=!1,g=function(){a.play()},h=function(){a.pause()},i=function(b){a.seek(b)},j=function(a,b){var c=a.getVideoModel().getElement(),d=b.getVideoModel().getElement();d.parentNode||c.parentNode.insertBefore(d,c),c.style.width="0px",d.style.width="100%",m(c,d),l.call(this,a),k.call(this,b)},k=function(a){var b=a.getPlaybackController();b.subscribe(b.eventList.ENAME_PLAYBACK_STARTED,this.manifestUpdater),b.subscribe(b.eventList.ENAME_PLAYBACK_PAUSED,this.manifestUpdater),b.subscribe(b.eventList.ENAME_PLAYBACK_SEEKING,this),b.subscribe(b.eventList.ENAME_PLAYBACK_TIME_UPDATED,this),b.subscribe(b.eventList.ENAME_PLAYBACK_PROGRESS,this)},l=function(a){var b=this,c=a.getPlaybackController();setTimeout(function(){c.unsubscribe(c.eventList.ENAME_PLAYBACK_STARTED,b.manifestUpdater),c.unsubscribe(c.eventList.ENAME_PLAYBACK_PAUSED,b.manifestUpdater),c.unsubscribe(c.eventList.ENAME_PLAYBACK_SEEKING,b),c.unsubscribe(c.eventList.ENAME_PLAYBACK_TIME_UPDATED,b),c.unsubscribe(c.eventList.ENAME_PLAYBACK_PROGRESS,b)},1)},m=function(a,b){["controls","loop","muted","volume"].forEach(function(c){b[c]=a[c]})},n=function(a,b,d){!d||d>=c||q()},o=function(b,c){var e=this;e.metricsModel.addDroppedFrames("video",e.videoExt.getPlaybackQuality(a.getVideoModel().getElement())),r()&&(a.getVideoModel().getElement().seeking||d>c&&v.call(this,a,r()))},p=function(b,c){var d=s(c);d&&d!==a&&v.call(this,a,d,c)},q=function(){var a=r();a&&a.seek(a.getStartTime())},r=function(){var c=a.getStreamIndex()+1;return c<b.length?b[c]:null},s=function(a){var c=0,d=null,e=b.length;e>0&&(c+=b[0].getStartTime());for(var f=0;e>f;f++)if(d=b[f],c+=d.getDuration(),c>a)return d;return null},t=function(){var a=this.system.getObject("videoModel"),b=document.createElement("video");return a.setElement(b),a},u=function(a){a.parentNode&&a.parentNode.removeChild(a)},v=function(b,c,d){!f&&b&&c&&b!==c&&(f=!0,b.pause(),a=c,j.call(this,b,c),i(d?b.getPlaybackController().getTime():c.getStartTime()),g(),b.resetEventController(),a.startEventController(),f=!1)},w=function(){var c,d,f,g,h,i,j,l,m=this,n=m.manifestModel.getValue(),o=m.metricsModel.getMetricsFor("stream"),p=m.metricsExt.getCurrentManifestUpdate(o);if(n){j=m.adapter.getStreamsInfo(n);try{if(0===j.length)throw new Error("There are no streams");for(m.metricsModel.updateManifestUpdateInfo(p,{currentTime:m.videoModel.getCurrentTime(),buffered:m.videoModel.getElement().buffered,presentationStartTime:j[0].start,clientTimeOffset:m.timelineConverter.getClientTimeOffset()}),h=0,f=j.length;f>h;h+=1){for(d=j[h],i=0,g=b.length;g>i;i+=1)b[i].getId()===d.id&&(l=b[i],l.updateData(d));l||(l=m.system.getObject("stream"),c=m.system.getObject("playbackController"),l.setStreamInfo(d),l.setVideoModel(0===h?m.videoModel:t.call(m)),l.setPlaybackController(c),c.subscribe(c.eventList.ENAME_PLAYBACK_ERROR,l),c.subscribe(c.eventList.ENAME_PLAYBACK_METADATA_LOADED,l),l.initProtection(),l.setAutoPlay(e),l.load(n),l.subscribe(l.eventList.ENAME_STREAM_UPDATED,m),b.push(l)),m.metricsModel.addManifestUpdateStreamInfo(p,d.id,d.index,d.start,d.duration),l=null}a||(a=b[0],k.call(m,a),a.subscribe(a.eventList.ENAME_STREAM_UPDATED,this.liveEdgeFinder))}catch(q){m.errHandler.manifestError(q.message,"nostreamscomposed",m.manifestModel.getValue()),m.reset()}}},x=function(){var a=this,c=b.length,d=0;for(d;c>d;d+=1)if(b[d].isUpdating())return;a.notify(a.eventList.ENAME_STREAMS_COMPOSED)},y=function(a,b,c){c?this.reset():(this.manifestModel.setValue(b),this.debug.log("Manifest has loaded."),w.call(this))};return{system:void 0,videoModel:void 0,manifestLoader:void 0,manifestUpdater:void 0,manifestModel:void 0,adapter:void 0,debug:void 0,metricsModel:void 0,metricsExt:void 0,videoExt:void 0,liveEdgeFinder:void 0,timelineConverter:void 0,errHandler:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_STREAMS_COMPOSED:"streamsComposed"},setup:function(){this.manifestLoaded=y,this.streamUpdated=x,this.playbackSeeking=p,this.playbackProgress=n,this.playbackTimeUpdated=o},setAutoPlay:function(a){e=a},getAutoPlay:function(){return e},getVideoModel:function(){return this.videoModel},setVideoModel:function(a){this.videoModel=a},load:function(a){this.manifestLoader.load(a)},reset:function(){a&&l.call(this,a);for(var c=0,d=b.length;d>c;c++){var e=b[c];e.unsubscribe(e.eventList.ENAME_STREAM_UPDATED,this),e.reset(),e!==a&&u(e.getVideoModel().getElement())}b=[],this.manifestUpdater.stop(),this.metricsModel.clearAllCurrentMetrics(),this.manifestModel.setValue(null),this.timelineConverter.reset(),this.adapter.reset(),f=!1,a=null},play:g,seek:i,pause:h}},MediaPlayer.dependencies.StreamController.prototype={constructor:MediaPlayer.dependencies.StreamController},MediaPlayer.dependencies.StreamProcessor=function(){"use strict";var a,b,c,d,e,f=function(a){var b=this,c="video"===a||"audio"===a?"bufferController":"textController";return b.system.getObject(c)};return{system:void 0,indexHandler:void 0,liveEdgeFinder:void 0,timelineConverter:void 0,eventList:void 0,abrController:void 0,baseURLExt:void 0,adapter:void 0,initialize:function(c,g,h,i,j,k,l,m){var n,o=this,p=o.system.getObject("trackController"),q=o.system.getObject("scheduleController"),r=o.liveEdgeFinder,s=o.abrController,t=o.indexHandler,u=o.baseURLExt,v=this.system.getObject("fragmentLoader"),w=f.call(o,c);b=l,d=c,e=m,a=b.getStreamInfo().manifestInfo.isDynamic,o.bufferController=w,o.playbackController=j,o.scheduleController=q,o.trackController=p,o.videoModel=h,o.fragmentController=i,o.fragmentLoader=v,p.subscribe(p.eventList.ENAME_DATA_UPDATE_COMPLETED,w),i.subscribe(i.eventList.ENAME_INIT_FRAGMENT_LOADED,w),w.subscribe(w.eventList.ENAME_CLOSED_CAPTIONING_REQUESTED,q),("video"===d||"audio"===d)&&(s.subscribe(s.eventList.ENAME_QUALITY_CHANGED,w),s.subscribe(s.eventList.ENAME_QUALITY_CHANGED,p),s.subscribe(s.eventList.ENAME_QUALITY_CHANGED,q),r.subscribe(r.eventList.ENAME_LIVE_EDGE_FOUND,this.timelineConverter),r.subscribe(r.eventList.ENAME_LIVE_EDGE_FOUND,p),r.subscribe(r.eventList.ENAME_LIVE_EDGE_FOUND,q),p.subscribe(p.eventList.ENAME_DATA_UPDATE_STARTED,q),p.subscribe(p.eventList.ENAME_DATA_UPDATE_COMPLETED,q),p.subscribe(p.eventList.ENAME_DATA_UPDATE_COMPLETED,s),p.subscribe(p.eventList.ENAME_DATA_UPDATE_COMPLETED,b),j.streamProcessor||(j.streamProcessor=o,p.subscribe(p.eventList.ENAME_DATA_UPDATE_COMPLETED,j)),i.subscribe(i.eventList.ENAME_MEDIA_FRAGMENT_LOADED,w),i.subscribe(i.eventList.ENAME_MEDIA_FRAGMENT_LOADING_START,q),i.subscribe(i.eventList.ENAME_STREAM_COMPLETED,q),i.subscribe(i.eventList.ENAME_STREAM_COMPLETED,w),i.subscribe(i.eventList.ENAME_STREAM_COMPLETED,q.scheduleRulesCollection.bufferLevelRule),w.subscribe(w.eventList.ENAME_BUFFER_LEVEL_STATE_CHANGED,h),w.subscribe(w.eventList.ENAME_BUFFER_CLEARED,q),w.subscribe(w.eventList.ENAME_BYTES_APPENDED,q),w.subscribe(w.eventList.ENAME_BUFFER_LEVEL_UPDATED,q),w.subscribe(w.eventList.ENAME_BUFFER_LEVEL_UPDATED,p),w.subscribe(w.eventList.ENAME_BUFFER_LEVEL_STATE_CHANGED,q),w.subscribe(w.eventList.ENAME_INIT_REQUESTED,q),w.subscribe(w.eventList.ENAME_BUFFERING_COMPLETED,b),w.subscribe(w.eventList.ENAME_QUOTA_EXCEEDED,q),w.subscribe(w.eventList.ENAME_BUFFER_LEVEL_OUTRUN,q.scheduleRulesCollection.bufferLevelRule),w.subscribe(w.eventList.ENAME_BUFFER_LEVEL_BALANCED,q.scheduleRulesCollection.bufferLevelRule),j.subscribe(j.eventList.ENAME_PLAYBACK_PROGRESS,w),j.subscribe(j.eventList.ENAME_PLAYBACK_TIME_UPDATED,w),j.subscribe(j.eventList.ENAME_PLAYBACK_RATE_CHANGED,w),j.subscribe(j.eventList.ENAME_PLAYBACK_RATE_CHANGED,q),j.subscribe(j.eventList.ENAME_PLAYBACK_SEEKING,w),j.subscribe(j.eventList.ENAME_PLAYBACK_SEEKING,q),j.subscribe(j.eventList.ENAME_PLAYBACK_STARTED,q),j.subscribe(j.eventList.ENAME_PLAYBACK_SEEKING,q.scheduleRulesCollection.playbackTimeRule),a&&j.subscribe(j.eventList.ENAME_WALLCLOCK_TIME_UPDATED,p),j.subscribe(j.eventList.ENAME_WALLCLOCK_TIME_UPDATED,w),j.subscribe(j.eventList.ENAME_WALLCLOCK_TIME_UPDATED,q),u.subscribe(u.eventList.ENAME_INITIALIZATION_LOADED,t),u.subscribe(u.eventList.ENAME_SEGMENTS_LOADED,t)),t.initialize(this),w.initialize(d,g,k,o),q.initialize(d,this),n=this.getFragmentModel(),n.setLoader(v),n.subscribe(n.eventList.ENAME_FRAGMENT_LOADING_STARTED,i),n.subscribe(n.eventList.ENAME_FRAGMENT_LOADING_COMPLETED,i),n.subscribe(n.eventList.ENAME_STREAM_COMPLETED,i),n.subscribe(n.eventList.ENAME_FRAGMENT_LOADING_FAILED,q),v.subscribe(v.eventList.ENAME_LOADING_COMPLETED,n),("video"===d||"audio"===d)&&(w.subscribe(w.eventList.ENAME_BUFFER_LEVEL_OUTRUN,n),w.subscribe(w.eventList.ENAME_BUFFER_LEVEL_BALANCED,n),w.subscribe(w.eventList.ENAME_BYTES_REJECTED,n)),p.initialize(this)},isUpdating:function(){return this.trackController.isUpdating()},getType:function(){return d},getFragmentModel:function(){return this.scheduleController.getFragmentModel()},getStreamInfo:function(){return b.getStreamInfo()},setMediaInfo:function(a){c=a},getMediaInfo:function(){return c},getEventController:function(){return e},start:function(){this.scheduleController.start()},stop:function(){this.scheduleController.stop()},getCurrentTrack:function(){return this.adapter.getCurrentTrackInfo(this.trackController)},getTrackForQuality:function(a){return this.adapter.getTrackInfoForQuality(this.trackController,a)},isBufferingCompleted:function(){return this.bufferController.isBufferingCompleted()},isDynamic:function(){return a},reset:function(a){var c=this,d=c.bufferController,e=c.trackController,f=c.scheduleController,g=c.liveEdgeFinder,h=c.fragmentController,i=c.abrController,j=c.playbackController,k=this.indexHandler,l=this.baseURLExt,m=this.getFragmentModel(),n=this.fragmentLoader,o=c.videoModel;i.unsubscribe(i.eventList.ENAME_QUALITY_CHANGED,d),i.unsubscribe(i.eventList.ENAME_QUALITY_CHANGED,e),i.unsubscribe(i.eventList.ENAME_QUALITY_CHANGED,f),g.unsubscribe(g.eventList.ENAME_LIVE_EDGE_FOUND,this.timelineConverter),g.unsubscribe(g.eventList.ENAME_LIVE_EDGE_FOUND,f),g.unsubscribe(g.eventList.ENAME_LIVE_EDGE_FOUND,e),e.unsubscribe(e.eventList.ENAME_DATA_UPDATE_STARTED,f),e.unsubscribe(e.eventList.ENAME_DATA_UPDATE_COMPLETED,d),e.unsubscribe(e.eventList.ENAME_DATA_UPDATE_COMPLETED,f),e.unsubscribe(e.eventList.ENAME_DATA_UPDATE_COMPLETED,i),e.unsubscribe(e.eventList.ENAME_DATA_UPDATE_COMPLETED,b),e.unsubscribe(e.eventList.ENAME_DATA_UPDATE_COMPLETED,j),h.unsubscribe(h.eventList.ENAME_INIT_FRAGMENT_LOADED,d),h.unsubscribe(h.eventList.ENAME_MEDIA_FRAGMENT_LOADED,d),h.unsubscribe(h.eventList.ENAME_MEDIA_FRAGMENT_LOADING_START,f),h.unsubscribe(h.eventList.ENAME_STREAM_COMPLETED,f),h.unsubscribe(h.eventList.ENAME_STREAM_COMPLETED,d),h.unsubscribe(h.eventList.ENAME_STREAM_COMPLETED,f.scheduleRulesCollection.bufferLevelRule),d.unsubscribe(d.eventList.ENAME_BUFFER_LEVEL_STATE_CHANGED,o),d.unsubscribe(d.eventList.ENAME_BUFFER_CLEARED,f),d.unsubscribe(d.eventList.ENAME_BYTES_APPENDED,f),d.unsubscribe(d.eventList.ENAME_BYTES_REJECTED,f),
d.unsubscribe(d.eventList.ENAME_BUFFER_LEVEL_UPDATED,f),d.unsubscribe(d.eventList.ENAME_BUFFER_LEVEL_UPDATED,e),d.unsubscribe(d.eventList.ENAME_BUFFER_LEVEL_STATE_CHANGED,f),d.unsubscribe(d.eventList.ENAME_INIT_REQUESTED,f),d.unsubscribe(d.eventList.ENAME_BUFFERING_COMPLETED,b),d.unsubscribe(d.eventList.ENAME_CLOSED_CAPTIONING_REQUESTED,f),d.unsubscribe(d.eventList.ENAME_BUFFER_LEVEL_OUTRUN,f.scheduleRulesCollection.bufferLevelRule),d.unsubscribe(d.eventList.ENAME_BUFFER_LEVEL_BALANCED,f.scheduleRulesCollection.bufferLevelRule),j.unsubscribe(j.eventList.ENAME_PLAYBACK_PROGRESS,d),j.unsubscribe(j.eventList.ENAME_PLAYBACK_TIME_UPDATED,d),j.unsubscribe(j.eventList.ENAME_PLAYBACK_RATE_CHANGED,d),j.unsubscribe(j.eventList.ENAME_PLAYBACK_RATE_CHANGED,f),j.unsubscribe(j.eventList.ENAME_PLAYBACK_SEEKING,d),j.unsubscribe(j.eventList.ENAME_PLAYBACK_SEEKING,f),j.unsubscribe(j.eventList.ENAME_PLAYBACK_STARTED,f),j.unsubscribe(j.eventList.ENAME_WALLCLOCK_TIME_UPDATED,e),j.unsubscribe(j.eventList.ENAME_WALLCLOCK_TIME_UPDATED,d),j.unsubscribe(j.eventList.ENAME_WALLCLOCK_TIME_UPDATED,f),j.unsubscribe(j.eventList.ENAME_PLAYBACK_SEEKING,f.scheduleRulesCollection.playbackTimeRule),l.unsubscribe(l.eventList.ENAME_INITIALIZATION_LOADED,k),l.unsubscribe(l.eventList.ENAME_SEGMENTS_LOADED,k),d.unsubscribe(d.eventList.ENAME_BUFFER_LEVEL_OUTRUN,m),d.unsubscribe(d.eventList.ENAME_BUFFER_LEVEL_BALANCED,m),d.unsubscribe(d.eventList.ENAME_BYTES_REJECTED,m),m.unsubscribe(m.eventList.ENAME_FRAGMENT_LOADING_STARTED,h),m.unsubscribe(m.eventList.ENAME_FRAGMENT_LOADING_COMPLETED,h),m.unsubscribe(m.eventList.ENAME_STREAM_COMPLETED,h),m.unsubscribe(m.eventList.ENAME_FRAGMENT_LOADING_FAILED,f),n.unsubscribe(n.eventList.ENAME_LOADING_COMPLETED,m),h.resetModel(m),k.reset(),this.bufferController.reset(a),this.scheduleController.reset(),this.bufferController=null,this.scheduleController=null,this.trackController=null,this.videoModel=null,this.fragmentController=null}}},MediaPlayer.dependencies.StreamProcessor.prototype={constructor:MediaPlayer.dependencies.StreamProcessor},MediaPlayer.utils.TokenAuthentication=function(){"use strict";var a={type:MediaPlayer.utils.TokenAuthentication.TYPE_QUERY};return{debug:void 0,getTokenAuthentication:function(){return a},setTokenAuthentication:function(b){a=b},checkRequestHeaderForToken:function(b){void 0!==a.name&&null!==b.getResponseHeader(a.name)&&(a.token=b.getResponseHeader(a.name),this.debug.log(a.name+" received: "+a.token))},addTokenAsQueryArg:function(b){if(void 0!==a.name&&void 0!==a.token&&a.type===MediaPlayer.utils.TokenAuthentication.TYPE_QUERY){var c=-1===b.indexOf("?")?"?":"&";b+=c+a.name+"="+a.token,this.debug.log(a.name+" is being appended on the request url with a value of : "+a.token)}return b},setTokenInRequestHeader:function(b){return a.type===MediaPlayer.utils.TokenAuthentication.TYPE_HEADER&&(b.setRequestHeader(a.name,a.token),this.debug.log(a.name+" is being set in the request header with a value of : "+a.token)),b}}},MediaPlayer.utils.TokenAuthentication.TYPE_QUERY="query",MediaPlayer.utils.TokenAuthentication.TYPE_HEADER="header",MediaPlayer.models.URIQueryAndFragmentModel=function(){"use strict";var a=new MediaPlayer.vo.URIFragmentData,b=[],c=function(c){function d(a,b,c,d){var e=d[0].split(/[=]/);return d.push({key:e[0],value:e[1]}),d.shift(),d}function e(a,c,d){return c>0&&(j&&0===b.length?b=d[c].split(/[&]/):k&&(g=d[c].split(/[&]/))),d}if(!c)return null;var f,g=[],h=new RegExp(/[?]/),i=new RegExp(/[#]/),j=h.test(c),k=i.test(c);return f=c.split(/[?#]/).map(e),b.length>0&&(b=b.reduce(d,null)),g.length>0&&(g=g.reduce(d,null),g.forEach(function(b){a[b.key]=b.value})),c};return{parseURI:c,getURIFragmentData:a,getURIQueryData:b,reset:function(){a=new MediaPlayer.vo.URIFragmentData,b=[]}}},MediaPlayer.models.URIQueryAndFragmentModel.prototype={constructor:MediaPlayer.models.URIQueryAndFragmentModel},MediaPlayer.models.VideoModel=function(){"use strict";var a,b=[],c=function(){return b.length>0},d=function(c){null!==c&&(a.playbackRate=0,b[c]!==!0&&(b.push(c),b[c]=!0))},e=function(d){if(null!==d){b[d]=!1;var e=b.indexOf(d);-1!==e&&b.splice(e,1),c()===!1&&(a.playbackRate=1)}},f=function(a,b){b?d(a):e(a)},g=function(a,b){var c=a.streamProcessor.getType();f.call(this,c,!b)};return{system:void 0,setup:function(){this.bufferLevelStateChanged=g},play:function(){a.play()},pause:function(){a.pause()},isPaused:function(){return a.paused},getPlaybackRate:function(){return a.playbackRate},setPlaybackRate:function(b){a.playbackRate=b},getCurrentTime:function(){return a.currentTime},setCurrentTime:function(b){a.currentTime!=b&&(a.currentTime=b)},listen:function(b,c){a.addEventListener(b,c,!1)},unlisten:function(b,c){a.removeEventListener(b,c,!1)},getElement:function(){return a},setElement:function(b){a=b},setSource:function(b){a.src=b}}},MediaPlayer.models.VideoModel.prototype={constructor:MediaPlayer.models.VideoModel},MediaPlayer.dependencies.VideoModelExtensions=function(){"use strict";return{getPlaybackQuality:function(a){var b="webkitDroppedFrameCount"in a,c="getVideoPlaybackQuality"in a,d=null;return c?d=a.getVideoPlaybackQuality():b&&(d={droppedVideoFrames:a.webkitDroppedFrameCount,creationTime:new Date}),d}}},MediaPlayer.dependencies.VideoModelExtensions.prototype={constructor:MediaPlayer.dependencies.VideoModelExtensions},MediaPlayer.utils.TTMLParser=function(){"use strict";var a,b=3600,c=60,d=/^(0[0-9]|1[0-9]|2[0-3]):([0-5][0-9]):([0-5][0-9])((\.[0-9][0-9][0-9])|(:[0-9][0-9]))$/,e=function(e){var f,g,h,i=d.test(e);if(!i)return NaN;if(f=e.split(":"),g=parseFloat(f[0])*b+parseFloat(f[1])*c+parseFloat(f[2]),f[3]){if(h=a.tt.frameRate,!h||isNaN(h))return NaN;g+=parseFloat(f[3])/h}return g},f=function(){var b=!1,c=a.hasOwnProperty("tt"),d=c?a.tt.hasOwnProperty("head"):!1,e=d?a.tt.head.hasOwnProperty("layout"):!1,f=d?a.tt.head.hasOwnProperty("styling"):!1,g=c?a.tt.hasOwnProperty("body"):!1,h=d?a.tt.head.hasOwnProperty("profile"):!1;return c&&d&&e&&f&&g&&(b=!0),b&&(b=h&&"http://www.w3.org/ns/ttml/profile/sdp-us"===a.tt.head.profile.use),b},g=function(a,b){var c=Object.keys(a).filter(function(c){return"xmlns"===c.split(":")[0]&&a[c]===b}).map(function(a){return a.split(":")[1]});return 1!=c.length?null:c[0]},h=function(b){var c,d,h,i,j,k,l,m=[],n=new X2JS([],"",!1);if(a=n.xml_str2json(b),!f())throw c="TTML document has incorrect structure";if(k=g(a.tt,"http://www.w3.org/ns/ttml#parameter"),a.tt.hasOwnProperty(k+":frameRate")&&(a.tt.frameRate=parseInt(a.tt[k+":frameRate"],10)),d=a.tt.body.div_asArray[0].p_asArray,!d||0===d.length)throw c="TTML document does not contain any cues";for(l=0;l<d.length;l+=1){if(h=d[l],i=e(h.begin),j=e(h.end),isNaN(i)||isNaN(j))throw c="TTML document has incorrect timing value";m.push({start:i,end:j,data:h.__text})}return m};return{parse:h}},MediaPlayer.dependencies.TextController=function(){var a,b,c,d=!1,e=function(){d||(b.hasOwnProperty("initialize")&&b.initialize(c,this),d=!0),this.notify(this.eventList.ENAME_CLOSED_CAPTIONING_REQUESTED,0)},f=function(a,c,d){var e=this;c===e.streamProcessor.getFragmentModel()&&null!==d&&e.sourceBufferExt.append(b,d,e.videoModel)};return{sourceBufferExt:void 0,debug:void 0,system:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_CLOSED_CAPTIONING_REQUESTED:"closedCaptioningRequested"},setup:function(){this.dataUpdateCompleted=e,this.initFragmentLoaded=f},initialize:function(a,b,d,e){var f=this;c=a,f.setBuffer(b),f.setMediaSource(d),f.videoModel=e.videoModel,f.trackController=e.trackController,f.streamProcessor=e},getBuffer:function(){return b},setBuffer:function(a){b=a},setMediaSource:function(b){a=b},reset:function(c){c||(this.sourceBufferExt.abort(a,b),this.sourceBufferExt.removeSourceBuffer(a,b))}}},MediaPlayer.dependencies.TextController.prototype={constructor:MediaPlayer.dependencies.TextController},MediaPlayer.dependencies.TextSourceBuffer=function(){var a,b;return{system:void 0,eventBus:void 0,errHandler:void 0,initialize:function(c,d){b=c,this.videoModel=d.videoModel,a=d.streamProcessor.getCurrentTrack().mediaInfo},append:function(b){var c,d,e,f=this,g=String.fromCharCode.apply(null,new Uint16Array(b));try{c=f.getParser().parse(g),d=a.id,e=a.lang,f.getTextTrackExtensions().addTextTrack(f.videoModel.getElement(),c,d,e,!0),f.eventBus.dispatchEvent({type:"updateend"})}catch(h){f.errHandler.closedCaptionsError(h,"parse",g)}},abort:function(){this.getTextTrackExtensions().deleteCues(this.videoModel.getElement())},getParser:function(){var a;return"text/vtt"===b?a=this.system.getObject("vttParser"):"application/ttml+xml"===b&&(a=this.system.getObject("ttmlParser")),a},getTextTrackExtensions:function(){return this.system.getObject("textTrackExtensions")},addEventListener:function(a,b,c){this.eventBus.addEventListener(a,b,c)},removeEventListener:function(a,b,c){this.eventBus.removeEventListener(a,b,c)}}},MediaPlayer.dependencies.TextSourceBuffer.prototype={constructor:MediaPlayer.dependencies.TextSourceBuffer},MediaPlayer.utils.TextTrackExtensions=function(){"use strict";var a;return{setup:function(){a=window.VTTCue||window.TextTrackCue},addTextTrack:function(b,c,d,e,f){var g=b.addTextTrack("captions",d,e);g["default"]=f,g.mode="showing";for(var h in c){var i=c[h];g.addCue(new a(i.start,i.end,i.data))}return g},deleteCues:function(a){for(var b=0,c=!1;!c;){if(null!==a.textTracks[b].cues){c=!0;break}b++}var d=a.textTracks[b],e=d.cues,f=e.length-1;for(b=f;b>=0;b--)d.removeCue(e[b]);d.mode="disabled",d["default"]=!1}}},MediaPlayer.utils.VTTParser=function(){"use strict";var a=function(a){var b=a.split(":"),c=b.length-1;return a=60*parseInt(b[c-1],10)+parseFloat(b[c],10),2===c&&(a+=3600*parseInt(b[0],10)),a};return{parse:function(b){var c,d=/(?:\r\n|\r|\n)/gm,e=/-->/,f=/(^[\s]+|[\s]+$)/g,g=[];b=b.split(d),c=b.length;for(var h=0;c>h;h++){var i=b[h];if(i.length>0&&"WEBVTT"!==i&&i.match(e)){var j=i.split(e),k=b[h+1];g.push({start:a(j[0].replace(f,"")),end:a(j[1].replace(f,"")),data:k})}}return g}}},MediaPlayer.rules.ABRRulesCollection=function(){"use strict";var a=[];return{downloadRatioRule:void 0,insufficientBufferRule:void 0,limitSwitchesRule:void 0,getRules:function(b){switch(b){case MediaPlayer.rules.ABRRulesCollection.prototype.QUALITY_SWITCH_RULES:return a;default:return null}},setup:function(){a.push(this.downloadRatioRule),a.push(this.insufficientBufferRule),a.push(this.limitSwitchesRule)}}},MediaPlayer.rules.ABRRulesCollection.prototype={constructor:MediaPlayer.rules.ABRRulesCollection,QUALITY_SWITCH_RULES:"qualitySwitchRules"},MediaPlayer.rules.DownloadRatioRule=function(){"use strict";var a={},b=function(a,b,c){var d=a.getTrackForQuality(b).bandwidth;return d/c};return{debug:void 0,metricsExt:void 0,metricsModel:void 0,setStreamProcessor:function(b){var c=b.getType(),d=b.getStreamInfo().id;a[d]=a[d]||{},a[d][c]=b},execute:function(c,d){var e,f,g,h,i,j,k,l,m,n,o,p=this,q=c.getStreamInfo().id,r=c.getMediaInfo(),s=r.type,t=c.getCurrentValue(),u=a[q][s],v=p.metricsModel.getReadOnlyMetricsFor(s),w=p.metricsExt.getCurrentHttpRequest(v),x=.75;if(!v)return void d(new MediaPlayer.rules.SwitchRequest);if(null===w)return void d(new MediaPlayer.rules.SwitchRequest);if(f=(w.tfinish.getTime()-w.trequest.getTime())/1e3,e=(w.tfinish.getTime()-w.tresponse.getTime())/1e3,0>=f)return void d(new MediaPlayer.rules.SwitchRequest);if(null===w.mediaduration||void 0===w.mediaduration||w.mediaduration<=0||isNaN(w.mediaduration))return void d(new MediaPlayer.rules.SwitchRequest);if(h=w.mediaduration/f,g=w.mediaduration/e*x,isNaN(g)||isNaN(h))return p.debug.log("The ratios are NaN, bailing."),void d(new MediaPlayer.rules.SwitchRequest);if(isNaN(g))o=new MediaPlayer.rules.SwitchRequest;else if(4>g)t>0?(p.debug.log("We are not at the lowest bitrate, so switch down."),j=u.getTrackForQuality(t-1).bandwidth,l=u.getTrackForQuality(t).bandwidth,i=j/l,i>g?(p.debug.log("Things must be going pretty bad, switch all the way down."),o=new MediaPlayer.rules.SwitchRequest(0)):(p.debug.log("Things could be better, so just switch down one index."),o=new MediaPlayer.rules.SwitchRequest(t-1))):o=new MediaPlayer.rules.SwitchRequest(t);else if(n=r.trackCount-1,n>t)if(k=u.getTrackForQuality(t+1).bandwidth,l=u.getTrackForQuality(t).bandwidth,i=k/l,g>=i)if(g>100)p.debug.log("Tons of bandwidth available, go all the way up."),o=new MediaPlayer.rules.SwitchRequest(n-1);else if(g>10)p.debug.log("Just enough bandwidth available, switch up one."),o=new MediaPlayer.rules.SwitchRequest(t+1);else{for(m=-1;(m+=1)<n&&!(g<b.call(p,u,m,l)););p.debug.log("Calculated ideal new quality index is: "+m),o=new MediaPlayer.rules.SwitchRequest(m)}else o=new MediaPlayer.rules.SwitchRequest;else o=new MediaPlayer.rules.SwitchRequest(n);d(o)},reset:function(){a={}}}},MediaPlayer.rules.DownloadRatioRule.prototype={constructor:MediaPlayer.rules.DownloadRatioRule},MediaPlayer.rules.InsufficientBufferRule=function(){"use strict";var a=0,b=3;return{debug:void 0,metricsModel:void 0,execute:function(c,d){var e,f,g=this,h=c.getMediaInfo().type,i=c.getCurrentValue(),j=g.metricsModel.getReadOnlyMetricsFor(h),k=!1,l=MediaPlayer.rules.SwitchRequest.prototype.DEFAULT;return null===j.PlayList||void 0===j.PlayList||0===j.PlayList.length?void d(new MediaPlayer.rules.SwitchRequest):(e=j.PlayList[j.PlayList.length-1],null===e||void 0===e||0===e.trace.length?void d(new MediaPlayer.rules.SwitchRequest):(f=e.trace[e.trace.length-2],null===f||void 0===f||null===f.stopreason||void 0===f.stopreason?void d(new MediaPlayer.rules.SwitchRequest):(f.stopreason===MediaPlayer.vo.metrics.PlayList.Trace.REBUFFERING_REASON&&(k=!0,a+=1,g.debug.log("Number of times the buffer has run dry: "+a)),a>b&&(l=MediaPlayer.rules.SwitchRequest.prototype.STRONG,g.debug.log("Apply STRONG to buffer rule.")),void(k?(g.debug.log("The buffer ran dry recently, switch down."),d(new MediaPlayer.rules.SwitchRequest(i-1,l))):a>b?(g.debug.log("Too many dry buffer hits, quit switching bitrates."),d(new MediaPlayer.rules.SwitchRequest(i,l))):d(new MediaPlayer.rules.SwitchRequest(MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,l))))))}}},MediaPlayer.rules.InsufficientBufferRule.prototype={constructor:MediaPlayer.rules.InsufficientBufferRule},MediaPlayer.rules.LimitSwitchesRule=function(){"use strict";var a=0,b=2e3;return{debug:void 0,metricsModel:void 0,execute:function(c,d){var e,f=this,g=c.getMediaInfo().type,h=c.getCurrentValue(),i=this.metricsModel.getReadOnlyMetricsFor(g),j=c.getManifestInfo(),k=i.RepSwitchList.length-1,l=i.RepSwitchList[k],m=(new Date).getTime();return b=1e3*Math.min(j.minBufferTime,j.maxFragmentDuration),e=m-a,b>e&&m-l.t.getTime()<b?(f.debug.log("Wait some time before allowing another switch."),void d(new MediaPlayer.rules.SwitchRequest(h,MediaPlayer.rules.SwitchRequest.prototype.STRONG))):(a=m,void d(new MediaPlayer.rules.SwitchRequest(MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,MediaPlayer.rules.SwitchRequest.prototype.STRONG)))}}},MediaPlayer.rules.LimitSwitchesRule.prototype={constructor:MediaPlayer.rules.LimitSwitchesRule},MediaPlayer.rules.RulesContext=function(a,b){"use strict";var c=a.getCurrentTrack();return{getStreamInfo:function(){return c.mediaInfo.streamInfo},getMediaInfo:function(){return c.mediaInfo},getTrackInfo:function(){return c},getCurrentValue:function(){return b},getManifestInfo:function(){return c.mediaInfo.streamInfo.manifestInfo}}},MediaPlayer.rules.RulesContext.prototype={constructor:MediaPlayer.rules.RulesContext},MediaPlayer.rules.BufferLevelRule=function(){"use strict";var a={},b={},c={},d=function(a){var b=this.metricsExt.getCurrentHttpRequest(a);return null!==b?(b.tresponse.getTime()-b.trequest.getTime())/1e3:0},e=function(a,b){var c;return c=isNaN(b)||MediaPlayer.dependencies.BufferController.DEFAULT_MIN_BUFFER_TIME<b&&b>a?Math.max(MediaPlayer.dependencies.BufferController.DEFAULT_MIN_BUFFER_TIME,a):a>=b?Math.min(b,MediaPlayer.dependencies.BufferController.DEFAULT_MIN_BUFFER_TIME):Math.min(b,a)},f=function(a,b,c){var f=this,g=c.bufferController.getCriticalBufferLevel(),h=e.call(this,c.bufferController.getMinBufferTime(),b),i=h,j=c.bufferController.bufferMax,k=f.metricsModel.getReadOnlyMetricsFor("video"),l=f.metricsModel.getReadOnlyMetricsFor("audio"),m=b>=MediaPlayer.dependencies.BufferController.LONG_FORM_CONTENT_DURATION_THRESHOLD,n=0;return j===MediaPlayer.dependencies.BufferController.BUFFER_SIZE_MIN?n=h:j===MediaPlayer.dependencies.BufferController.BUFFER_SIZE_INFINITY?n=b:j===MediaPlayer.dependencies.BufferController.BUFFER_SIZE_REQUIRED&&(!a&&f.abrController.isPlayingAtTopQuality()&&(i=m?MediaPlayer.dependencies.BufferController.BUFFER_TIME_AT_TOP_QUALITY_LONG_FORM:MediaPlayer.dependencies.BufferController.BUFFER_TIME_AT_TOP_QUALITY),n=i+Math.max(d.call(f,k),d.call(f,l))),n=Math.min(n,g)},g=function(a,c){return b[a]&&b[a][c]},h=function(b,c){return a[b]&&a[b][c]},i=function(a,c,d){var e=c.getContext().streamProcessor.getStreamInfo().id;b[e]=b[e]||{},b[e][d.mediaType]=!0},j=function(b){var c=b.streamProcessor.getStreamInfo().id;a[c]=a[c]||{},a[c][b.streamProcessor.getType()]=!0},k=function(b){var c=b.streamProcessor.getStreamInfo().id;a[c]=a[c]||{},a[c][b.streamProcessor.getType()]=!1};return{metricsExt:void 0,metricsModel:void 0,abrController:void 0,setup:function(){this.bufferLevelOutrun=j,this.bufferLevelBalanced=k,this.streamCompleted=i},setScheduleController:function(a){var b=a.streamProcessor.getStreamInfo().id;c[b]=c[b]||{},c[b][a.streamProcessor.getType()]=a},execute:function(a,b){var d=a.getStreamInfo(),e=d.id,i=a.getMediaInfo().type;if(h(e,i))return void b(new MediaPlayer.rules.SwitchRequest(0,MediaPlayer.rules.SwitchRequest.prototype.STRONG));var j,k=this.metricsModel.getReadOnlyMetricsFor(i),l=this.metricsExt.getCurrentBufferLevel(k)?this.metricsExt.getCurrentBufferLevel(k).level:0,m=c[e][i],n=m.streamProcessor.getCurrentTrack(),o=m.streamProcessor.isDynamic(),p=this.metricsExt.getCurrentPlaybackRate(k),q=d.duration,r=l/Math.max(p,1),s=n.fragmentDuration,t=m.playbackController.getTime(),u=o?Number.POSITIVE_INFINITY:q-t,v=Math.min(f.call(this,o,q,m),u),w=Math.max(v-r,0);j=Math.ceil(w/s),r>=u&&!g(e,i)&&(j=j||1),b(new MediaPlayer.rules.SwitchRequest(j,MediaPlayer.rules.SwitchRequest.prototype.DEFAULT))},reset:function(){a={},b={},c={}}}},MediaPlayer.rules.BufferLevelRule.prototype={constructor:MediaPlayer.rules.BufferLevelRule},MediaPlayer.rules.LiveEdgeBinarySearchRule=function(){"use strict";var a,b,c=43200,d=NaN,e=null,f=NaN,g=null,h=!1,i=NaN,j=MediaPlayer.rules.SwitchRequest.prototype.DEFAULT,k=function(b,c,d,e){var f,h=this;if(null===e)f=h.adapter.generateFragmentRequestForTime(a.streamProcessor,g,b),k.call(h,b,c,d,f);else{var i=function(e,f,g){a.fragmentLoader.unsubscribe(a.fragmentLoader.eventList.ENAME_CHECK_FOR_EXISTENCE_COMPLETED,h,i),f?c.call(h,g,b):d.call(h,g,b)};a.fragmentLoader.subscribe(a.fragmentLoader.eventList.ENAME_CHECK_FOR_EXISTENCE_COMPLETED,h,i),a.fragmentLoader.checkForExistence(e)}},l=function(c,i){var o,p,q;return h?void n.call(this,!1,i):(q=i-d,o=q>0?d-q:d+Math.abs(q)+f,void(o<e.start&&o>e.end?b(new MediaPlayer.rules.SwitchRequest(null,j)):(p=this.adapter.getFragmentRequestForTime(a.streamProcessor,g,o),k.call(this,o,m,l,p))))},m=function(c,l){var m,o,p=c.startTime,q=this;if(!h){if(!g.fragmentDuration)return void b(new MediaPlayer.rules.SwitchRequest(p,j));if(h=!0,e.end=p+2*f,l===d)return o=l+i,m=q.adapter.getFragmentRequestForTime(a.streamProcessor,g,o),void k.call(q,o,function(){n.call(q,!0,o)},function(){b(new MediaPlayer.rules.SwitchRequest(o,j))},m)}n.call(this,!0,l)},n=function(c,d){var f,h,n;c?e.start=d:e.end=d,f=Math.floor(e.end-e.start)<=i,f?b(new MediaPlayer.rules.SwitchRequest(c?d:d-i,j)):(n=(e.start+e.end)/2,h=this.adapter.getFragmentRequestForTime(a.streamProcessor,g,n),k.call(this,n,m,l,h))};return{metricsExt:void 0,adapter:void 0,setFinder:function(b){a=b},execute:function(h,n){var o,p,q=this;return b=n,g=a.streamProcessor.getCurrentTrack(),i=g.fragmentDuration,p=g.DVRWindow,d=p.end,g.useCalculatedLiveEdgeTime?void b(new MediaPlayer.rules.SwitchRequest(d,j)):(e={start:Math.max(0,d-c),end:d+c},f=Math.floor((p.end-p.start)/2),o=q.adapter.getFragmentRequestForTime(a.streamProcessor,g,d),void k.call(q,d,m,l,o))},reset:function(){d=NaN,e=null,f=NaN,g=null,h=!1,i=NaN,a=null}}},MediaPlayer.rules.LiveEdgeBinarySearchRule.prototype={constructor:MediaPlayer.rules.LiveEdgeBinarySearchRule},MediaPlayer.rules.PendingRequestsRule=function(){"use strict";var a=3,b={};return{metricsExt:void 0,setScheduleController:function(a){var c=a.streamProcessor.getStreamInfo().id;b[c]=b[c]||{},b[c][a.streamProcessor.getType()]=a},execute:function(c,d){var e=c.getMediaInfo().type,f=c.getStreamInfo().id,g=c.getCurrentValue(),h=b[f][e],i=h.getFragmentModel(),j=i.getPendingRequests(),k=i.getLoadingRequests(),l=i.getRejectedRequests(),m=l.length,n=j.length+k.length,o=Math.max(g-n,0);return m>0?void d(new MediaPlayer.rules.SwitchRequest(m,MediaPlayer.rules.SwitchRequest.prototype.DEFAULT)):n>a?void d(new MediaPlayer.rules.SwitchRequest(0,MediaPlayer.rules.SwitchRequest.prototype.DEFAULT)):0===g?void d(new MediaPlayer.rules.SwitchRequest(o,MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE)):void d(new MediaPlayer.rules.SwitchRequest(o,MediaPlayer.rules.SwitchRequest.prototype.DEFAULT))},reset:function(){b={}}}},MediaPlayer.rules.PendingRequestsRule.prototype={constructor:MediaPlayer.rules.PendingRequestsRule},MediaPlayer.rules.PlaybackTimeRule=function(){"use strict";var a={},b={},c=function(b,c){var d=b.getStreamId();a[d]=a[d]||{},a[d].audio=c,a[d].video=c};return{adapter:void 0,sourceBufferExt:void 0,setup:function(){this.playbackSeeking=c},setScheduleController:function(a){var c=a.streamProcessor.getStreamInfo().id;b[c]=b[c]||{},b[c][a.streamProcessor.getType()]=a},execute:function(c,d){var e,f,g,h=c.getMediaInfo().type,i=c.getStreamInfo().id,j=b[i][h],k=b[i][h].streamProcessor,l=k.getCurrentTrack(),m=a[i]?a[i][h]:null,n=m?MediaPlayer.rules.SwitchRequest.prototype.STRONG:MediaPlayer.rules.SwitchRequest.prototype.DEFAULT,o=j.getFragmentModel().getRejectedRequests().shift(),p=!!o&&!m,q=this.adapter.getIndexHandlerTime(k),r=k.playbackController.getTime(),s=o?o.startTime+o.duration:null,t=o&&(s>r&&o.startTime<=q||isNaN(q));if(f=m||(t?o.startTime:q),isNaN(f))return void d(new MediaPlayer.rules.SwitchRequest(null,n));for(a[i]&&(a[i][h]=null),e=this.sourceBufferExt.getBufferRange(k.bufferController.getBuffer(),f),null!==e&&(f=e.end),g=this.adapter.getFragmentRequestForTime(k,l,f,p),t&&g&&g.index!==o.index&&(g=this.adapter.getFragmentRequestForTime(k,l,o.startTime+o.duration/2,p));g&&k.fragmentController.isFragmentLoadedOrPending(j,g);){if("complete"===g.action){g=null,this.adapter.setIndexHandlerTime(k,NaN);break}g=this.adapter.getNextFragmentRequest(k,l)}g&&!t&&this.adapter.setIndexHandlerTime(k,g.startTime+g.duration),d(new MediaPlayer.rules.SwitchRequest(g,n))},reset:function(){a={},b={}}}},MediaPlayer.rules.PlaybackTimeRule.prototype={constructor:MediaPlayer.rules.PlaybackTimeRule},MediaPlayer.rules.RulesController=function(){"use strict";var a={},b=["execute"],c=function(a){return a===this.SCHEDULING_RULE||a===this.ABR_RULE},d=function(a){var c=b.length,d=0;for(d;c>d;d+=1)if(!a.hasOwnProperty(b[d]))return!1;return!0},e=function(a,b){return new MediaPlayer.rules.RulesContext(a,b)},f=function(a){var b=a.execute.bind(a);return a.execute=function(c,d){var e=function(b){d.call(a,new MediaPlayer.rules.SwitchRequest(b.value,b.priority))};b(c,e)},"function"!=typeof a.reset&&(a.reset=function(){}),a},g=function(a,b,c){var e,g,h,i,j,k;for(g in b)if(i=b[g],j=i.length)for(k=0;j>k;k+=1)e=i[k],d.call(this,e)&&(e=f.call(this,e),h=a.getRules(g),c&&(h.length=0),h.push(e))};return{system:void 0,debug:void 0,SCHEDULING_RULE:0,ABR_RULE:1,initialize:function(){a[this.ABR_RULE]=this.system.getObject("abrRulesCollection"),a[this.SCHEDULING_RULE]=this.system.getObject("scheduleRulesCollection")},setRules:function(b,d){c.call(this,b)&&d&&g.call(this,a[b],d,!0)},addRules:function(b,d){c.call(this,b)&&d&&g.call(this,a[b],d,!1)},applyRules:function(a,b,c,f,g){var h,i,j=a.length,k=j,l={},m=e.call(this,b,f),n=function(a){var b,d;a.value!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&(l[a.priority]=g(l[a.priority],a.value)),--j||(l[MediaPlayer.rules.SwitchRequest.prototype.WEAK]!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&(d=MediaPlayer.rules.SwitchRequest.prototype.WEAK,b=l[MediaPlayer.rules.SwitchRequest.prototype.WEAK]),l[MediaPlayer.rules.SwitchRequest.prototype.DEFAULT]!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&(d=MediaPlayer.rules.SwitchRequest.prototype.DEFAULT,b=l[MediaPlayer.rules.SwitchRequest.prototype.DEFAULT]),l[MediaPlayer.rules.SwitchRequest.prototype.STRONG]!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&(d=MediaPlayer.rules.SwitchRequest.prototype.STRONG,b=l[MediaPlayer.rules.SwitchRequest.prototype.STRONG]),d!=MediaPlayer.rules.SwitchRequest.prototype.STRONG&&d!=MediaPlayer.rules.SwitchRequest.prototype.WEAK&&(d=MediaPlayer.rules.SwitchRequest.prototype.DEFAULT),c({value:b||f,confidence:d}))};for(l[MediaPlayer.rules.SwitchRequest.prototype.STRONG]=MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,l[MediaPlayer.rules.SwitchRequest.prototype.WEAK]=MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,l[MediaPlayer.rules.SwitchRequest.prototype.DEFAULT]=MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,i=0;k>i;i+=1)h=a[i],d.call(this,h)?h.execute(m,n):j--},reset:function(){a={}}}},MediaPlayer.rules.RulesController.prototype={constructor:MediaPlayer.rules.RulesController},MediaPlayer.rules.SameTimeRequestRule=function(){"use strict";var a=4,b=function(a,b){var c,e,f,g,h,i=0,j=a.length;for(i;j>i;i+=1)for(f=a[i].getPendingRequests(),d.call(this,f,"index"),g=0,h=f.length;h>g;g++){if(c=f[g],isNaN(c.startTime)&&"complete"!==c.action){e=c;break}c.startTime>b&&(!e||c.startTime<e.startTime)&&(e=c)}return e||c},c=function(a,b){var c,d,e=a.length,f=null;for(d=0;e>d;d+=1)c=a[d].getPendingRequestForTime(b),c&&(!f||c.startTime>f.startTime)&&(f=c);return f},d=function(a,b){var c=function(a,c){return a[b]<c[b]||isNaN(a[b])&&"complete"!==a.action?-1:a[b]>c[b]?1:0};a.sort(c)};return{setFragmentModels:function(a,b){this.fragmentModels=this.fragmentModels||{},this.fragmentModels[b]=a},execute:function(d,e){var f,g,h,i,j,k,l,m,n,o=d.getStreamInfo().id,p=d.getCurrentValue(),q=MediaPlayer.rules.SwitchRequest.prototype.DEFAULT,r=this.fragmentModels[o],s=new Date,t=null,u=r?r.length:null,v=!1,w=[];if(!r||!u)return void e(new MediaPlayer.rules.SwitchRequest([],q));if(k=Math.round(100*r[0].getContext().playbackController.getTime())/100,l=c(r,k),j=l||b(r,k)||p,!j)return void e(new MediaPlayer.rules.SwitchRequest([],q));for(i=0;u>i;i+=1)if(g=r[i],f=g.getContext().streamProcessor.getType(),("video"===f||"audio"===f)&&(m=g.getPendingRequests(),n=g.getLoadingRequests().length,!g.getIsPostponed()||isNaN(j.startTime))){if(n>a)return void e(new MediaPlayer.rules.SwitchRequest([],q));if(t=t||(j===l?k:j.startTime),-1===m.indexOf(j)){if(h=g.getPendingRequestForTime(t))w.push(h);else if(h=g.getLoadingRequestForTime(t)||g.getExecutedRequestForTime(t),!h){v=!0;break}}else w.push(j)}return w=w.filter(function(a){return"complete"===a.action||s.getTime()>=a.availabilityStartTime.getTime()}),v?void e(new MediaPlayer.rules.SwitchRequest([],q)):void e(new MediaPlayer.rules.SwitchRequest(w,q))}}},MediaPlayer.rules.SameTimeRequestRule.prototype={constructor:MediaPlayer.rules.SameTimeRequestRule},MediaPlayer.rules.ScheduleRulesCollection=function(){"use strict";var a=[],b=[],c=[],d=[];return{bufferLevelRule:void 0,pendingRequestsRule:void 0,playbackTimeRule:void 0,sameTimeRequestRule:void 0,liveEdgeBinarySearchRule:void 0,getRules:function(e){switch(e){case MediaPlayer.rules.ScheduleRulesCollection.prototype.FRAGMENTS_TO_SCHEDULE_RULES:return a;case MediaPlayer.rules.ScheduleRulesCollection.prototype.NEXT_FRAGMENT_RULES:return d;case MediaPlayer.rules.ScheduleRulesCollection.prototype.FRAGMENTS_TO_EXECUTE_RULES:return b;case MediaPlayer.rules.ScheduleRulesCollection.prototype.LIVE_EDGE_RULES:return c;default:return null}},setup:function(){a.push(this.bufferLevelRule),a.push(this.pendingRequestsRule),d.push(this.playbackTimeRule),b.push(this.sameTimeRequestRule),c.push(this.liveEdgeBinarySearchRule)}}},MediaPlayer.rules.ScheduleRulesCollection.prototype={constructor:MediaPlayer.rules.ScheduleRulesCollection,FRAGMENTS_TO_SCHEDULE_RULES:"fragmentsToScheduleRules",NEXT_FRAGMENT_RULES:"nextFragmentRules",FRAGMENTS_TO_EXECUTE_RULES:"fragmentsToExecuteRules",LIVE_EDGE_RULES:"liveEdgeRules"},MediaPlayer.rules.SwitchRequest=function(a,b){"use strict";this.value=a,this.priority=b,void 0===this.value&&(this.value=999),void 0===this.priority&&(this.priority=.5)},MediaPlayer.rules.SwitchRequest.prototype={constructor:MediaPlayer.rules.SwitchRequest,NO_CHANGE:999,DEFAULT:.5,STRONG:1,WEAK:0},MediaPlayer.vo.FragmentRequest=function(){"use strict";this.action="download",this.startTime=NaN,this.mediaType=null,this.type=null,this.duration=NaN,this.timescale=NaN,this.range=null,this.url=null,this.requestStartDate=null,this.firstByteDate=null,this.requestEndDate=null,this.quality=NaN,this.index=NaN,this.availabilityStartTime=null,this.availabilityEndTime=null,this.wallStartTime=null},MediaPlayer.vo.FragmentRequest.prototype={constructor:MediaPlayer.vo.FragmentRequest,ACTION_DOWNLOAD:"download",ACTION_COMPLETE:"complete"},MediaPlayer.vo.ManifestInfo=function(){"use strict";this.DVRWindowSize=NaN,this.loadedTime=null,this.availableFrom=null,this.minBufferTime=NaN,this.duration=NaN,this.isDynamic=!1,this.maxFragmentDuration=null},MediaPlayer.vo.ManifestInfo.prototype={constructor:MediaPlayer.vo.ManifestInfo},MediaPlayer.vo.MediaInfo=function(){"use strict";this.id=null,this.index=null,this.type=null,this.streamInfo=null,this.trackCount=0,this.lang=null,this.codec=null,this.mimeType=null,this.contentProtection=null,this.isText=!1,this.KID=null},MediaPlayer.vo.MediaInfo.prototype={constructor:MediaPlayer.vo.MediaInfo},MediaPlayer.models.MetricsList=function(){"use strict";return{TcpList:[],HttpList:[],RepSwitchList:[],BufferLevel:[],PlayList:[],DroppedFrames:[],SchedulingInfo:[],DVRInfo:[],ManifestUpdate:[]}},MediaPlayer.models.MetricsList.prototype={constructor:MediaPlayer.models.MetricsList},MediaPlayer.vo.StreamInfo=function(){"use strict";this.id=null,this.index=null,this.start=NaN,this.duration=NaN,this.manifestInfo=null},MediaPlayer.vo.StreamInfo.prototype={constructor:MediaPlayer.vo.StreamInfo},MediaPlayer.vo.TrackInfo=function(){"use strict";this.id=null,this.quality=null,this.DVRWindow=null,this.fragmentDuration=null,this.mediaInfo=null,this.MSETimeOffset=null},MediaPlayer.vo.TrackInfo.prototype={constructor:MediaPlayer.vo.TrackInfo},MediaPlayer.vo.URIFragmentData=function(){"use strict";this.t=null,this.xywh=null,this.track=null,this.id=null,this.s=null},MediaPlayer.vo.URIFragmentData.prototype={constructor:MediaPlayer.vo.URIFragmentData},MediaPlayer.vo.metrics.BufferLevel=function(){"use strict";this.t=null,this.level=null},MediaPlayer.vo.metrics.BufferLevel.prototype={constructor:MediaPlayer.vo.metrics.BufferLevel},MediaPlayer.vo.metrics.DVRInfo=function(){"use strict";this.time=null,this.range=null,this.manifestInfo=null},MediaPlayer.vo.metrics.DVRInfo.prototype={constructor:MediaPlayer.vo.metrics.DVRInfo},MediaPlayer.vo.metrics.DroppedFrames=function(){"use strict";this.time=null,this.droppedFrames=null},MediaPlayer.vo.metrics.DroppedFrames.prototype={constructor:MediaPlayer.vo.metrics.DroppedFrames},MediaPlayer.vo.metrics.HTTPRequest=function(){"use strict";this.stream=null,this.tcpid=null,this.type=null,this.url=null,this.actualurl=null,this.range=null,this.trequest=null,this.tresponse=null,this.tfinish=null,this.responsecode=null,this.interval=null,this.mediaduration=null,this.trace=[]},MediaPlayer.vo.metrics.HTTPRequest.prototype={constructor:MediaPlayer.vo.metrics.HTTPRequest},MediaPlayer.vo.metrics.HTTPRequest.Trace=function(){"use strict";this.s=null,this.d=null,
this.b=[]},MediaPlayer.vo.metrics.HTTPRequest.Trace.prototype={constructor:MediaPlayer.vo.metrics.HTTPRequest.Trace},MediaPlayer.vo.metrics.ManifestUpdate=function(){"use strict";this.mediaType=null,this.type=null,this.requestTime=null,this.fetchTime=null,this.availabilityStartTime=null,this.presentationStartTime=0,this.clientTimeOffset=0,this.currentTime=null,this.buffered=null,this.latency=0,this.streamInfo=[],this.trackInfo=[]},MediaPlayer.vo.metrics.ManifestUpdate.StreamInfo=function(){"use strict";this.id=null,this.index=null,this.start=null,this.duration=null},MediaPlayer.vo.metrics.ManifestUpdate.TrackInfo=function(){"use strict";this.id=null,this.index=null,this.mediaType=null,this.streamIndex=null,this.presentationTimeOffset=null,this.startNumber=null,this.fragmentInfoType=null},MediaPlayer.vo.metrics.ManifestUpdate.prototype={constructor:MediaPlayer.vo.metrics.ManifestUpdate},MediaPlayer.vo.metrics.ManifestUpdate.StreamInfo.prototype={constructor:MediaPlayer.vo.metrics.ManifestUpdate.StreamInfo},MediaPlayer.vo.metrics.ManifestUpdate.TrackInfo.prototype={constructor:MediaPlayer.vo.metrics.ManifestUpdate.TrackInfo},MediaPlayer.vo.metrics.PlayList=function(){"use strict";this.stream=null,this.start=null,this.mstart=null,this.starttype=null,this.trace=[]},MediaPlayer.vo.metrics.PlayList.Trace=function(){"use strict";this.representationid=null,this.subreplevel=null,this.start=null,this.mstart=null,this.duration=null,this.playbackspeed=null,this.stopreason=null},MediaPlayer.vo.metrics.PlayList.prototype={constructor:MediaPlayer.vo.metrics.PlayList},MediaPlayer.vo.metrics.PlayList.INITIAL_PLAY_START_REASON="initial_start",MediaPlayer.vo.metrics.PlayList.SEEK_START_REASON="seek",MediaPlayer.vo.metrics.PlayList.Trace.prototype={constructor:MediaPlayer.vo.metrics.PlayList.Trace()},MediaPlayer.vo.metrics.PlayList.Trace.USER_REQUEST_STOP_REASON="user_request",MediaPlayer.vo.metrics.PlayList.Trace.REPRESENTATION_SWITCH_STOP_REASON="representation_switch",MediaPlayer.vo.metrics.PlayList.Trace.END_OF_CONTENT_STOP_REASON="end_of_content",MediaPlayer.vo.metrics.PlayList.Trace.REBUFFERING_REASON="rebuffering",MediaPlayer.vo.metrics.TrackSwitch=function(){"use strict";this.t=null,this.mt=null,this.to=null,this.lto=null},MediaPlayer.vo.metrics.TrackSwitch.prototype={constructor:MediaPlayer.vo.metrics.TrackSwitch},MediaPlayer.vo.metrics.SchedulingInfo=function(){"use strict";this.mediaType=null,this.t=null,this.type=null,this.startTime=null,this.availabilityStartTime=null,this.duration=null,this.quality=null,this.range=null,this.state=null},MediaPlayer.vo.metrics.SchedulingInfo.prototype={constructor:MediaPlayer.vo.metrics.SchedulingInfo},MediaPlayer.vo.metrics.SchedulingInfo.PENDING_STATE="pending",MediaPlayer.vo.metrics.SchedulingInfo.LOADING_STATE="loading",MediaPlayer.vo.metrics.SchedulingInfo.EXECUTED_STATE="executed",MediaPlayer.vo.metrics.SchedulingInfo.REJECTED_STATE="rejected",MediaPlayer.vo.metrics.SchedulingInfo.CANCELED_STATE="canceled",MediaPlayer.vo.metrics.SchedulingInfo.FAILED_STATE="failed",MediaPlayer.vo.metrics.TCPConnection=function(){"use strict";this.tcpid=null,this.dest=null,this.topen=null,this.tclose=null,this.tconnect=null},MediaPlayer.vo.metrics.TCPConnection.prototype={constructor:MediaPlayer.vo.metrics.TCPConnection},function(a){var b,c,d=a.event;b=d.special.debouncedresize={setup:function(){a(this).on("resize",b.handler)},teardown:function(){a(this).off("resize",b.handler)},handler:function(a,e){var f=this,g=arguments,h=function(){a.type="debouncedresize",d.dispatch.apply(f,g)};c&&clearTimeout(c),e&&h(),c=setTimeout(h,b.threshold)},threshold:150}}(jQuery),function(a,b){"function"==typeof define&&define.amd?define(["raphael"],function(c){return b(c||a.Raphael)}):b(Raphael)}(this,function(a){a.fn.freeTransform=function(a,b,c){function d(a){("set"===a.type?a.items:[a]).map(function(a){"set"===a.type?d(a):m.items.push({el:a,attrs:{rotate:0,scale:{x:1,y:1},translate:{x:0,y:0}},transformString:a.matrix.toTransformString()})})}function e(a){var b,c,d=[],e=[{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}];return"number"!=typeof a&&(a=0),b={x:m.attrs.rotate*Math.PI/180,y:(m.attrs.rotate+90)*Math.PI/180},c={x:m.attrs.size.x/2*m.attrs.scale.x+a,y:m.attrs.size.y/2*m.attrs.scale.y+a},e.map(function(a){d.push({x:m.attrs.center.x+m.attrs.translate.x+a.x*c.x*Math.cos(b.x)+a.y*c.y*Math.cos(b.y),y:m.attrs.center.y+m.attrs.translate.y+a.x*c.x*Math.sin(b.x)+a.y*c.y*Math.sin(b.y)})}),d}function f(){var a={x:/^([0-9]+)%$/.exec(q.width),y:/^([0-9]+)%$/.exec(q.height)};return{x:a.x?q.canvas.clientWidth||q.canvas.parentNode.clientWidth*parseInt(a.x[1],10)*.01:q.canvas.clientWidth||q.width,y:a.y?q.canvas.clientHeight||q.canvas.parentNode.clientHeight*parseInt(a.y[1],10)*.01:q.canvas.clientHeight||q.height}}function g(a){var b,c,d,e={x:0,y:0},g={x:0,y:0};a&&m.opts.snap.drag&&(b=a.x,c=a.y,[0,1].map(function(){e.x=b-Math.round(b/m.opts.snap.drag)*m.opts.snap.drag,e.y=c-Math.round(c/m.opts.snap.drag)*m.opts.snap.drag,Math.abs(e.x)<=m.opts.snapDist.drag&&(g.x=e.x),Math.abs(e.y)<=m.opts.snapDist.drag&&(g.y=e.y),b+=a.width-g.x,c+=a.height-g.y}),m.attrs.translate.x-=g.x,m.attrs.translate.y-=g.y),m.opts.boundary&&(m.opts.boundarywidth=m.opts.boundarywidth||f().x*(m.o.viewBoxRatio&&m.o.viewBoxRatio.x||1),m.opts.boundaryheight=m.opts.boundaryheight||f().y*(m.o.viewBoxRatio&&m.o.viewBoxRatio.y||1),m.attrs.center.x+m.attrs.translate.x<m.opts.boundaryx&&(m.attrs.translate.x+=m.opts.boundaryx-(m.attrs.center.x+m.attrs.translate.x)),m.attrs.center.y+m.attrs.translate.y<m.opts.boundaryy&&(m.attrs.translate.y+=m.opts.boundaryy-(m.attrs.center.y+m.attrs.translate.y)),m.attrs.center.x+m.attrs.translate.x>m.opts.boundaryx+m.opts.boundarywidth&&(m.attrs.translate.x+=m.opts.boundaryx+m.opts.boundarywidth-(m.attrs.center.x+m.attrs.translate.x)),m.attrs.center.y+m.attrs.translate.y>m.opts.boundaryy+m.opts.boundaryheight&&(m.attrs.translate.y+=m.opts.boundaryy+m.opts.boundaryheight-(m.attrs.center.y+m.attrs.translate.y))),e=Math.abs(m.attrs.rotate%m.opts.snap.rotate),e=Math.min(e,m.opts.snap.rotate-e),e<m.opts.snapDist.rotate&&(m.attrs.rotate=Math.round(m.attrs.rotate/m.opts.snap.rotate)*m.opts.snap.rotate),e={x:Math.abs(m.attrs.scale.x*m.attrs.size.x%m.opts.snap.scale),y:Math.abs(m.attrs.scale.y*m.attrs.size.x%m.opts.snap.scale)},e={x:Math.min(e.x,m.opts.snap.scale-e.x),y:Math.min(e.y,m.opts.snap.scale-e.y)},e.x<m.opts.snapDist.scale&&(m.attrs.scale.x=Math.round(m.attrs.scale.x*m.attrs.size.x/m.opts.snap.scale)*m.opts.snap.scale/m.attrs.size.x),e.y<m.opts.snapDist.scale&&(m.attrs.scale.y=Math.round(m.attrs.scale.y*m.attrs.size.y/m.opts.snap.scale)*m.opts.snap.scale/m.attrs.size.y),m.opts.range.rotate&&(d=(360+m.attrs.rotate)%360,d>180&&(d-=360),d<m.opts.range.rotate[0]&&(m.attrs.rotate+=m.opts.range.rotate[0]-d),d>m.opts.range.rotate[1]&&(m.attrs.rotate+=m.opts.range.rotate[1]-d)),m.opts.range.scale&&(m.attrs.scale.x*m.attrs.size.x<m.opts.range.scale[0]&&(m.attrs.scale.x=m.opts.range.scale[0]/m.attrs.size.x),m.attrs.scale.y*m.attrs.size.y<m.opts.range.scale[0]&&(m.attrs.scale.y=m.opts.range.scale[0]/m.attrs.size.y),m.attrs.scale.x*m.attrs.size.x>m.opts.range.scale[1]&&(m.attrs.scale.x=m.opts.range.scale[1]/m.attrs.size.x),m.attrs.scale.y*m.attrs.size.y>m.opts.range.scale[1]&&(m.attrs.scale.y=m.opts.range.scale[1]/m.attrs.size.y))}function h(){return{x:m.attrs.scale.x*m.attrs.size.x>=m.opts.range.scale[0]&&m.attrs.scale.x*m.attrs.size.x<=m.opts.range.scale[1],y:m.attrs.scale.y*m.attrs.size.y>=m.opts.range.scale[0]&&m.attrs.scale.y*m.attrs.size.y<=m.opts.range.scale[1]}}function i(a){"x"===a?m.attrs.scale.y=m.attrs.scale.x/m.attrs.ratio:m.attrs.scale.x=m.attrs.scale.y*m.attrs.ratio}function k(a){var b,c={};for(b in a)c[b]="object"==typeof a[b]?k(a[b]):a[b];return c}function l(a){var b=[];m.callback&&(a.map(function(a,c){a&&b.push(a)}),clearTimeout(p),p=setTimeout(function(){m.callback&&m.callback(m,b,e())},.1))}var m,n,o,p,q=this,r=a.getBBox(!0);return a.freeTransform?a.freeTransform:(Array.prototype.hasOwnProperty("map")||(Array.prototype.map=function(a,b){o=[];for(n in this)this.hasOwnProperty(n)&&(o[n]=a.call(b,this[n],n,this));return o}),Array.prototype.hasOwnProperty("indexOf")||(Array.prototype.indexOf=function(a,b){for(n=b||0,j=this.length;n<j;n++)if(this[n]===a)return n;return-1}),m=a.freeTransform={attrs:{x:r.x,y:r.y,size:{x:r.width,y:r.height},center:{x:r.x+r.width/2,y:r.y+r.height/2},rotate:0,scale:{x:1,y:1},translate:{x:0,y:0},ratio:1},axes:null,bbox:null,callback:null,items:[],handles:{center:null,x:null,y:null},offset:{rotate:0,scale:{x:1,y:1},translate:{x:0,y:0}},opts:{animate:!1,attrs:{fill:"#fff",stroke:"#000"},boundary:{x:q._left||0,y:q._top||0,width:null,height:null},customCorners:!1,distance:1.3,drag:!0,draw:!1,keepRatio:!1,range:{rotate:[-180,180],scale:[-99999,99999]},rotate:!0,scale:!0,snap:{rotate:0,scale:0,drag:0},snapDist:{rotate:0,scale:0,drag:7},size:5},subject:a},m.updateHandles=function(){var a,b,c,d,g,h,i,j=[[-1,-1],[1,-1],[1,1],[-1,1],[0,-1],[1,0],[0,1],[-1,0]];return(m.handles.bbox||m.opts.rotate.indexOf("self")>=0)&&(b=a=e(0),m.opts.customCorners&&"number"==typeof m.opts.customCorners.distance&&(b=e(m.opts.customCorners.distance))),c={x:m.attrs.rotate*Math.PI/180,y:(m.attrs.rotate+90)*Math.PI/180},d={x:m.attrs.size.x/2*m.attrs.scale.x,y:m.attrs.size.y/2*m.attrs.scale.y},m.axes.map(function(a){m.handles[a]&&(g=m.attrs.center.x+m.attrs.translate.x+d[a]*m.opts.distance*Math.cos(c[a]),h=m.attrs.center.y+m.attrs.translate.y+d[a]*m.opts.distance*Math.sin(c[a]),i={x:1,y:1},q._viewBox&&(i={x:q._viewBox[2]/f().x,y:q._viewBox[3]/f().y}),m.opts.boundary&&(g=Math.max(Math.min(g,m.opts.boundary.x+(m.opts.boundary.width||f().x*i.x)),m.opts.boundary.x),h=Math.max(Math.min(h,m.opts.boundary.y+(m.opts.boundary.height||f().y*i.y)),m.opts.boundary.y)),m.handles[a].disc.attr({cx:g,cy:h}),m.handles[a].line.toFront().attr({path:[["M",m.attrs.center.x+m.attrs.translate.x,m.attrs.center.y+m.attrs.translate.y],["L",m.handles[a].disc.attrs.cx,m.handles[a].disc.attrs.cy]]}),m.handles[a].disc.toFront())}),m.bbox&&(m.bbox.toFront().attr({path:[["M",a[0].x,a[0].y],["L",a[1].x,a[1].y],["L",a[2].x,a[2].y],["L",a[3].x,a[3].y],["L",a[0].x,a[0].y]]}),m.handles.bbox&&m.handles.bbox.map(function(c,d){var e,f,g,h;c.isCorner?(e=b[d].x,f=b[d].y):(g=d%4,h=(g+1)%a.length,e=(b[g].x+b[h].x)/2,f=(b[g].y+b[h].y)/2),c.element.toFront().attr({x:e-(c.isCorner?m.opts.customCorners?Math.ceil(m.opts.customCorners.size/2):m.opts.size.bboxCorners:m.opts.size.bboxSides),y:f-(c.isCorner?m.opts.customCorners?Math.ceil(m.opts.customCorners.size/2):m.opts.size.bboxCorners:m.opts.size.bboxSides)}).transform(m.opts.customCorners?null:"R"+m.attrs.rotate),c.x=j[d][0],c.y=j[d][1]})),m.circle&&m.circle.attr({cx:m.attrs.center.x+m.attrs.translate.x,cy:m.attrs.center.y+m.attrs.translate.y,r:Math.max(d.x,d.y)*m.opts.distance}),m.handles.center&&m.handles.center.disc.toFront().attr({cx:m.attrs.center.x+m.attrs.translate.x,cy:m.attrs.center.y+m.attrs.translate.y}),m.opts.rotate.indexOf("self")>=0&&(d=Math.max(Math.sqrt(Math.pow(a[1].x-a[0].x,2)+Math.pow(a[1].y-a[0].y,2)),Math.sqrt(Math.pow(a[2].x-a[1].x,2)+Math.pow(a[2].y-a[1].y,2)))/2),m},m.showHandles=function(){var b,c,d,e,j=[];if(draggables=[],m.hideHandles(),m.axes.map(function(a){m.handles[a]={},m.handles[a].line=q.path(["M",m.attrs.center.x,m.attrs.center.y]).attr({stroke:m.opts.attrs.stroke,"stroke-dasharray":"- ",opacity:.5}),m.handles[a].disc=q.circle(m.attrs.center.x,m.attrs.center.y,m.opts.size.axes).attr(m.opts.attrs)}),m.opts.draw.indexOf("bbox")>=0)for(m.bbox=q.path("").attr({stroke:m.opts.attrs.stroke,"stroke-dasharray":"- ",opacity:.5}),m.handles.bbox=[],b=m.opts.scale.indexOf("bboxCorners")||m.opts.customCorners>=0?0:4;b<(-1===m.opts.scale.indexOf("bboxSides")?4:8);b++)c={},c.index=b,c.axis=b%2?"x":"y",c.isCorner=4>b,c.isCorner&&m.opts.customCorners?c.element=q.image(m.opts.customCorners.corners[b].image,m.attrs.center.x,m.attrs.center.y,m.opts.customCorners.size,m.opts.customCorners.size):c.element=q.rect(m.attrs.center.x,m.attrs.center.y,2*m.opts.size[c.isCorner?"bboxCorners":"bboxSides"],2*m.opts.size[c.isCorner?"bboxCorners":"bboxSides"]).attr(m.opts.attrs),m.handles.bbox[b]=c;return-1!==m.opts.draw.indexOf("circle")&&(m.circle=q.circle(0,0,0).attr({stroke:m.opts.attrs.stroke,"stroke-dasharray":"- ",opacity:.3})),-1!==m.opts.drag.indexOf("center")&&(m.handles.center={},m.handles.center.disc=q.circle(m.attrs.center.x,m.attrs.center.y,m.opts.size.center).attr(m.opts.attrs)),m.axes.map(function(a){m.handles[a]&&j.push({element:m.handles[a].disc,rotate:-1!==m.opts.rotate.indexOf("axis"+a.toUpperCase()),scale:-1!==m.opts.scale.indexOf("axis"+a.toUpperCase()),axis:a,isCorner:!1})}),m.opts.customCorners&&m.handles.bbox.map(function(a){var b;"undefined"!=typeof m.opts.customCorners.corners[a.index]&&(b=m.opts.customCorners.corners[a.index].action,("rotate"===b||"scale"===b)&&j.push({element:a.element,rotate:"rotate"===b,scale:"scale"===b,axis:"x",isCorner:!0}))}),j.map(function(a){a.element.drag(function(b,c){var d,e,h,j,k,n,o={x:m.o.scale.x<0,y:m.o.scale.y<0};m.o.viewBoxRatio&&(b*=m.o.viewBoxRatio.x,c*=m.o.viewBoxRatio.y),d=b+a.element.ox,e=c+a.element.oy,a.rotate&&(h=Math.atan2(e-m.o.center.y-m.o.translate.y,d-m.o.center.x-m.o.translate.x),m.attrs.rotate=180*h/Math.PI-m.o.angle,o[a.axis]&&(m.attrs.rotate-=180)),m.opts.boundary&&(d=Math.max(Math.min(d,m.opts.boundary.x+(m.opts.boundary.width||f().x*(m.o.viewBoxRatio&&m.o.viewBoxRatio.x||1))),m.opts.boundary.x),e=Math.max(Math.min(e,m.opts.boundary.y+(m.opts.boundary.height||f().y*(m.o.viewBoxRatio&&m.o.viewBoxRatio.y||1))),m.opts.boundary.y)),j=d-m.o.center.x-m.o.translate.x-(m.opts.customCorners?m.opts.customCorners.distance:0),k=e-m.o.center.y-m.o.translate.y-(m.opts.customCorners?m.opts.customCorners.distance:0),n=Math.sqrt(Math.pow(j,2)+Math.pow(k,2)),a.scale&&(m.attrs.scale[a.axis]=n/(m.o.size[a.axis]/2*m.o.distance),o[a.axis]&&(m.attrs.scale[a.axis]*=-1)),g(),-1!==m.opts.keepRatio.indexOf("axis"+a.axis.toUpperCase())?i(a.axis):m.attrs.ratio=m.attrs.scale.x/m.attrs.scale.y,m.attrs.scale.x&&m.attrs.scale.y&&m.apply(),l([a.rotate?"rotate":null,a.scale?"scale":null])},function(){m.o=k(m.attrs),q._viewBox&&(m.o.viewBoxRatio={x:q._viewBox[2]/f().x,y:q._viewBox[3]/f().y}),a.element.ox=this.attrs.cx?this.attrs.cx:this.attrs.x+this.attrs.width/2,a.element.oy=this.attrs.cy?this.attrs.cy:this.attrs.y+this.attrs.height/2,a.isCorner?(hypotenuse=Math.sqrt(Math.pow(m.o.size.x*m.o.scale.x,2)+Math.pow(m.o.size.y*m.o.scale.y,2))/2,opposite=m.o.size.x*m.o.scale.x/2,pos={x:a.element.ox-(m.o.center.x+m.o.x+m.o.translate.x),y:a.element.oy-(m.o.center.y+m.o.y+m.o.translate.y)},m.o.distance=hypotenuse/opposite,m.o.angle=90-180*Math.atan2(pos.x,pos.y)/Math.PI-m.o.rotate):(m.o.distance=m.opts.distance,m.o.angle="y"===a.axis?90:0),l([a.rotate?"rotate start":null,a.scale?"scale start":null])},function(){l([a.rotate?"rotate end":null,a.scale?"scale end":null])})}),m.opts.draw.indexOf("bbox")>=0&&!m.opts.customCorners&&(-1!==m.opts.scale.indexOf("bboxCorners")||-1!==m.opts.scale.indexOf("bboxSides"))&&m.handles.bbox.map(function(a){a.element.drag(function(b,c){var d,e,f,j,n,o,p,q,r,s,t,u,v,w=k(m.attrs),x={x:0,y:0};m.o.viewBoxRatio&&(b*=m.o.viewBoxRatio.x,c*=m.o.viewBoxRatio.y),d=m.o.rotate.sin,e=m.o.rotate.cos,f=b*e-c*d,j=b*d+c*e,f*=Math.abs(a.x),j*=Math.abs(a.y),n=f*e+j*d,o=f*-d+j*e,m.attrs.translate={x:m.o.translate.x+n/2,y:m.o.translate.y+o/2},p=m.o.handlePos.cx+b-m.attrs.center.x-m.attrs.translate.x,q=m.o.handlePos.cy+c-m.attrs.center.y-m.attrs.translate.y,f=p*e-q*d,j=p*d+q*e,a.isCorner&&-1!==m.opts.keepRatio.indexOf("bboxCorners")&&(t=m.attrs.size.x*m.attrs.scale.x/(m.attrs.size.y*m.attrs.scale.y),u=f*a.x*(1/t),v=j*a.y*t,v>u*t?f=v*a.x:j=u*a.y),r=2*f*a.x/m.o.size.x,s=2*j*a.y/m.o.size.y,m.attrs.scale={x:r||m.attrs.scale.x,y:s||m.attrs.scale.y},h().x&&h().y||(m.attrs=w),g(),(a.isCorner&&-1!==m.opts.keepRatio.indexOf("bboxCorners")||!a.isCorner&&-1!==m.opts.keepRatio.indexOf("bboxSides"))&&(i(a.axis),x.x=(m.attrs.scale.x-m.o.scale.x)*m.o.size.x*a.x,x.y=(m.attrs.scale.y-m.o.scale.y)*m.o.size.y*a.y,f=x.x*e+x.y*d,j=-x.x*d+x.y*e,m.attrs.translate.x=m.o.translate.x+f/2,m.attrs.translate.y=m.o.translate.y+j/2),m.attrs.ratio=m.attrs.scale.x/m.attrs.scale.y,l(["scale"]),m.apply()},function(){var b=(360-m.attrs.rotate)%360/180*Math.PI,c=a.element.attr(["x","y"]);m.o=k(m.attrs),m.o.handlePos={cx:c.x+m.opts.size[a.isCorner?"bboxCorners":"bboxSides"],cy:c.y+m.opts.size[a.isCorner?"bboxCorners":"bboxSides"]},m.o.rotate={sin:Math.sin(b),cos:Math.cos(b)},q._viewBox&&(m.o.viewBoxRatio={x:q._viewBox[2]/f().x,y:q._viewBox[3]/f().y}),l(["scale start"])},function(){l(["scale end"])})}),m.opts.customCorners&&m.handles.bbox.map(function(a){"undefined"!=typeof m.opts.customCorners.corners[a.index]&&-1===["drag","rotate","scale"].indexOf(m.opts.customCorners.corners[a.index].action)&&(a.element.drag(function(){return!1}),a.element.click(function(){l(["custom:"+m.opts.customCorners.corners[a.index].action])}))}),m.opts.drag.indexOf("self")>=0&&-1===m.opts.scale.indexOf("self")&&-1===m.opts.rotate.indexOf("self")&&draggables.push(a),m.opts.drag.indexOf("center")>=0&&draggables.push(m.handles.center.disc),m.opts.customCorners&&m.handles.bbox.map(function(a){"undefined"!=typeof m.opts.customCorners.corners[a.index]&&"drag"===m.opts.customCorners.corners[a.index].action&&draggables.push(a.element)}),draggables.map(function(b){b.drag(function(a,b){var c=k(m.o.bbox);m.o.viewBoxRatio&&(a*=m.o.viewBoxRatio.x,b*=m.o.viewBoxRatio.y),m.attrs.translate.x=m.o.translate.x+a,m.attrs.translate.y=m.o.translate.y+b,c.x+=a,c.y+=b,g(c),l(["drag"]),m.apply()},function(){m.o=k(m.attrs),m.opts.snap.drag&&(m.o.bbox=a.getBBox()),q._viewBox&&(m.o.viewBoxRatio={x:q._viewBox[2]/f().x,y:q._viewBox[3]/f().y}),m.axes.map(function(a){m.handles[a]&&(m.handles[a].disc.ox=m.handles[a].disc.attrs.cx,m.handles[a].disc.oy=m.handles[a].disc.attrs.cy)}),l(["drag start"])},function(){l(["drag end"])})}),d=m.opts.rotate.indexOf("self")>=0,e=m.opts.scale.indexOf("self")>=0,(d||e)&&a.drag(function(a,b,c,f){var h,i,j={x:m.o.scale.x<0,y:m.o.scale.y<0};d&&(h=Math.atan2(f-m.o.center.y-m.o.translate.y,c-m.o.center.x-m.o.translate.x),m.attrs.rotate=m.o.rotate+180*h/Math.PI-m.o.deg),e&&(i=Math.sqrt(Math.pow(c-m.o.center.x-m.o.translate.x,2)+Math.pow(f-m.o.center.y-m.o.translate.y,2)),m.attrs.scale.x=m.attrs.scale.y=(j.x?-1:1)*m.o.scale.x+(i-m.o.radius)/(m.o.size.x/2),j.x&&(m.attrs.scale.x*=-1),j.y&&(m.attrs.scale.y*=-1)),g(),m.apply(),l([d?"rotate":null,e?"scale":null])},function(a,b){m.o=k(m.attrs),m.o.deg=180*Math.atan2(b-m.o.center.y-m.o.translate.y,a-m.o.center.x-m.o.translate.x)/Math.PI,m.o.radius=Math.sqrt(Math.pow(a-m.o.center.x-m.o.translate.x,2)+Math.pow(b-m.o.center.y-m.o.translate.y,2)),q._viewBox&&(m.o.viewBoxRatio={x:q._viewBox[2]/f().x,y:q._viewBox[3]/f().y}),l([d?"rotate start":null,e?"scale start":null])},function(){l([d?"rotate end":null,e?"scale end":null])}),m.updateHandles(),m},m.hideHandles=function(a){var a=a||{};return void 0===a.undrag&&(a.undrag=!0),a.undrag&&m.items.map(function(a){a.el.undrag()}),m.handles.center&&(m.handles.center.disc.remove(),m.handles.center=null),["x","y"].map(function(a){m.handles[a]&&(m.handles[a].disc.remove(),m.handles[a].line.remove(),m.handles[a]=null)}),m.bbox&&(m.bbox.remove(),m.bbox=null,m.handles.bbox&&(m.handles.bbox.map(function(a){a.element.remove()}),m.handles.bbox=null)),m.circle&&(m.circle.remove(),m.circle=null),m},m.setOpts=function(a,b){var c,d;void 0!==b&&(m.callback="function"==typeof b?b:!1);for(c in a)if(a[c]&&a[c].constructor===Object){m.opts[c]===!1&&(m.opts[c]={});for(d in a[c])a[c].hasOwnProperty(d)&&(m.opts[c][d]=a[c][d])}else m.opts[c]=a[c];return m.opts.animate===!0&&(m.opts.animate={delay:700,easing:"linear"}),m.opts.drag===!0&&(m.opts.drag=["center","self"]),m.opts.keepRatio===!0&&(m.opts.keepRatio=["axisX","axisY","bboxCorners","bboxSides"]),m.opts.rotate===!0&&(m.opts.rotate=["axisX","axisY"]),m.opts.scale===!0&&(m.opts.scale=["axisX","axisY","bboxCorners","bboxSides"]),["drag","draw","keepRatio","rotate","scale"].map(function(a){m.opts[a]===!1&&(m.opts[a]=[])}),m.axes=[],(m.opts.rotate.indexOf("axisX")>=0||m.opts.scale.indexOf("axisX")>=0)&&m.axes.push("x"),(m.opts.rotate.indexOf("axisY")>=0||m.opts.scale.indexOf("axisY")>=0)&&m.axes.push("y"),["drag","rotate","scale"].map(function(a){m.opts.snapDist[a]||(m.opts.snapDist[a]=m.opts.snap[a])}),m.opts.range={rotate:[parseFloat(m.opts.range.rotate[0]),parseFloat(m.opts.range.rotate[1])],scale:[parseFloat(m.opts.range.scale[0]),parseFloat(m.opts.range.scale[1])]},m.opts.snap={drag:parseFloat(m.opts.snap.drag)||0,rotate:parseFloat(m.opts.snap.rotate)||0,scale:parseFloat(m.opts.snap.scale)||0},m.opts.snapDist={drag:parseFloat(m.opts.snapDist.drag)||0,rotate:parseFloat(m.opts.snapDist.rotate)||0,scale:parseFloat(m.opts.snapDist.scale)||0},"string"==typeof m.opts.size&&(m.opts.size=parseFloat(m.opts.size)||0),isNaN(m.opts.size)||(m.opts.size={axes:m.opts.size,bboxCorners:m.opts.size,bboxSides:m.opts.size,center:m.opts.size}),m.opts.customCorners&&(m.opts.customCorners.size=parseFloat(m.opts.customCorners.size)||0,m.opts.customCorners.distance=parseFloat(m.opts.customCorners.distance)||0),m.showHandles(),l(["init"]),m},m.setOpts(b,c),m.apply=function(){return m.items.map(function(a,b){var c={x:m.attrs.center.x+m.offset.translate.x,y:m.attrs.center.y+m.offset.translate.y},d=m.attrs.rotate-m.offset.rotate,e={x:m.attrs.scale.x/m.offset.scale.x,y:m.attrs.scale.y/m.offset.scale.y},f={x:m.attrs.translate.x-m.offset.translate.x,y:m.attrs.translate.y-m.offset.translate.y};m.opts.animate?(l(["animate start"]),a.el.animate({transform:["R",d,c.x,c.y,"S",e.x,e.y,c.x,c.y,"T",f.x,f.y]+m.items[b].transformString},m.opts.animate.delay,m.opts.animate.easing,function(){l(["animate end"]),m.updateHandles()})):(a.el.transform(["R",d,c.x,c.y,"S",e.x,e.y,c.x,c.y,"T",f.x,f.y]+m.items[b].transformString),l(["apply"]),m.updateHandles())}),m},m.unplug=function(){var b=m.attrs;return m.hideHandles(),delete a.freeTransform,b},d(a),m.items.map(function(a,b){a.el._&&a.el._.transform&&"object"==typeof a.el._.transform&&a.el._.transform.map(function(a){if(a[0])switch(a[0].toUpperCase()){case"T":m.items[b].attrs.translate.x+=a[1],m.items[b].attrs.translate.y+=a[2];break;case"S":m.items[b].attrs.scale.x*=a[1],m.items[b].attrs.scale.y*=a[2];break;case"R":m.items[b].attrs.rotate+=a[1]}})}),"set"!==a.type&&(m.attrs.rotate=m.items[0].attrs.rotate,m.attrs.scale=m.items[0].attrs.scale,m.attrs.translate=m.items[0].attrs.translate,m.items[0].attrs={rotate:0,scale:{x:1,y:1},translate:{x:0,y:0}},m.items[0].transformString=""),m.attrs.ratio=m.attrs.scale.x/m.attrs.scale.y,m.updateHandles(),m)}}),$.Class("fr.ina.amalia.player.helpers.BrowserFeatureDetection",{isMobilePlatform:function(){return navigator.userAgent.match(/(iPod|iPhone|iPad)/)||navigator.userAgent.toLowerCase().indexOf("android")>-1}},{settings:{},logger:null,init:function(a){this.settings=$.extend({debug:!1},a||{}),void 0!==fr.ina.amalia.player.log&&void 0!==fr.ina.amalia.player.log.LogHandler&&(this.logger=new fr.ina.amalia.player.log.LogHandler({enabled:this.settings.debug}))},isSupportsVideos:function(){return document.createElement("video").canPlayType?(null!==this.logger&&this.logger.info("Support html5"),!0):(null!==this.logger&&this.logger.info("Can't support html5"),!1)},isSupportsMp4:function(){if(this.isSupportsVideos()){var a=document.createElement("video");return a.canPlayType("video/mp4")?(null!==this.logger&&this.logger.info("Support mp4"),!0):(null!==this.logger&&this.logger.info("Can't support mp4"),!1)}return!1}}),$.Class("fr.ina.amalia.player.helpers.HTML5Helper",{isFullScreen:function(){var a=$(document).context;return a.fullscreen||a.mozFullScreen||a.webkitIsFullScreen},toggleFullScreen:function(a,b){var c=$(document).context,d=c.fullscreen||c.mozFullScreen||c.webkitIsFullScreen?!0:!1;if(d===!1||b===!0){var e=a.requestFullScreen||a.webkitRequestFullScreen||a.mozRequestFullScreen||a.msRequestFullscreen||a.webkitEnterFullscreen;if("undefined"!=typeof e&&e)return e.call(a),!0}else{var f=document.cancelFullScreen||document.mozCancelFullScreen||document.webkitCancelFullScreen;if("undefined"!=typeof f&&f)return f.call(document),!1}}},{}),$.Class("fr.ina.amalia.player.helpers.UtilitiesHelper",{formatTime:function(a,b,c){var d=d||"f",e=b||25,f=Math.floor(Math.floor(1e5*(a-Math.floor(a)))*e/1e5),g=Math.floor(a/60),h=Math.floor(g/60),i=a%60;switch(a=Math.floor(a%60),g=Math.floor(g%60),g=g>=10?g:"0"+g,h=h>=10?h:"0"+h,a=a>=10?a:"0"+a,f=f>=10?f:"0"+f,c){case"h":d=h;break;case"m":d=h+":"+g;break;case"s":d=h+":"+g+":"+a;break;case"mms":d=h+":"+g+":"+a+"."+i.toFixed(4).split(".")[1];break;case"ms":d=h+":"+g+":"+a+"."+i.toFixed(2).split(".")[1];break;case"f":d=h+":"+g+":"+a+":"+f;break;case"f_imp":d=h+":"+g+":"+a+"."+f;break;default:d=h+":"+g+":"+a+":"+i.toFixed(2).split(".")[1]}return d},getTimeRange:function(a,b,c){var d=[],e=c||25,f="undefined"==typeof b?"1":b;a=Math.floor(a);for(var g=0;a>=g;g+=f)if("f"===b){g=Math.floor(g);for(var h=0;e>h;h++)g+=1e3/e/1e3,d.push(fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(g,c))}else d.push(fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(g,c));return d},getRangesWithStartAndEndTime:function(a,b,c){for(var d=[],e="undefined"==typeof c?"1":c,f=a;b>=f;f+=e)d.push(f);return d},convertHourToSeconde:function(a){var b=null,c=/\d{2}:\d{2}:\d{2}/,d=c.exec(a);if(null!==d){d=a.split(":");var e=Math.floor(d[0]),f=Math.floor(d[1]),g=parseFloat(d[2]);b=60*e*60+60*f+g}return b},uint6ToB64:function(a){return 26>a?a+65:52>a?a+71:62>a?a-4:62===a?43:63===a?47:65},b64ToUint6:function(a){return a>64&&91>a?a-65:a>96&&123>a?a-71:a>47&&58>a?a+4:43===a?62:47===a?63:0},base64DecToArr:function(a,b){for(var c,d,e=a.replace(/[^A-Za-z0-9\+\/]/g,""),f=e.length,g=b?Math.ceil((3*f+1>>2)/b)*b:3*f+1>>2,h=new Uint8Array(g),i=0,j=0,k=0;f>k;k++)if(d=k&&3,i|=fr.ina.amalia.player.helpers.UtilitiesHelper.b64ToUint6(e.charCodeAt(k))<<18-6*d,3===d||f-k===1){for(c=0;3>c&&g>j;c++,j++)h[j]=i>>>(16>>>c&24)&255;i=0}return h},generateUUID:function(a){var b=(new Date).getTime(),c=a||"",d="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var c=(b+16*Math.random())%16|0;return b=Math.floor(b/16),("x"===a?c:c&&11).toString(16)});return c+d},htmlEscape:function(a){return String(a).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}},{}),$.Class("fr.ina.amalia.player.PlayerErrorCode",{ACCESS_DENIED:1001,MEDIA_FILE_NOT_FOUND:2001,CUSTOM_ERROR:3001,EXCEPTION:4001,HTTP_ERROR:5001,ABORT:6001,TIMEOUT:7008,ERROR:8008,ERROR_HTML5_SUPPORT:8e3,ERROR_LOAD_PLUGIN:9001,getMessage:function(a){var b=fr.ina.amalia.player.PlayerErrorCode,c=fr.ina.amalia.player.PlayerErrorMessage;switch(a){case b.ACCESS_DENIED:return c.ACCESS_DENIED;case b.MEDIA_FILE_NOT_FOUND:return c.MEDIA_FILE_NOT_FOUND;case b.EXCEPTION:return c.EXCEPTION;case b.HTTP_ERROR:return c.HTTP_ERROR;case b.ABORT:return c.ABORT;case b.TIMEOUT:return c.TIMEOUT;case b.ERROR_LOAD_PLUGIN:return c.ERROR_LOAD_PLUGIN;case b.CUSTOM_ERROR:return c.CUSTOM_ERROR;case b.ERROR:return c.ERROR;case b.ERROR_HTML5_SUPPORT:return c.ERROR_HTML5_SUPPORT;default:return c.DEFAULT}}},{}),$.Class("fr.ina.amalia.player.PlayerErrorMessage",{ACCESS_DENIED:"AccÃ¨s refusÃ©.",MEDIA_FILE_NOT_FOUND:"Erreur lors du chargement du mÃ©dia.",EXCEPTION:"An exception occurred.",HTTP_ERROR:"Http response at 400 or 500 level.",ABORT:"Votre requÃªte a Ã©tÃ© interrompue.",TIMEOUT:"Demande dÃ©passÃ©.",ERROR_LOAD_PLUGIN:"Erreur inattendue lors de l'initialisation du plug-in.",CUSTOM_ERROR:"Une erreur s'est produite sur votre lecteur.",ERROR:"Une erreur s'est produite sur votre lecteur.",DEFAULT:"Une erreur s'est produite sur votre lecteur.",ERROR_HTML5_SUPPORT:"Une erreur s'est produite sur votre lecteur: Votre navigateur ne gÃ¨re pas les balises HTML5."},{}),$.Class("fr.ina.amalia.player.PlayerEventType",{STARTED:"fr.ina.amalia.player.PlayerEventType.STARTED",PLAYING:"fr.ina.amalia.player.PlayerEventType.PLAYING",PAUSED:"fr.ina.amalia.player.PlayerEventType.PAUSED",ENDEN:"fr.ina.amalia.player.PlayerEventType.ENDEN",MUTE:"fr.ina.amalia.player.PlayerEventType.MUTE",UN_MUTE:"fr.ina.amalia.player.PlayerEventType.UN_MUTE",VOLUME_CHANGE:"fr.ina.amalia.player.PlayerEventType.VOLUME_CHANGE",TIME_CHANGE:"fr.ina.amalia.player.PlayerEventType.TIME_CHANGE",FULLSCREEN_CHANGE:"fr.ina.amalia.player.PlayerEventType.FULLSCREEN_CHANGES",SEEK:"fr.ina.amalia.player.PlayerEventType.SEEK",ERROR:"fr.ina.amalia.player.PlayerEventType.ERROR",PLUGIN_READY:"fr.ina.amalia.player.PlayerEventType.PLUGIN_READY",PLUGIN_ERROR:"fr.ina.amalia.player.PlayerEventType.PLUGIN_ERROR",DATA_CHANGE:"fr.ina.amalia.player.PlayerEventType.DATA_CHANGE",BEGIN_DATA_CHANGE:"fr.ina.amalia.player.PlayerEventType.BEGIN_DATA_CHANGE",END_DATA_CHANGE:"fr.ina.amalia.player.PlayerEventType.END_DATA_CHANGE",IMAGE_CAPTURE:"fr.ina.amalia.player.PlayerEventType.IMAGE_CAPTURE",ZOOM_RANGE_CHANGE:"fr.ina.amalia.player.PlayerEventType.ZOOM_RANGE_CHANGE",SELECTED_METADATA_CHANGE:"fr.ina.amalia.player.PlayerEventType.SELECTED_METADATA_CHANGE",SELECTED_ITEMS_CHANGE:"fr.ina.amalia.player.PlayerEventType.SELECTED_ITEMS_CHANGE",BIND_METADATA:"fr.ina.amalia.player.PlayerEventType.BIND_METADATA",UNBIND_METADATA:"fr.ina.amalia.player.PlayerEventType.UNBIND_METADATA"},{}),$.Class("fr.ina.amalia.player.PlayerMessage",{PLAYER_OPENSOURCE_LINK:"Disponibles en open source.",PLUGIN_OVERLAY_CONTEXT_MENU_ENABLED_DISABLED_PLUGIN:"Activer/dÃ©sactiver le plugin overlay.",PLUGIN_TIMELINE_LABEL_ELEMENTS:"Ã©lÃ©ments.",PLUGIN_TIMELINE_LABEL_ZOOM_IN:"Zoom avant",PLUGIN_TIMELINE_LABEL_ZOOM_OUT:"Zoom arriÃ¨re",PLUGIN_TIMELINE_LABEL_CHANGE_DISPLAY:"Changer la hauteur des lignes.",PLUGIN_TIMELINE_LABEL_SLIDE_LEFT:"Faire dÃ©filer vers la gauche",PLUGIN_TIMELINE_LABEL_SLIDE_RIGHT:"Faire dÃ©filer vers la droit",PLUGIN_TIMELINE_LABEL_SCROLL_UP:"Faire dÃ©filer vers le haut",PLUGIN_TIMELINE_LABEL_SCROLL_DOWN:"Faire dÃ©filer vers le bas",PLUGIN_TIMELINE_LABEL_SHOW_HIDE_TOOTIP:"Activer/dÃ©sactiver les infobulles",PLUGIN_TIMELINE_LABEL_EXPAND:"Maximiser",PLUGIN_TIMELINE_LABEL_SORT:"Trier",PLUGIN_TIMELINE_LABEL_NAV_POINT_PREV:"Aller au marqueur prÃ©cÃ©dent",PLUGIN_TIMELINE_LABEL_NAV_POINT_NEXT:"Aller au marqueur suivant",PLUGIN_TIMELINE_LABEL_TIMEAXE:"Axe temporel",PLUGIN_TIMELINE_LABEL_FOCUS:"Zoom",PLUGIN_TIMELINE_LABEL_CLOSE:"Fermer",PLUGIN_METADATA_LIST_EDITOR_LABEL_HEADER:"Metadata list editor",PLUGIN_METADATA_BLOCK_EDITOR_LABEL_HEADER:"Metadata block editor",PLUGIN_METADATA_ITEMS_EDITOR_LABEL_HEADER:"Metadata items editor",PLUGIN_METADATA_BLOCK_EDITOR_FORM_LABEL_METADATA_ID:"ID",PLUGIN_METADATA_BLOCK_EDITOR_FORM_LABEL_METADATA_LABAL:"Etiquette",PLUGIN_METADATA_BLOCK_EDITOR_FORM_LABEL_METADATA_TYPE:"Type",PLUGIN_METADATA_BLOCK_EDITOR_FORM_LABEL_METADATA_DESCRIPTION:"Description",PLUGIN_METADATA_BLOCK_EDITOR_FORM_LABEL_METADATA_REFERENCE:"RÃ©fÃ©rence",PLUGIN_METADATA_BLOCK_EDITOR_FORM_LABEL_METADATA_AUTHOR:"Auteur",PLUGIN_METADATA_BLOCK_EDITOR_FORM_LABEL_METADATA_SHAPE:"Forme",PLUGIN_METADATA_BLOCK_EDITOR_FORM_LABEL_METADATA_COLOR:"Couleur",PLUGIN_METADATA_ITEMS_EDITOR_NEED_METADTA:"Vous devez sÃ©lectionner au moins un Ã©lÃ©ment dans la liste des mÃ©tadonnÃ©es avant de l'ajouter Ã©lÃ©ment.",PLUGIN_METADATA_ITEMS_EDITOR_NEED_METADTA_ITEM_TYPE:"Vous devez dÃ©finir le type Ã©lÃ©ment.",PLUGIN_TIMELINE_LABEL_BIND:"Attacher/Detacher"},{}),$.Class("fr.ina.amalia.player.BaseLoader",{},{settings:{},logger:null,data:null,handlerData:{},completeHandler:null,player:null,waitLoadEvent:!1,parser:null,init:function(a,b,c,d){this.settings=$.extend({debug:!1,sublocalisations:!1},a||{}),this.player=b,this.parser=null,this.handlerData=$.extend({debug:!1},d||{}),this.completeHandler=c,this.logger=null,"undefined"!=typeof fr.ina.amalia.player.log&&"undefined"!=typeof fr.ina.amalia.player.log.LogHandler&&(this.logger=new fr.ina.amalia.player.log.LogHandler({enabled:this.settings.debug
})),this.initialize()},initialize:function(){null!==this.logger&&this.logger.trace(this.Class.fullName,"initialize"),this.initializeParser()},initializeParser:function(){if(this.parser=null,"json"===this.settings.format)this.parser=new fr.ina.amalia.player.parsers.BaseParserMetadata(this.settings);else try{this.parser=eval("new "+this.settings.format+"(this.settings)")}catch(error){this.parser=null,null!==this.logger&&(this.logger.warn("Unknown host configuration type."),this.logger.error(error.stack))}},setRequestType:function(a){this.requestType=a},setDataType:function(a){this.dataType=a},setTimeout:function(a){this.timeout=a},setSendData:function(a){this.sendData=$.extend(this.sendData,a||{})},getSendData:function(){return this.sendData},getWaitLoadEvent:function(){return this.waitLoadEvent},getData:function(){return this.data},onSuccess:function(a,b){null!==this.logger&&this.logger.trace(this.Class.fullName,"onSuccess status: "+b)},onError:function(a){null!==this.logger&&this.logger.trace(this.Class.fullName,"onError status :"+a)}}),fr.ina.amalia.player.BaseLoader.extend("fr.ina.amalia.player.HttpLoader",{},{requestType:"GET",dataType:"json",sendData:{},timeout:12e4,init:function(a,b,c,d){this._super(a,b,c,d),this.waitLoadEvent=!0},initialize:function(){this._super(),this.load(this.settings.url)},load:function(a){var b=this;$.ajax({type:this.requestType,url:a,timeout:this.timeout,data:this.sendData,dataType:this.dataType,success:function(a,c){b.onSuccess(a,c)},error:function(a,c){b.onError(c)}}),null!==this.logger&&this.logger.trace(this.Class.fullName,"Load url :"+a)},onSuccess:function(a,b){this._super(a,b),this.data=null,null!==this.parser&&(this.data=this.parser.processParserData(a),this.player.addAllMetadata(this.data)),"function"==typeof this.completeHandler&&this.completeHandler(this.handlerData,b)},onError:function(a){this._super(a),this.data=null,"function"==typeof this.completeHandler&&this.completeHandler(this.handlerData,a)}}),fr.ina.amalia.player.BaseLoader.extend("fr.ina.amalia.player.WsLoader",{},{socket:null,listOfMetadata:null,init:function(a,b,c,d){this._super(a,b,c,d),this.waitLoadEvent=!1},initialize:function(){this._super(),this.socket=null,this.listOfMetadata=[],this.connect(this.settings.url),this.player.getMediaPlayer().on(fr.ina.amalia.player.PlayerEventType.DATA_CHANGE,{self:this},this.onPlayerDataChange)},connect:function(a){null!==this.logger&&this.logger.trace(this.Class.fullName,"Load url :"+a),"function"==typeof WebSocket?(this.socket=new WebSocket(a),null!==this.socket&&$(this.socket).on("open",{self:this},this.onOpen).on("close",{self:this},this.onClose).on("message",{self:this},this.onMessage).on("error",{self:this},this.onError)):null!==this.logger&&this.logger.error("Error: WebSocket is not supported by this browser or the server is not started.")},onOpen:function(a){null!==a.data.self.logger&&a.data.self.logger.trace(a.data.self.Class.fullName,"WebSocket connection opened")},onClose:function(a){a.data.self.socket=null,null!==a.data.self.logger&&a.data.self.logger.trace(a.data.self.Class.fullName,"WebSocket connection closed")},onMessage:function(a){try{var b=JSON.parse(a.originalEvent.data);a.data.self.data=a.data.self.parser.processParserData(b);var c=a.data.self.data.viewControl,d=null!==a.data.self.data.viewControl&&a.data.self.data.viewControl.hasOwnProperty("action")?a.data.self.data.viewControl.action:"";if(null!==a.data.self.data)switch(d){case"add-all":a.data.self.player.updateBlockMetadata(a.data.self.data.id,{id:a.data.self.data.id,label:a.data.self.data.label,type:a.data.self.data.hasOwnProperty("type")?a.data.self.data.type:"default",author:null!==c&&c.hasOwnProperty("author")?c.author:"",color:null!==c&&c.hasOwnProperty("color")?c.color:"",shape:null!==c&&c.hasOwnProperty("shape")?c.shape:""},null),a.data.self.player.addMetadataById(a.data.self.data.id,a.data.self.data.list);break;case"replace-all":a.data.self.player.updateBlockMetadata(a.data.self.data.id,{id:a.data.self.data.id,label:a.data.self.data.label,type:a.data.self.data.hasOwnProperty("type")?a.data.self.data.type:"default",author:null!==c&&c.hasOwnProperty("author")?c.author:"",color:null!==c&&c.hasOwnProperty("color")?c.color:"",shape:null!==c&&c.hasOwnProperty("shape")?c.shape:""},d),a.data.self.player.replaceAllMetadataById(a.data.self.data.id,a.data.self.data.list);break;case"delete-all":a.data.self.player.deleteAllMetadataById(a.data.self.data.id);break;default:a.data.self.player.updateBlockMetadata(a.data.self.data.id,{id:a.data.self.data.id,label:a.data.self.data.label,type:a.data.self.data.hasOwnProperty("type")?a.data.self.data.type:"default",author:null!==c&&c.hasOwnProperty("author")?c.author:"",color:null!==c&&c.hasOwnProperty("color")?c.color:"",shape:null!==c&&c.hasOwnProperty("shape")?c.shape:""},null),a.data.self.player.addMetadataById(a.data.self.data.id,a.data.self.data.list)}}catch(e){a.data.self.data=null,null!==a.data.self.logger&&(a.data.self.logger.error("Error to add metadata"),a.data.self.logger.error(a.originalEvent.data))}},onError:function(a){a.data.self.socket=null,a.data.self.data=null,null!==a.data.self.logger&&(a.data.self.logger.error("Error to initialize, web socket connection."),a.data.self.logger.error(a))},onPlayerDataChange:function(a,b){null!==a.data.self.logger&&(a.data.self.logger.trace(a.data.self.Class.fullName,"onPlayerDataChange"),a.data.self.logger.debug(a),a.data.self.logger.debug(a.data.self.player.getMetadataById(b.id)))}}),$.Class("fr.ina.amalia.player.parsers.BaseParserMetadata",{},{settings:{},logger:null,data:null,init:function(a){this.settings=$.extend({debug:!1,mainLevel:!1},a||{}),"undefined"!=typeof fr.ina.amalia.player.log&&"undefined"!=typeof fr.ina.amalia.player.log.LogHandler&&(this.logger=new fr.ina.amalia.player.log.LogHandler({enabled:this.settings.debug}))},processParserData:function(a){if(null!==a&&"undefined"!=typeof a){if(a.hasOwnProperty("status")===!0&&a.hasOwnProperty("data")===!0&&0===a.status&&null!==a)return this.parseData(a.data);if(a.hasOwnProperty("id")===!0)return this.parseData(a);if("undefined"!==a.length)return this.parseData(a);null!==this.logger&&(this.logger.warn(this.Class.fullName,"Error while filtering Data."),this.logger.warn(a))}return null},parseData:function(a){var b=null;if(null!==this.logger&&this.logger.trace(this.Class.fullName,"parseData"),"undefined"!=typeof a.length){b=[];for(var c in a)a[c].hasOwnProperty("id")===!0?b.push(this.getData(a[c])):null!==this.logger&&this.logger.warn("parseData : Error to find data type.")}else a.hasOwnProperty("id")===!0?b=this.getData(a):null!==this.logger&&this.logger.warn("parseData : Error to find data type.");return b},getData:function(a){var b=null;if(b={},b.id=a.id,b.type=a.type,b.viewControl=a.hasOwnProperty("viewControl")?a.viewControl:null,b.label=a.hasOwnProperty("label")?a.label:a.id,b.list=[],a.hasOwnProperty("localisation")===!0&&null!==a.localisation&&a.localisation.length>0){var c=null;c=this.settings.mainLevel===!0?a.localisation:a.localisation[0].hasOwnProperty("sublocalisations")===!0&&null!==a.localisation[0].sublocalisations&&a.localisation[0].sublocalisations.hasOwnProperty("localisation")?a.localisation[0].sublocalisations.localisation:a.localisation;var d=null,e=null,f="",g="";if(null!==c&&"undefined"!=typeof c&&c.hasOwnProperty("length"))for(var h=0;h<c.length;h++)e=c[h],f=e.hasOwnProperty("label")?e.label:"",g=e.hasOwnProperty("thumb")?e.thumb:null,e.hasOwnProperty("tcin")===!0&&e.hasOwnProperty("tcout")===!0?(d={shape:e.hasOwnProperty("shape")===!0?e.shape:null,data:e.hasOwnProperty("data")===!0?e.data:null,sublocalisations:e.hasOwnProperty("sublocalisations")===!0?e.sublocalisations:null,label:f,thumb:g,tclevel:e.hasOwnProperty("tclevel")===!0?e.tclevel:0,tc:"number"==typeof e.tc?e.tc:fr.ina.amalia.player.helpers.UtilitiesHelper.convertHourToSeconde(e.tc),tcin:"number"==typeof e.tcin?e.tcin:fr.ina.amalia.player.helpers.UtilitiesHelper.convertHourToSeconde(e.tcin),tcout:"number"==typeof e.tcout?e.tcout:fr.ina.amalia.player.helpers.UtilitiesHelper.convertHourToSeconde(e.tcout),duration:fr.ina.amalia.player.helpers.UtilitiesHelper.convertHourToSeconde(e.tcout)-fr.ina.amalia.player.helpers.UtilitiesHelper.convertHourToSeconde(e.tcin),type:e.hasOwnProperty("type")===!0?e.type:null},b.list.push(d)):e.hasOwnProperty("tc")===!0&&null!==e.tc&&(d={shape:e.hasOwnProperty("shape")===!0?e.shape:null,data:e.hasOwnProperty("data")===!0?e.data:null,sublocalisations:e.hasOwnProperty("sublocalisations")===!0?e.sublocalisations:null,label:f,thumb:g,tclevel:e.hasOwnProperty("tclevel")===!0?e.tclevel:0,tc:"number"==typeof e.tc?e.tc:fr.ina.amalia.player.helpers.UtilitiesHelper.convertHourToSeconde(e.tc),type:e.hasOwnProperty("type")===!0?e.type:null},b.list.push(d))}return b}}),$.Class("fr.ina.amalia.player.MetadataManager",{},{mediaPlayer:null,logger:null,settings:{},listOfBlocks:{},listOfMetadata:[],listOfSelectedItems:[],selectedMetadataId:null,init:function(a,b){if(this.mediaPlayer=b,this.settings=$.extend({debug:!1,internalPlugin:!1},a||{}),void 0!==fr.ina.amalia.player.log&&void 0!==fr.ina.amalia.player.log.LogHandler&&(this.logger=new fr.ina.amalia.player.log.LogHandler({enabled:this.settings.debug})),null===this.mediaPlayer)throw new Error("Can't initialize plugin name"+this.Class.fullName)},getBlocksMetadata:function(){try{var a={};for(var b in this.listOfBlocks)if(this.listOfBlocks.hasOwnProperty(b)){var c=JSON.parse(JSON.stringify(this.listOfBlocks[b]));"undefined"!=typeof this.listOfMetadata[b]?c.localisation=JSON.parse(JSON.stringify(this.listOfMetadata[b])):c.localisation=null,a[b]=c}return a}catch(d){null!==this.logger&&(this.logger.warn("Error to return blocks"),this.logger.error(d.stack))}return null},getBlockMetadata:function(a){try{if("undefined"!=typeof this.listOfBlocks[a])return this.listOfBlocks[a]}catch(b){null!==this.logger&&(this.logger.warn("Error to return blocks"),this.logger.error(b.stack))}return null},updateBlockMetadata:function(a,b,c){try{this.listOfBlocks[a]=$.extend(this.listOfBlocks[a],JSON.parse(JSON.stringify(b))),this.mediaPlayer.getMediaPlayer().trigger(fr.ina.amalia.player.PlayerEventType.DATA_CHANGE,{id:a,action:c})}catch(d){null!==this.logger&&(this.logger.warn("Error to add blocks"),this.logger.error(d.stack))}},removeBlockMetadata:function(a){return delete this.listOfBlocks[a]},addAllMetadata:function(a){if("object"==typeof a&&null!==a)if("undefined"!=typeof a.length)for(var b in a)if(a[b].hasOwnProperty("id")){"undefined"==typeof this.listOfMetadata[a[b].id]&&(this.listOfMetadata[a[b].id]=[]);for(var c=0;c<a[b].list.length;c++){var d=a[b].list[c];this.listOfMetadata[a[b].id].push(d)}a[b].hasOwnProperty("type")===!0?this.updateBlockMetadata(a[b].id,{type:a[b].type,id:a[b].id}):this.updateBlockMetadata(a[b].id,{}),this.mediaPlayer.getMediaPlayer().trigger(fr.ina.amalia.player.PlayerEventType.DATA_CHANGE,{id:a[b].id}),null!==this.logger&&this.logger.info("AddAllMetadata ID:"+a[b].id)}else null!==this.logger&&this.logger.warn("parseData : Error to find data type.");else{"undefined"==typeof this.listOfMetadata[a.id]&&(this.listOfMetadata[a.id]=[]);for(var e=0;e<a.list.length;e++){var f=a.list[e];this.listOfMetadata[a.id].push(f)}this.updateBlockMetadata(a.id,{}),this.mediaPlayer.getMediaPlayer().trigger(fr.ina.amalia.player.PlayerEventType.DATA_CHANGE,{id:a.id}),null!==this.logger&&this.logger.info("Add Metadata ID:"+a.id)}else null!==this.logger&&(this.logger.warn("Error to add metadata."),this.logger.warn(a))},addMetadataById:function(a,b){if("undefined"==typeof this.listOfMetadata[a]&&(this.listOfMetadata[a]=[],this.updateBlockMetadata(a,{})),"object"==typeof b){for(var c=0;c<b.length;c++){var d=b[c];this.listOfMetadata[a].push(d)}this.mediaPlayer.getMediaPlayer().trigger(fr.ina.amalia.player.PlayerEventType.DATA_CHANGE,{id:a})}},replaceAllMetadataById:function(a,b){if(this.listOfMetadata[a]=[],"object"==typeof b){this.listOfMetadata[a]=[];for(var c=0;c<b.length;c++){var d=b[c];this.listOfMetadata[a].push(d)}this.mediaPlayer.getMediaPlayer().trigger(fr.ina.amalia.player.PlayerEventType.DATA_CHANGE,{id:a})}},deleteAllMetadataById:function(a){if("undefined"!=typeof this.listOfMetadata[a]){var b=this.listOfMetadata.splice(a,1);b.hasOwnProperty("length")===!0&&b.length>0&&(this.removeBlockMetadata(a),this.selectedMetadataId=null,this.mediaPlayer.getMediaPlayer().trigger(fr.ina.amalia.player.PlayerEventType.SELECTED_METADATA_CHANGE,{metadataId:this.selectedMetadataId}),this.mediaPlayer.getMediaPlayer().trigger(fr.ina.amalia.player.PlayerEventType.DATA_CHANGE,{id:a,action:"deleteBlock"}))}return!1},addMetadataItem:function(a,b){"object"!=typeof this.listOfMetadata[a]&&(this.listOfMetadata[a]=[]),"object"==typeof b&&(this.listOfMetadata[a].push(b),this.mediaPlayer.getMediaPlayer().trigger(fr.ina.amalia.player.PlayerEventType.DATA_CHANGE,{id:a}))},getMetadataById:function(a){return"undefined"==typeof this.listOfMetadata[a]?null:this.listOfMetadata[a]},setMetadataById:function(a,b){if("object"==typeof b)this.listOfMetadata[a]=b;else{if("string"!=typeof b)return!1;try{var c=JSON.parse(b);this.listOfMetadata[a]=c}catch(d){return!1}}return this.mediaPlayer.getMediaPlayer().trigger(fr.ina.amalia.player.PlayerEventType.DATA_CHANGE,{id:a}),!0},removeMetadataById:function(a){this.listOfMetadata[a]=[],this.mediaPlayer.getMediaPlayer().trigger(fr.ina.amalia.player.PlayerEventType.DATA_CHANGE,{id:a})},getMetadataWithRange:function(a,b,c){var d=this.getMetadataById(a),e=[];return null!==d&&"object"==typeof d?(e=$.grep(d,function(a){return a.tc>=b&&a.tc<=c}),null!==this.logger&&this.logger.trace(this.Class.fullName,"getMetadataWithRange Id:"+a+" Tcin:"+b+" Tcout:"+c+" Number of Elements:"+d.length)):null!==this.logger&&this.logger.warn("GetMetadataWithRange:  No data id:"+a),e},getSelectedMetadataId:function(){return null!==this.selectedMetadataId?this.selectedMetadataId.toString():null},setSelectedMetadataId:function(a){this.selectedMetadataId=a,this.mediaPlayer.getMediaPlayer().trigger(fr.ina.amalia.player.PlayerEventType.SELECTED_METADATA_CHANGE,{metadataId:this.selectedMetadataId})},getSelectedItems:function(){return this.listOfSelectedItems},addSelectedItem:function(a){this.listOfSelectedItems.push(a),this.mediaPlayer.getMediaPlayer().trigger(fr.ina.amalia.player.PlayerEventType.SELECTED_ITEMS_CHANGE)},removeSelectedItem:function(a){if("undefined"!==this.listOfSelectedItems[a]&&isNaN(a)===!1){var b=this.listOfSelectedItems[a];null!==b&&(b.selected=!1,b.formCreated=!0),this.listOfSelectedItems[a]=null}},removeAllSelectedItems:function(){if("undefined"!=typeof this.listOfSelectedItems&&this.listOfSelectedItems.hasOwnProperty("length")&&this.listOfSelectedItems.length>0)for(var a=0;a<this.listOfSelectedItems.length;a++){var b=this.listOfSelectedItems[a];null!==b&&(b.selected=!1,b.formCreated=!0)}this.listOfSelectedItems=[]}}),$.Class("fr.ina.amalia.player.LocalisationManager",{},{logger:null,localisation:null,setLoc:function(a){this.localisation=a},getLocTc:function(){if(null!==this.localisation&&this.localisation.length>1){this.localisation.sort(function(a,b){return a.tc="number"==typeof a.tc?a.tc:parseFloat(fr.ina.amalia.player.helpers.UtilitiesHelper.convertHourToSeconde(a.tc)),b.tc="number"==typeof b.tc?b.tc:parseFloat(fr.ina.amalia.player.helpers.UtilitiesHelper.convertHourToSeconde(b.tc)),delete a.firstItem,delete a.lastItem,delete a.tcRange,a.tc-b.tc});for(var a=this.localisation[0],b=this.localisation[this.localisation.length-1],c=0;c<this.localisation.length;c++){var d=this.localisation[c];d.tcRange={min:a.tc,max:b.tc},d.subItem=!0}if(a.hasOwnProperty("tc")&&b.hasOwnProperty("tc"))return a.firstItem=!0,b.lastItem=!0,delete a.range,delete b.range,a.tcRange={max:b.tc},b.tcRange={min:a.tc},{tcin:a.tc,tcout:b.tc}}return null},updateSpacialLocBlock:function(a){if(null!==a&&a.length>0)for(var b=0;b<a.length;b++){var c=a[b];if(c.hasOwnProperty("sublocalisations")&&"object"==typeof c.sublocalisations&&c.sublocalisations.localisation.length>0){c.sublocalisations.localisation.sort(function(a,b){return a.tc-b.tc});for(var d=0;d<c.sublocalisations.localisation.length;d++){var e=c.sublocalisations.localisation[d];null===e.tc&&e.deleted===!0&&c.sublocalisations.localisation.splice(d,1)}if(c.sublocalisations.localisation.sort(function(a,b){return a.tc-b.tc}),1===c.sublocalisations.localisation.length){var f=c.sublocalisations.localisation[0];return c.tc=parseFloat(f.tc),c.shape=$.extend({},f.shape),c.sublocalisations=null,delete c.tcin,delete c.tcout,!0}if(c.sublocalisations.localisation.length>1){var g=c.sublocalisations.localisation[0],h=c.sublocalisations.localisation[c.sublocalisations.localisation.length-1];if(g.hasOwnProperty("tc")&&h.hasOwnProperty("tc"))return c.tc=parseFloat(g.tc),c.tcin=parseFloat(g.tc),c.tcout=parseFloat(h.tc),!0}}}return!1},shiftSpacialLocBlock:function(a,b){var c=b-a.tcin;if(a.tcout+=c,a.hasOwnProperty("sublocalisations")&&"object"==typeof a.sublocalisations){if(a.sublocalisations.localisation.length>0){a.sublocalisations.localisation.sort(function(a,b){return a.tc-b.tc});for(var d=0;d<a.sublocalisations.localisation.length;d++){var e=a.sublocalisations.localisation[d];e.tc+=c}}return!0}return!1}}),$.Class("fr.ina.amalia.player.plugins.controlBar.widgets.WidgetBase",{},{settings:{},logger:null,element:null,component:null,mediaPlayer:null,init:function(a,b,c){this.parameter=$.extend({debug:!0},a||{}),void 0!==fr.ina.amalia.player.log&&void 0!==fr.ina.amalia.player.log.LogHandler&&(this.logger=new fr.ina.amalia.player.log.LogHandler({enabled:this.parameter.debug})),this.container=c,this.mediaPlayer=b,this.initialize()},initialize:function(){},show:function(){this.component.show()},hide:function(){this.component.hide()}}),fr.ina.amalia.player.plugins.controlBar.widgets.WidgetBase.extend("fr.ina.amalia.player.plugins.controlBar.widgets.BaseButton",{classCss:"player-base-button",style:""},{initialize:function(){this.component=$("<div>",{"class":this.Class.classCss,style:this.Class.style});var a=$("<span>",{"class":"button-container"}),b=$("<span>",{"class":this.parameter.style});this.parameter.hasOwnProperty("title")===!0&&b.attr("title",this.parameter.title),a.append(b),this.component.on("click",{self:this,component:this.component},this.onClick),this.component.append(a),this.container.append(this.component)},onClick:function(event){if("undefined"!=typeof event.data.self.parameter.callback)try{eval(event.data.self.parameter.callback+"(event.data.self.mediaPlayer, event.data.self.parameter)")}catch(e){null!==event.data.self.logger&&event.data.self.logger.warn("Send callback failed.")}}}),fr.ina.amalia.player.plugins.controlBar.widgets.WidgetBase.extend("fr.ina.amalia.player.plugins.controlBar.widgets.TimeLabel",{classCss:"player-timelabel time-display off",style:"",eventTypes:{}},{currentTime:null,timeSeparator:null,duration:null,initialize:function(){this.component=$("<div>",{"class":this.Class.classCss,style:this.Class.style}),this.currentTime=$("<span>",{"class":"time-current"}),this.timeSeparator=$("<span>",{"class":"time-separator"}),this.duration=$("<span>",{"class":"time-duration"}),this.component.append(this.currentTime),this.component.append(this.timeSeparator),this.component.append(this.duration),this.container.append(this.component),this.definePlayerEvents()},setCurrentTime:function(a){null!==this.currentTime&&this.currentTime.text(a)},setDuration:function(a){null!==this.duration&&(this.duration.text(a),this.component.removeClass("off").addClass("on"))},definePlayerEvents:function(){this.mediaPlayer.mediaContainer.on(fr.ina.amalia.player.PlayerEventType.TIME_CHANGE,{self:this},this.onTimechange)},onTimechange:function(a,b){var c=fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(b.currentTime,a.data.self.parameter.framerate,a.data.self.parameter.timeFormat),d=fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(b.duration,a.data.self.parameter.framerate,a.data.self.parameter.timeFormat);a.data.self.setCurrentTime(c),a.data.self.setDuration(d)}}),fr.ina.amalia.player.plugins.controlBar.widgets.WidgetBase.extend("fr.ina.amalia.player.plugins.controlBar.widgets.PlayButton",{classCss:"player-play-button",style:""},{initialize:function(){this.component=$("<div>",{"class":this.Class.classCss,style:this.Class.style});var a=$("<span>",{"class":"button-container"}),b=$("<i>",{"class":"ajs-icon ajs-icon-control-play"});a.append(b),this.component.append(a),this.component.on("click",{self:this,component:this.component},this.onClick),this.container.append(this.component),this.definePlayerEvents()},definePlayerEvents:function(){this.mediaPlayer.mediaContainer.on(fr.ina.amalia.player.PlayerEventType.PLAYING,{self:this},this.onPlaying),this.mediaPlayer.mediaContainer.on(fr.ina.amalia.player.PlayerEventType.PAUSED,{self:this},this.onPaused)},onClick:function(a){a.data.self.mediaPlayer.play()},onPlaying:function(a){a.data.self.component.addClass("off").removeClass("on")},onPaused:function(a){a.data.self.component.addClass("on").removeClass("off")}}),fr.ina.amalia.player.plugins.controlBar.widgets.WidgetBase.extend("fr.ina.amalia.player.plugins.controlBar.widgets.PauseButton",{classCss:"player-pause-button",style:""},{initialize:function(){this.component=$("<div>",{"class":this.Class.classCss,style:this.Class.style});var a=$("<span>",{"class":"button-container round"}),b=$("<i>",{"class":"ajs-icon ajs-icon-control-pause"});a.append(b),this.component.append(a),this.component.on("click",{self:this,component:this.component},this.onClick),this.container.append(this.component),this.definePlayerEvents(),this.component.addClass("off").removeClass("on")},definePlayerEvents:function(){this.mediaPlayer.mediaContainer.on(fr.ina.amalia.player.PlayerEventType.PLAYING,{self:this},this.onPlaying),this.mediaPlayer.mediaContainer.on(fr.ina.amalia.player.PlayerEventType.PAUSED,{self:this},this.onPaused)},onClick:function(a){a.data.self.mediaPlayer.pause()},onPlaying:function(a){a.data.self.component.addClass("on").removeClass("off")},onPaused:function(a){a.data.self.component.addClass("off").removeClass("on")}}),fr.ina.amalia.player.plugins.controlBar.widgets.WidgetBase.extend("fr.ina.amalia.player.plugins.controlBar.widgets.FullscreenButton",{classCss:"player-fullscreen-button",classCssFullscreenOn:"ajs-icon ajs-icon-expand",classCssFullscreenOff:"ajs-icon ajs-icon-compress",style:"",eventTypes:{CLICK:"fr.ina.amalia.player.plugins.widgets.FullscreenButton.event.click"}},{initialize:function(){this.component=$("<div>",{"class":this.Class.classCss,style:this.Class.style});var a=$("<span>",{"class":this.Class.classCssFullscreenOn});this.component.append(a),this.component.on("click",{self:this,component:this.component},this.onClick),this.container.append(this.component),this.setFullscreenMode(!1),null!==this.logger&&this.logger.trace(this.Class.fullName,"initialize"),this.definePlayerEvents()},definePlayerEvents:function(){this.mediaPlayer.mediaContainer.on(fr.ina.amalia.player.PlayerEventType.FULLSCREEN_CHANGE,{self:this},this.onFullscreenModeChange)},setFullscreenMode:function(a){a===!0?this.component.find("span").removeClass(this.Class.classCssFullscreenOn).addClass(this.Class.classCssFullscreenOff):this.component.find("span").removeClass(this.Class.classCssFullscreenOff).addClass(this.Class.classCssFullscreenOn)},onClick:function(a){a.data.self.mediaPlayer.toggleFullScreen()},onFullscreenModeChange:function(a,b){a.data.self.setFullscreenMode(b.inFullScreen)}}),fr.ina.amalia.player.plugins.controlBar.widgets.WidgetBase.extend("fr.ina.amalia.player.plugins.controlBar.widgets.VolumeControlBar",{classCss:"player-volume-control",classCssVolumeOn:"ajs-icon ajs-icon-volume-up",classCssVolumeDown:"ajs-icon ajs-icon-volume-down",classCssVolumeOff:"ajs-icon ajs-icon-volume-off",style:"",eventTypes:{CLICK:"fr.ina.amalia.player.plugins.widgets.VolumeControlBar.event.click",CHANGE:"fr.ina.amalia.player.plugins.widgets.VolumeControlBar.event.change",HOVER:"fr.ina.amalia.player.plugins.widgets.VolumeControlBar.event.hover"}},{sliderStart:0,sliderEnd:100,defaultValue:100,volumeControlComponent:null,initialize:function(){this.component=$("<div>",{"class":this.Class.classCss,style:this.Class.style});var a='<input class="volume-control" data-width="70" data-height="70" data-displayInput="false" data-displayPrevious="true" data-skin="tron" data-thickness=".2" data-fgColor="#13e7f0"value="'+this.defaultValue+'" >';this.component.append(a);var b=$("<div>",{"class":"volume-control-btn"}),c=$("<span>");b.append(c);var d=this;this.component.find("input.volume-control").knob({change:function(a){d.onSlide(a)}}),b.on("click",{self:this},this.onClickVolume),this.component.find("div").append(b),this.container.append(this.component),this.definePlayerEvents(),this.setValue(this.mediaPlayer.getVolume()),null!==this.logger&&this.logger.trace(this.Class.fullName,"initialize")},definePlayerEvents:function(){this.mediaPlayer.mediaContainer.on(fr.ina.amalia.player.PlayerEventType.VOLUME_CHANGE,{self:this},this.onPlayerVolumeChange)},onClick:function(a){a.data.component.trigger(a.data.self.Class.eventTypes.CLICK),null!==a.data.self.logger&&a.data.self.logger.trace(a.data.self.Class.fullName,"onClick/triggerevent:"+a.data.self.Class.eventTypes.CLICK)},setValue:function(a){this.component.find("input.volume-control").val(a).trigger("change");var b=this.component.find(".volume-control-btn span:first");b.attr("class",""),0===a?b.addClass(this.Class.classCssVolumeOff):75>a?b.addClass(this.Class.classCssVolumeDown):b.addClass(this.Class.classCssVolumeOn)},onSlide:function(a){this.component.trigger(this.Class.eventTypes.CHANGE,{value:a}),this.mediaPlayer.setVolume(a),null!==this.logger&&this.logger.trace(this.Class.fullName,"onSlide/triggerevent:"+this.Class.eventTypes.CHANGE+" Value "+a)},onClickVolume:function(a){var b=$(a.currentTarget).find("span:first").hasClass(a.data.self.Class.classCssVolumeOn)===!0?0:100;a.data.self.mediaPlayer.setVolume(b),null!==a.data.self.logger&&a.data.self.logger.trace(a.data.self.Class.fullName,"onClickVolume:"+a.data.self.Class.eventTypes.CHANGE+" Value "+b)},onPlayerVolumeChange:function(a,b){null!==a.data.self.logger&&a.data.self.logger.trace(a.data.self.Class.fullName,"onPlayerVolumeChange"+parseInt(b.volume)),a.data.self.setValue(parseInt(b.volume))}}),fr.ina.amalia.player.plugins.controlBar.widgets.WidgetBase.extend("fr.ina.amalia.player.plugins.controlBar.widgets.ProgressBar",{classCss:"player-progress-bar",style:""},{sliderStart:0,sliderEnd:1e3,sliding:!1,defaultValue:0,lastSlideEvent:0,initialize:function(){this.component=$("<div>",{"class":this.Class.classCss,style:this.Class.style}),this.component.slider({range:"min",min:this.sliderStart,max:this.sliderEnd,value:this.defaultValue,height:20,framepreview:!0,framepreviewTimeBound:500}),this.component.prepend($("<div>",{"class":"buffer-bar"})),this.component.on("slidestart",{self:this,component:this.component},this.onSlideStart),this.component.on("slidestop",{self:this,component:this.component},this.onSlideStop),this.parameter.framepreview===!0&&this.component.on("slide",{self:this,component:this.component},this.onSlide),this.container.append(this.component),this.definePlayerEvents()},setValue:function(a){this.sliding===!1&&this.component.slider("value",10*a)},setTitle:function(a){this.component.attr("title",a)},updateBuffer:function(a,b){this.component.find(".buffer-bar").css({left:a+"%",width:b+"%"})},definePlayerEvents:function(){this.mediaPlayer.mediaContainer.on(fr.ina.amalia.player.PlayerEventType.TIME_CHANGE,{self:this},this.onTimechange)},onTimechange:function(a,b){var c=fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(b.currentTime,a.data.self.settings.framerate,a.data.self.settings.timeFormat);a.data.self.setValue(b.percentage),a.data.self.setTitle(c);var d=a.data.self.mediaPlayer.getMediaPlayer().get(0).buffered.end(0),e=100*d/(b.duration-b.tcOffset);a.data.self.updateBuffer(0,e)},onSlideStart:function(a,b){a.data.self.sliding=!0,a.data.self.mediaPlayer.pause(),null!==a.data.self.logger&&a.data.self.logger.trace(a.data.self.Class.fullName,"onSlideStart Value : "+b.value)},onSlideStop:function(a,b){a.data.self.sliding=!1;var c=a.data.self.mediaPlayer.getDuration(),d=b.value/10,e=c*d/100;a.data.self.mediaPlayer.setCurrentTime(e+a.data.self.mediaPlayer.getTcOffset()),null!==a.data.self.logger&&a.data.self.logger.trace(a.data.self.Class.fullName,"onSlideStop value : "+b.value)},onSlide:function(a,b){var c=new Date,d=c-a.data.self.lastSlideEvent;if(d>a.data.self.parameter.framepreviewTimeBound){a.data.self.lastSlideEvent=new Date;var e=a.data.self.mediaPlayer.getDuration(),f=b.value/10,g=e*f/100;a.data.self.mediaPlayer.setCurrentTime(g+a.data.self.mediaPlayer.getTcOffset()),null!==a.data.self.logger&&a.data.self.logger.trace(a.data.self.Class.fullName,"onSlide value : "+b.value)}}}),fr.ina.amalia.player.plugins.controlBar.widgets.WidgetBase.extend("fr.ina.amalia.player.plugins.controlBar.widgets.Label",{classCss:"iplayer-Label label label-default",style:"",eventTypes:{}},{initialize:function(){this.component=$("<div>",{"class":this.Class.classCss,style:this.Class.style,text:this.parameter.defaultValue}),this.container.append(this.component),null!==this.logger&&this.logger.trace(this.Class.fullName,"initialize")},setValue:function(a){this.component.text(a)}}),$.Class("fr.ina.amalia.player.plugins.PluginBase",{classCss:"plugin-default",style:""},{namespace:null,uuid:null,pluginContainer:null,mediaPlayer:null,logger:null,loaderContainer:null,settings:{},eventTag:"",listOfpluginTypes:[],bindingManager:null,init:function(a,b,c,d){if(this.mediaPlayer=b,this.pluginContainer=$(c),this.namespace=this.Class.fullName,this.bindingManager=d,this.settings=$.extend({debug:!1,internalPlugin:!1},a||{}),this.eventTag=this.Class.fullName+"_"+this.pluginContainer.attr("id"),this.settings.internalPlugin===!1&&(this.pluginContainer.addClass(this.Class.classCss),this.createLoader(),this.loaderContainer.show()),void 0!==fr.ina.amalia.player.log&&void 0!==fr.ina.amalia.player.log.LogHandler&&(this.logger=new fr.ina.amalia.player.log.LogHandler({enabled:this.settings.debug})),null===this.mediaPlayer)throw new Error("Can't initialize plugin name"+this.Class.fullName);try{this.settings.internalPlugin===!1?(null!==this.loaderContainer&&this.loaderContainer.hide(),this.initialize()):this.initialize()}catch(e){null!==this.logger&&this.logger.error(e.stack)}},initialize:function(){},setUuid:function(a){this.uuid=a.toString(),this.pluginContainer.attr("data-plugin-id",this.uuid)},getUuid:function(){return this.uuid.toString()},initializeError:function(a){var b=fr.ina.amalia.player.PlayerErrorCode.getMessage(a),c=$("<div>",{"class":"ajs-error",style:"",text:b});this.pluginContainer.append(c)},createLoader:function(){this.loaderContainer=$("<div>",{"class":"ajs-loader fa fa-cog fa-spin",style:""}),this.loaderContainer.hide(),this.pluginContainer.append(this.loaderContainer)},registerPluginType:function(a){"string"==typeof a&&""!==a&&this.listOfpluginTypes.push(a)},getPluginTypes:function(){return this.listOfpluginTypes},onPluginReady:function(a){null!==a.data.self.logger&&a.data.self.logger.trace(a.data.self.Class.fullName,"onPluginReady"),null!==a.data.self&&(a.data.self.initialize(),null!==a.data.self.loaderContainer&&a.data.self.loaderContainer.hide())},onPluginError:function(a,b){if(null!==a.data.self.logger&&a.data.self.logger.warn("PluginBase/onPluginError"),null!==a.data.self){var c="undefined"==typeof b.errorCode?"":b.errorCode;a.data.self.initializeError(c),null!==a.data.self.loaderContainer&&a.data.self.loaderContainer.hide()}}}),fr.ina.amalia.player.plugins.PluginBase.extend("fr.ina.amalia.player.plugins.PluginBaseMultiBlocks",{METADATA_DISPLAY_TYPE:{STATIC:1,STATIC_DYNAMIC:2,DYNAMIC:3}},{loadDataStarted:!1,dataToDeal:null,managedMetadataIds:[],notManagedMetadataIds:null,listOfMetadataTypes:null,addManagedMetadataType:function(a){"string"==typeof a&&""!==a&&this.listOfMetadataTypes.push(a);
},isManagedMetadataType:function(a){return $.inArray(a,this.listOfMetadataTypes)>-1},getManagedMetadataTypes:function(){return this.listOfMetadataTypes},isManagedMetadataId:function(a){return $.inArray(a,this.managedMetadataIds)>-1||$.inArray(a,this.notManagedMetadataIds)>-1},isBoundMetadataId:function(a){return $.inArray(a,this.managedMetadataIds)>-1},getBindIds:function(){return this.managedMetadataIds},bindMetadataId:function(a){this.addManagedMetadataId(a)},unbindMetadataId:function(a){this.removeManagedMetadataId(a)},addManagedMetadataId:function(a){if(a="number"==typeof a?a.toString():a,"string"==typeof a&&""!==a&&-1===this.managedMetadataIds.indexOf(a)){this.managedMetadataIds.push(a);var b=this.notManagedMetadataIds.indexOf(a);b>-1&&this.notManagedMetadataIds.splice(b,1)}},removeManagedMetadataId:function(a){if(a="number"==typeof a?a.toString():a,"string"==typeof a&&""!==a&&-1===this.notManagedMetadataIds.indexOf(a)){this.notManagedMetadataIds.push(a);var b=this.managedMetadataIds.indexOf(a);b>-1&&this.managedMetadataIds.splice(b,1)}}}),fr.ina.amalia.player.plugins.PluginBase.extend("fr.ina.amalia.player.plugins.PluginBaseSimpleBlock",{},{managedDataType:"",addManagedDataType:function(a){"string"==typeof a&&""!==a&&(this.managedDataType=a)},isManagedType:function(a){return this.managedDataType===a},getManagedType:function(){return this.managedDataType}}),$.Class("fr.ina.amalia.player.PluginBindingManager",{dataTypes:{DEFAULT:"default",DETECTION:"detection",VISUAL_DETECTION:"visual_detection",VISUAL_TRACKING:"visual_tracking",SEGMENTATION:"segmentation",AUDIO_SEGMENTATION:"audio_segmentation",TRANSCRIPTION:"transcription",SYNCHRONIZED_TEXT:"synchronized_text",KEYFRAMES:"keyframes",HISTOGRAM:"histogram"},pluginTypes:{TIMELINE_CUEPOINT:"timeline_cuepoint",TIMELINE_SEGMENT:"timeline_segment",TIMELINE_IMAGE:"timeline_image",TIMELINE_HISTOGRAM:"timeline_histogram",TIMELINE_VISUAL:"timeline_visual",TEXT_SYNC:"text-sync",CAPTION:"caption",OVERLAY:"overlay"}},{mediaPlayer:null,logger:null,settings:{},listOfDataTypes:null,listOfPluginTypes:null,pluginAndDataTypeMap:null,listOfPlugins:null,init:function(a,b){if(this.listOfPlugins=[],this.mediaPlayer=b,this.settings=$.extend({debug:!1,internalPlugin:!1},a||{}),void 0!==fr.ina.amalia.player.log&&void 0!==fr.ina.amalia.player.log.LogHandler&&(this.logger=new fr.ina.amalia.player.log.LogHandler({enabled:this.settings.debug})),null===this.mediaPlayer)throw new Error("Can't initialize plugin name"+this.Class.fullName);this.setDefaultDataTypes(),this.setDefaultPluginAndDataTypeMap(),this.setDefaultPluginsTypes()},setDefaultDataTypes:function(){this.listOfDataTypes=[],this.listOfDataTypes.push(fr.ina.amalia.player.PluginBindingManager.dataTypes.DETECTION),this.listOfDataTypes.push(fr.ina.amalia.player.PluginBindingManager.dataTypes.VISUAL_DETECTION),this.listOfDataTypes.push(fr.ina.amalia.player.PluginBindingManager.dataTypes.VISUAL_TRACKING),this.listOfDataTypes.push(fr.ina.amalia.player.PluginBindingManager.dataTypes.SEGMENTATION),this.listOfDataTypes.push(fr.ina.amalia.player.PluginBindingManager.dataTypes.AUDIO_SEGMENTATION),this.listOfDataTypes.push(fr.ina.amalia.player.PluginBindingManager.dataTypes.TRANSCRIPTION),this.listOfDataTypes.push(fr.ina.amalia.player.PluginBindingManager.dataTypes.SYNCHRONIZED_TEXT),this.listOfDataTypes.push(fr.ina.amalia.player.PluginBindingManager.dataTypes.KEYFRAMES),this.listOfDataTypes.push(fr.ina.amalia.player.PluginBindingManager.dataTypes.HISTOGRAM)},setDefaultPluginsTypes:function(){this.listOfPluginTypes=[],this.listOfPluginTypes.push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_CUEPOINT),this.listOfPluginTypes.push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_SEGMENT),this.listOfPluginTypes.push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_IMAGE),this.listOfPluginTypes.push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_HISTOGRAM),this.listOfPluginTypes.push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.CAPTION),this.listOfPluginTypes.push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.TEXT_SYNC),this.listOfPluginTypes.push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.OVERLAY)},setDefaultPluginAndDataTypeMap:function(){this.pluginAndDataTypeMap=[],this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.DEFAULT]=[],this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.DETECTION]=[],this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.DETECTION].push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_CUEPOINT),this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.VISUAL_DETECTION]=[],this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.VISUAL_DETECTION].push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_VISUAL),this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.VISUAL_DETECTION].push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.OVERLAY),this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.VISUAL_TRACKING]=[],this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.VISUAL_TRACKING].push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_VISUAL),this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.VISUAL_TRACKING].push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.OVERLAY),this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.SEGMENTATION]=[],this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.SEGMENTATION].push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_SEGMENT),this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.AUDIO_SEGMENTATION]=[],this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.AUDIO_SEGMENTATION].push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_SEGMENT),this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.TRANSCRIPTION]=[],this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.TRANSCRIPTION].push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.CAPTION),this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.TRANSCRIPTION].push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.TEXT_SYNC),this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.SYNCHRONIZED_TEXT]=[],this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.SYNCHRONIZED_TEXT].push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.CAPTION),this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.SYNCHRONIZED_TEXT].push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.TEXT_SYNC),this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.KEYFRAMES]=[],this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.KEYFRAMES].push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_IMAGE),this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.HISTOGRAM]=[],this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.HISTOGRAM].push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_HISTOGRAM)},getLinetypeWithDataType:function(a){return a===fr.ina.amalia.player.PluginBindingManager.dataTypes.DETECTION?fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_CUEPOINT:a===fr.ina.amalia.player.PluginBindingManager.dataTypes.AUDIO_SEGMENTATION?fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_SEGMENT:a===fr.ina.amalia.player.PluginBindingManager.dataTypes.SEGMENTATION?fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_SEGMENT:a===fr.ina.amalia.player.PluginBindingManager.dataTypes.KEYFRAMES?fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_IMAGE:a===fr.ina.amalia.player.PluginBindingManager.dataTypes.HISTOGRAM?fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_HISTOGRAM:a===fr.ina.amalia.player.PluginBindingManager.dataTypes.VISUAL_DETECTION||a===fr.ina.amalia.player.PluginBindingManager.dataTypes.VISUAL_TRACKING?fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_VISUAL:null},registerPlugin:function(a,b){if("undefined"==typeof this.listOfPlugins[a]&&(this.listOfPlugins[a]=[]),"object"==typeof b&&b.length>0)for(var c=0;c<b.length;c++)$.inArray(b[c],this.listOfPlugins[a])<0&&this.listOfPlugins[a].push(b[c])},isManagedDataType:function(a,b){var c=this.listOfPlugins[a];if("object"==typeof c&&c.length)for(var d=0;d<c.length;d++)if($.inArray(c[d],this.pluginAndDataTypeMap[b])>-1)return!0;return!1}}),$.Class("fr.ina.amalia.player.plugins.PluginManager",{},{settings:{},logger:null,pluginsSettings:{},plugins:null,mediaContainer:null,mediaPlayer:null,contextMenuPlugin:null,loadedCount:0,failCount:0,dataLoaded:0,httpDataServicesCount:0,listOfPluginIds:[],listOfPluginTypes:[],bindingManager:null,init:function(a,b,c){this.mediaPlayer=b,this.mediaContainer=c,this.httpDataServicesCount=0,this.settings=$.extend({debug:!1},a||{}),this.pluginsSettings=$.extend({debug:this.settings.debug,dataServices:[],list:[]},a.plugins||{}),void 0!==fr.ina.amalia.player.log&&void 0!==fr.ina.amalia.player.log.LogHandler&&(this.logger=new fr.ina.amalia.player.log.LogHandler({enabled:this.settings.debug})),this.plugins=[],this.initialize()},initialize:function(){null!==this.logger&&this.logger.trace(this.Class.fullName,"initialize"),this.bindingManager=new fr.ina.amalia.player.PluginBindingManager(this.settings,this.mediaPlayer),this.mediaPlayer.mediaPlayer.one(fr.ina.amalia.player.PlayerEventType.STARTED,{self:this},this.onStarted),this.mediaPlayer.mediaPlayer.on(fr.ina.amalia.player.PlayerEventType.ERROR,{self:this},this.onError)},loadPlugins:function(){var a={internalPlugin:!0};this.contextMenuPlugin=this.loadPlugin("fr.ina.amalia.player.plugins.ContextMenuPlugin",a,this.mediaPlayer,this.mediaContainer);var b=$.extend({internalPlugin:!0,framerate:this.settings.framerate,debug:this.settings.debug},this.settings.controlBar||{});this.loadPlugin(this.settings.controlBarClassName,b,this.mediaPlayer,this.mediaContainer),this.loadDynamicPlugins(this.pluginsSettings.list)},getContextMenuPlugin:function(){return this.contextMenuPlugin},onStarted:function(a){a.data.self.loadPlugins(),a.data.self.loadData(a.data.self.pluginsSettings.dataServices)},onError:function(a){a.data.self.mediaPlayer.mediaPlayer.trigger(fr.ina.amalia.player.PlayerEventType.PLUGIN_ERROR,{errorCode:fr.ina.amalia.player.PlayerErrorCode.ERROR_LOAD_PLUGIN})},loadData:function(hosts){if(this.mediaPlayer.mediaPlayer.trigger(fr.ina.amalia.player.PlayerEventType.BEGIN_DATA_CHANGE),$.isArray(hosts)){var i=0,loader=null,host=null,settings={debug:this.settings.debug};for(i=0;i<hosts.length;++i){if(loader=null,host=hosts[i],settings={debug:this.pluginsSettings.debug,format:host.hasOwnProperty("format")?host.format:"json",url:host.hasOwnProperty("url")?host.url:host,parameters:host.hasOwnProperty("parameters")?host.parameters:null,sublocalisations:host.hasOwnProperty("sublocalisations")?host.sublocalisations:!1},"string"==typeof host[i])loader=new fr.ina.amalia.player.HttpLoader(settings,this.mediaPlayer,this.dataLoadedHandler,{self:this});else if(host.hasOwnProperty("protocol"))if("http"===host.protocol)loader=new fr.ina.amalia.player.HttpLoader(settings,this.mediaPlayer,this.dataLoadedHandler,{self:this});else if("ws"===host.protocol)loader=new fr.ina.amalia.player.WsLoader(settings,this.mediaPlayer,this.dataLoadedHandler,{self:this});else try{loader=eval("new "+host.protocol+"(settings, this.mediaPlayer, this.dataLoadedHandler)")}catch(error){null!==this.logger&&(this.logger.warn("Unknown host configuration type."),this.logger.error(error.stack))}else this.logger.warn("Unknown host configuration."),this.logger.warn(host);null!==loader&&loader.getWaitLoadEvent()&&this.httpDataServicesCount++}}else null!==this.logger&&this.logger.warn("Error dataServices is not array.")},dataLoadedHandler:function(a,b){"success"===b?(a.self.dataLoaded++,a.self.dataLoaded===a.self.httpDataServicesCount&&(a.self.mediaPlayer.mediaPlayer.trigger(fr.ina.amalia.player.PlayerEventType.END_DATA_CHANGE),a.self.mediaPlayer.mediaPlayer.trigger(fr.ina.amalia.player.PlayerEventType.PLUGIN_READY))):(null!==this.logger&&(this.logger.warn("Failed to load data. status: "+b),this.logger.warn(a)),a.self.mediaPlayer.mediaPlayer.trigger(fr.ina.amalia.player.PlayerEventType.PLUGIN_ERROR,{errorCode:fr.ina.amalia.player.PlayerErrorCode.ERROR_LOAD_PLUGIN}))},loadDynamicPlugins:function(a){null!==this.logger&&(this.logger.info(this.Class.fullName,"loadPlugins List : "),this.logger.info(a));for(var b in a){var c=a[b];if(c=$.extend({debug:this.pluginsSettings.debug,className:null,container:null,data:this.data,parameters:{}},c||{}),"object"==typeof c&&null!==c.className){var d=null===c.container?this.mediaContainer:$(c.container);c.internalPlugin=null===c.container,this.loadPlugin(c.className,c,this.mediaPlayer,d)}else null!==this.logger&&this.logger.warn(this.Class.fullName,"Error to load plugin className:"+c.className)}},loadPlugin:function(className,settings,mediaPlayer,pluginContainer){null!==this.logger&&this.logger.info(this.Class.fullName,"loadPlugin className:"+className);try{var obj=eval("new "+className+"(settings,mediaPlayer,pluginContainer,this.bindingManager)");return obj.setUuid(fr.ina.amalia.player.helpers.UtilitiesHelper.generateUUID("p_")),this.bindingManager.registerPlugin(obj.getUuid(),obj.getPluginTypes()),this.listOfPluginIds.push(obj.getUuid()),this.listOfPluginTypes[obj.getUuid()]=obj.getPluginTypes(),this.plugins.push(obj),this.loadedCount++,null!==this.logger&&this.logger.info(className+"Plugin loaded :  "+className+" ID: "+obj.getUuid()),obj}catch(error){return this.failCount++,null!==this.logger&&(this.logger.warn("Error to load plugin : "+className),this.logger.warn(error.stack)),!1}}}),fr.ina.amalia.player.plugins.PluginBase.extend("fr.ina.amalia.player.plugins.captions.CaptionsBase",{},{container:null,listOfData:[],definePlayerListeners:function(){var a=this.mediaPlayer.getMediaPlayer();a.on(fr.ina.amalia.player.PlayerEventType.TIME_CHANGE,{self:this},this.onTimeupdate),null!==this.logger&&this.logger.trace(this.Class.fullName,"definePlayerListeners")},updateMetadata:function(a,b,c,d,e){this.listOfData=[];var f=null,g=null;e=e||!1,g=this.mediaPlayer.getMetadataWithRange(a,c,d);for(var h=0;h<g.length;h++)f=g[h],f.hasOwnProperty("sublocalisations")===!0&&null!==f.sublocalisations?this._parseSubLocalisations(f.sublocalisations,b,e):null!==f?this._parseLocalisation(f,b,e):null!==this.logger&&this.logger.trace(this.Class.fullName,"Error to set data, index: "+h)},_parseLocalisation:function(a,b,c){var d=null;if(a.tclevel<=b){if(a.tclevel===b&&c===!1||a.tclevel<=b&&c===!0){var e=this._getText(a.data);""!==e&&(d={tcin:"number"==typeof a.tcin?a.tcin:fr.ina.amalia.player.helpers.UtilitiesHelper.convertHourToSeconde(a.tcin),tcout:"number"==typeof a.tcout?a.tcout:fr.ina.amalia.player.helpers.UtilitiesHelper.convertHourToSeconde(a.tcout),text:e,label:a.label,thumb:a.thumb,level:a.tclevel},this.listOfData.push(d))}a.hasOwnProperty("sublocalisations")===!0&&null!==a.sublocalisations&&a.sublocalisations.hasOwnProperty("localisation")===!0&&$.isArray(a.sublocalisations.localisation)&&this._parseSubLocalisations(a.sublocalisations,b,c)}},_parseSubLocalisations:function(a,b,c){var d=null;if(null!==a&&"undefined"!=typeof a&&a.hasOwnProperty("localisation")===!0&&$.isArray(a.localisation))for(var e=0;e<a.localisation.length;e++)d=a.localisation[e],this._parseLocalisation(d,b,c);return d},_getText:function(a){var b="";if(null!==a&&"undefined"!=typeof a&&a.hasOwnProperty("text")===!0&&null!==a.text&&$.isArray(a.text))for(var c=0;c<a.text.length;c++)null!==a.text[c]&&(b+=a.text[c].toString());return b},updatePos:function(a){null!==this.logger&&this.logger.trace(this.Class.fullName,"updatePos : "+a)},onTimeupdate:function(a,b){a.data.self.updatePos(parseFloat(b.currentTime))}}),fr.ina.amalia.player.plugins.PluginBase.extend("fr.ina.amalia.player.plugins.ContextMenuPlugin",{classCss:"plugin-context-menu dropdown-menu lg",style:"",copyrightText:" V1.3.0, Â© INA 2015",copyrightHomepage:"http://ina-foss.github.io/amalia.js"},{container:null,menuConfiguration:{position:{my:"left top",at:"right top"}},initialize:function(){this.initContextMenu()},initContextMenu:function(){this.container=$("<ul/>",{"class":this.Class.classCss,style:this.Class.style,role:"menu","aria-labelledby":"dLabel"}).menu({disabled:!1}).css({position:"fixed",left:0,top:0}).hide(),this.addItemWithLink(this.Class.copyrightText,null,null,"ajs-icon  ajs-icon-amalia-js"),this.addItemWithLink(fr.ina.amalia.player.PlayerMessage.PLAYER_OPENSOURCE_LINK,this.Class.copyrightHomepage,"homepage","ajs-icon ajs-icon-github"),this.pluginContainer.append(this.container),this.container.on("mouseleave",{self:this},this.onMouseleave),this.pluginContainer.parent().on("contextmenu",{self:this},this.onContextmenu)},addItemWithLink:function(a,b,c,d){b=b?b:"#",d="string"==typeof d?d:null,c=c?c:"disabled";var e=$("<li>",{"class":c}),f=$("<a>",{text:a,target:"_blank",href:b});return null!==d&&f.append($("<span>",{"class":d})),"#"===b&&f.on("click",function(a){a.preventDefault()}),e.append(f),this.container.append(e),e},onContextmenu:function(a){var b=10;a.data.self.container.show().css({left:a.clientX-b,top:a.clientY-b}),a.preventDefault()},onMouseleave:function(a){a.preventDefault(),a.data.self.container.hide()}}),fr.ina.amalia.player.plugins.PluginBase.extend("fr.ina.amalia.player.plugins.CustomControlBarPlugin",{classCss:"plugin-custom-controlbar"},{container:null,leftContainer:null,midContainer:null,rightContainer:null,widgets:null,height:130,progressBar:null,autoHide:!0,displayState:!0,hideDuration:500,autoHideStarted:!1,initialize:function(){this.settings=$.extend({height:this.settings.sticky===!0?"45":"130",autohide:!0,hideDuration:500,timeFormat:this.settings.sticky===!0?"s":"ms",framerate:25,framepreview:!1,framepreviewTimeBound:500,sticky:!1,widgets:{left:{timelabelWidget:"fr.ina.amalia.player.plugins.controlBar.widgets.TimeLabel"},mid:{playWidget:"fr.ina.amalia.player.plugins.controlBar.widgets.PlayButton",pauseWidget:"fr.ina.amalia.player.plugins.controlBar.widgets.PauseButton"},right:{full:"fr.ina.amalia.player.plugins.controlBar.widgets.FullscreenButton",volume:"fr.ina.amalia.player.plugins.controlBar.widgets.VolumeControlBar"},settings:{}}},this.settings||{}),this.leftContainer=null,this.midContainer=null,this.rightContainer=null,this.widgets=[],this.autoHide=this.settings.sticky===!0?!1:this.settings.autohide,this.displayState=!0,this.hideDuration=this.settings.hideDuration,this.height=this.settings.height,this.autoHideStarted=!1,this.createControlBar(),this.initializeWidgets(),this.definePlayerListeners(),this.updatePlayerSize(!1),null!==this.logger&&(this.logger.trace(this.Class.fullName,"initialize"),this.logger.info(this.settings))},createControlBar:function(){var a=this.settings.sticky===!0?this.Class.classCss+" sticky":this.Class.classCss;this.container=$("<div>",{"class":a});var b=$("<div>",{"class":"ajs-row"});this.leftContainer=$("<div>",{"class":"ajs-container left-container"}),this.midContainer=$("<div>",{"class":"ajs-container middle-container"}),this.rightContainer=$("<div>",{"class":"ajs-container right-container"}),b.append(this.leftContainer),b.append(this.midContainer),b.append(this.rightContainer),this.container.append(b),this.container.height(this.height),this.pluginContainer.append(this.container)},initializeWidgets:function(){var a=this.settings.widgets;if(null!==this.logger&&(this.logger.trace(this.Class.fullName,"initialize"),this.logger.info(a)),a.hasOwnProperty("left"))for(var b in a.left)this.initWidget(b,a.left[b],this.leftContainer);if(a.hasOwnProperty("mid"))for(var c in a.mid)this.initWidget(c,a.mid[c],this.midContainer);if(a.hasOwnProperty("right"))for(var d in a.right)this.initWidget(d,a.right[d],this.rightContainer);this.settings.enableProgressBar!==!1&&(this.progressBar=new fr.ina.amalia.player.plugins.controlBar.widgets.ProgressBar({debug:this.settings.debug,framepreview:this.settings.framepreview,framepreviewTimeBound:this.settings.framepreviewTimeBound},this.mediaPlayer,this.container))},initWidget:function(widgetName,widgetClassName,container){try{var settings="object"==typeof this.settings.widgets.settings[widgetName]?this.settings.widgets.settings[widgetName]:this.settings,obj=eval("new "+widgetClassName+"(settings,this.mediaPlayer,container)");this.widgets.push(obj)}catch(error){null!==this.logger&&(this.logger.warn("Error to load widget : "+widgetClassName),this.logger.warn(error.stack))}},definePlayerListeners:function(){this.mediaPlayer.mediaContainer.on(fr.ina.amalia.player.PlayerEventType.FULLSCREEN_CHANGE,{self:this},this.onFullscreenModeChange),this.autoHide===!0&&(this.mediaPlayer.mediaContainer.one(fr.ina.amalia.player.PlayerEventType.PLAYING,{self:this},this.onPlaying),this.mediaPlayer.mediaContainer.one(fr.ina.amalia.player.PlayerEventType.SEEK,{self:this},this.onSeeking)),null!==this.logger&&this.logger.trace(this.Class.fullName,"defineWidgetsListeners")},updatePlayerSize:function(a){this.settings.sticky===!0?a===!0?this.mediaPlayer.mediaContainer.find("video").first().css("height",parseInt(window.screen.height-this.height)):this.mediaPlayer.mediaContainer.find("video").first().css("height",parseInt(this.mediaPlayer.mediaContainer.parent().height()-this.height)):this.container.css("bottom",this.height+"px")},show:function(){var a=this;a.displayState===!1&&(a.container.find(".row").show(),a.container.find(".player-progress-bar").css("height","20px"),a.container.find(".player-progress-bar .ui-slider-handle").css("width","20px"),a.container.animate({bottom:a.height+"px"},250,function(){a.displayState=!0}))},hide:function(){var a=this;a.displayState===!0&&a.container.animate({bottom:"10px"},250,function(){a.container.find(".row").hide(),a.container.find(".player-progress-bar").css("height","10px"),a.container.find(".player-progress-bar .ui-slider-handle").css("width","10px"),a.displayState=!1})},onFullscreenModeChange:function(a,b){a.data.self.updatePlayerSize(b.inFullScreen)},onPlayerMouseEnter:function(a){a.data.self.displayState===!1&&a.data.self.show(),null!==a.data.self.logger&&a.data.self.logger.trace(a.data.self.Class.fullName,"onPlayerMouseEnter")},onPlayerMouseLeave:function(a){a.data.self.displayState===!0&&setTimeout(function(){a.data.self.hide()},a.data.self.hideDuration),null!==a.data.self.logger&&a.data.self.logger.trace(a.data.self.Class.fullName,"onPlayerMouseLeave")},onPlaying:function(a){a.data.self.autoHideStarted===!1&&(a.data.self.autoHideStarted=!0,a.data.self.mediaPlayer.mediaContainer.on("mouseenter touchstart",{self:a.data.self},a.data.self.onPlayerMouseEnter),a.data.self.mediaPlayer.mediaContainer.on("mouseleave touchleave",{self:a.data.self},a.data.self.onPlayerMouseLeave))},onSeeking:function(a){a.data.self.autoHideStarted===!1&&(a.data.self.autoHideStarted=!0,a.data.self.hide(),a.data.self.mediaPlayer.mediaContainer.on("mouseenter touchstart",{self:a.data.self},a.data.self.onPlayerMouseEnter),a.data.self.mediaPlayer.mediaContainer.on("mouseleave touchleave",{self:a.data.self},a.data.self.onPlayerMouseLeave))}}),$.Class("fr.ina.amalia.player.LocalStorageManager",{storageNamespace:"ina.media.player"},{settings:{},logger:null,data:null,init:function(){this.initializeStorage()},initializeStorage:function(){if("undefined"!=typeof localStorage)try{localStorage.hasOwnProperty(this.Class.storageNamespace)===!1&&localStorage.setItem(this.Class.storageNamespace,JSON.stringify({})),this.data=JSON.parse(localStorage.getItem(this.Class.storageNamespace))}catch(a){this.data=null}else this.data=null},updateDataStorage:function(){try{"undefined"!=typeof localStorage&&localStorage.setItem(this.Class.storageNamespace,JSON.stringify(this.data))}catch(a){this.data=null}},hasItem:function(a){return null!==this.data&&this.data.hasOwnProperty(a)===!0},getItem:function(a){return null!==this.data&&this.data.hasOwnProperty(a)===!0?this.data[a]:null},setItem:function(a,b){try{null!==this.data&&"undefined"!=typeof a&&"undefined"!=typeof b&&(this.data[a]=b,this.updateDataStorage())}catch(c){return null}return!0},removeItem:function(a){null!==this.data&&"undefined"!=typeof a&&(this.data.splice(a,1),this.updateDataStorage())},clear:function(){"undefined"!=typeof localStorage&&localStorage.removeItem(this.Class.storageNamespace)}}),$.Class("fr.ina.amalia.player.mediaTypeManager",{},{mediaPlayer:null,logger:null,settings:{},init:function(a,b){if(this.mediaPlayer=b,this.namespace=this.Class.fullName,this.settings=$.extend({debug:!1,internalPlugin:!1},a||{}),void 0!==fr.ina.amalia.player.log&&void 0!==fr.ina.amalia.player.log.LogHandler&&(this.logger=new fr.ina.amalia.player.log.LogHandler({enabled:this.settings.debug})),null===this.mediaPlayer)throw new Error("Can't initialize plugin name"+this.Class.fullName);this.initialize()},initialize:function(){}}),fr.ina.amalia.player.mediaTypeManager.extend("fr.ina.amalia.player.media.type.DashMpeg",{},{context:null,dashPlayer:null,initialize:function(){this.context=new Dash.di.DashContext,this.dashPlayer=new MediaPlayer(this.context)},setSrc:function(a){this.dashPlayer.startup(),this.dashPlayer.attachView(this.mediaPlayer.get(0)),this.dashPlayer.attachSource(a),null!==this.logger&&this.logger.trace(this.Class.fullName,"set dash src :"+this.url)}}),$.Class("fr.ina.amalia.player.PlayerHtml5",{mediaPlayerClassCss:"player",mediaPlayerStyleCss:"position: relative; width: inherit; height: inherit; background-color: black; "},{logger:null,settings:{},mediaContainer:null,mediaPlayer:null,pluginManager:null,localStorageManager:null,loaderContainer:null,errorContainer:null,isIOSDevices:!1,isRangePlayer:!1,rangePlayerTcout:null,captureId:null,captureTc:null,captureScale:1,zTcin:null,zTcout:null,tcOffset:0,mediaTypeManager:null,metadataManager:null,init:function(a,b){this.settings=$.extend({autoplay:!1,poster:"",src:"",defaultVolume:75,crossorigin:""},a||{}),void 0!==fr.ina.amalia.player.log&&void 0!==fr.ina.amalia.player.log.LogHandler&&(this.logger=new fr.ina.amalia.player.log.LogHandler({enabled:this.settings.debug})),this.mediaContainer=b,this.initialize()},initialize:function(){null!==this.logger&&this.logger.trace(this.Class.fullName,"initialize");var a=-1!==navigator.userAgent.indexOf("iPhone"),b=-1!==navigator.userAgent.indexOf("iPod"),c=-1!==navigator.userAgent.indexOf("iPad");this.isIOSDevices=a||c||b,this.tcOffset=parseInt(this.settings.tcOffset),this.createLoaderContainer(),this.createErrorContainer(),this.createPlayer(),this.initializePlugins(),this.initializeMetadataManager(),this.localStorageManager=new fr.ina.amalia.player.LocalStorageManager({}),this.setSrc(this.settings.src,this.settings.autoplay),this.setVolume(this.localStorageManager.hasItem("volume")===!1?this.settings.defaultVolume:this.localStorageManager.getItem("volume"))},initializePlugins:function(){null!==this.logger&&this.logger.trace(this.Class.fullName,"initializePlugins"),this.pluginManager=new fr.ina.amalia.player.plugins.PluginManager(this.settings,this,this.mediaContainer)},initializeMetadataManager:function(){null!==this.logger&&this.logger.trace(this.Class.fullName,"initializePlugins"),this.metadataManager=new fr.ina.amalia.player.MetadataManager(this.settings,this,this.mediaContainer)},setSrc:function(a,b){null!==this.logger&&this.logger.trace(this.Class.fullName,"setSrc:"+a),"mpd"===this.settings.mediaType?(this.mediaTypeManager=new fr.ina.amalia.player.media.type.DashMpeg(this.settings,this.mediaPlayer),this.mediaTypeManager.setSrc(a)):(this.mediaPlayer.find("source:first").attr({src:a}),this.load(),b===!0&&this.play())},createPlayer:function(){if(null!==this.logger&&this.logger.trace(this.Class.fullName,"createPlayer"),this.mediaPlayer=$("<video/>",{"class":this.Class.mediaPlayerClassCss,style:this.Class.mediaPlayerStyleCss,"x-webkit-airplay":"allow"}),""!==this.settings.crossorigin&&this.mediaPlayer.attr("crossorigin",this.settings.crossorigin),""!==this.settings.poster&&this.mediaPlayer.attr("poster",this.settings.poster),"mpd"!==this.settings.mediaType){var a=$("<source />");this.mediaPlayer.append(a)}this.mediaContainer.append(this.mediaPlayer),this.initEvents()},createLoaderContainer:function(){this.loaderContainer=$("<div>",{"class":"ajs-loader"});var a=$("<i>",{"class":"fa fa-cog fa-spin fa-5x"});this.loaderContainer.append(a),this.loaderContainer.hide(),this.mediaContainer.append(this.loaderContainer),this.showLoader()},createErrorContainer:function(){this.errorContainer=$("<div>",{"class":"ajs-error"}),this.errorContainer.hide(),this.mediaContainer.append(this.errorContainer)},initEvents:function(){null!==this.logger&&this.logger.trace(this.Class.fullName,"adEvents"),this.mediaPlayer.on("loadstart",{self:this},this.onLoadstart),this.mediaPlayer.on("playing",{self:this},this.onPlay),this.mediaPlayer.on("pause",{self:this},this.onPause),this.mediaPlayer.on("ended",{self:this},this.onEnded),this.mediaPlayer.one("durationchange",{self:this},this.onDurationchange),this.mediaPlayer.on("timeupdate",{self:this},this.onTimeupdate),this.mediaPlayer.find("source").on("error",{self:this},this.onSourceError),this.mediaPlayer.on("seeked",{self:this},this.onSeeked),this.mediaPlayer.on(fr.ina.amalia.player.PlayerEventType.ERROR,{self:this},this.onError),$(document).on("webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange",{self:this},this.fullScreenHandler)},load:function(){this.mediaPlayer.get(0).load()},showLoader:function(){this.loaderContainer.show()},hideLoader:function(){this.loaderContainer.hide()},play:function(){if(this.mediaPlayer.get(0).play(),"undefined"!=typeof this.settings.callbacks.onPlay)try{eval(this.settings.callbacks.onPlay+"()")}catch(e){null!==this.logger&&this.logger.warn("Send callback failed.")}},pause:function(){if(this.mediaPlayer.get(0).pause(),this.isRangePlayer=!1,this.rangePlayerTcout=null,"undefined"!=typeof this.settings.callbacks.onPause)try{eval(this.settings.callbacks.onPause+"()")}catch(e){null!==this.logger&&this.logger.warn("Send callback failed.")}},stop:function(){if(this.mediaPlayer.get(0).pause(),this.mediaPlayer.get(0).currentTime=0,"undefined"!=typeof this.settings.callback.onStop)try{eval(this.settings.callbacks.onStop+"()")}catch(e){null!==this.logger&&this.logger.warn("Send callback failed.")}},seek:function(a){return this.setCurrentTime(a)},mute:function(){return this.mediaPlayer.trigger(fr.ina.amalia.player.PlayerEventType.MUTE),this.mediaPlayer.get(0).volume=0},unmute:function(){this.mediaPlayer.trigger(fr.ina.amalia.player.PlayerEventType.UN_MUTE),this.mediaPlayer.get(0).volume=1},getMediaPlayer:function(){return this.mediaPlayer},getDuration:function(){return this.mediaPlayer.get(0).duration},getTcOffset:function(){return this.tcOffset},getVolume:function(){return 100*this.mediaPlayer.get(0).volume},rangePlay:function(a,b,c){c="undefined"==typeof c?!1:c,this.isRangePlayer=!0,this.rangePlayerTcout=b+this.tcOffset,this.setCurrentTime(a),c===!0&&this.play()},setVolume:function(a){return a>=0&&100>=a?(this.mediaPlayer.trigger(fr.ina.amalia.player.PlayerEventType.VOLUME_CHANGE,{volume:a}),this.localStorageManager.setItem("volume",a),null!==this.logger&&this.logger.trace(this.Class.fullName,"setVolume"+a),this.mediaPlayer.get(0).volume=a/100):null},setCurrentTime:function(a){var b=isNaN(a)?0:a;return this.mediaPlayer.trigger(fr.ina.amalia.player.PlayerEventType.SEEK,{currentTime:b}),this.mediaPlayer.get(0).currentTime=Math.max(0,b-this.tcOffset)},setErrorCode:function(a){if("undefined"!=typeof this.errorContainer){var b=$("<p>",{text:fr.ina.amalia.player.PlayerErrorCode.getMessage(a)
});this.errorContainer.html(b),this.errorContainer.show()}},getFullscreen:function(){return fr.ina.amalia.player.helpers.HTML5Helper.isFullScreen()},getCurrentTime:function(){return this.mediaPlayer.get(0).currentTime+this.tcOffset},isPaused:function(){return this.mediaPlayer.get(0).paused},toggleFullScreen:function(){var container=this.isIOSDevices?this.mediaPlayer.get(0):this.mediaContainer.get(0),inFullScreen=fr.ina.amalia.player.helpers.HTML5Helper.toggleFullScreen(container,this.isIOSDevices);if("undefined"!=typeof this.settings.callbacks.onFullscreen)try{eval(this.settings.callbacks.onFullscreen+"(inFullScreen)")}catch(e){null!==this.logger&&this.logger.warn("Send callback failed.")}return null!==this.logger&&this.logger.trace(this.Class.fullName,"onClickFullscreenButton :"+inFullScreen),inFullScreen},fullScreenHandler:function(a){var b=$(document).context,c=b.fullscreen||b.mozFullScreen||b.webkitIsFullScreen?!0:!1;a.data.self.mediaPlayer.trigger(fr.ina.amalia.player.PlayerEventType.FULLSCREEN_CHANGE,{inFullScreen:c}),null!==a.data.self.logger&&a.data.self.logger.trace(a.data.self.Class.fullName,"fullScreenHandler :"+c)},getMetadataManager:function(){return this.metadataManager},getBlocksMetadata:function(){return this.metadataManager.getBlocksMetadata()},getBlockMetadata:function(a){return this.metadataManager.getBlockMetadata(a)},updateBlockMetadata:function(a,b,c){this.metadataManager.updateBlockMetadata(a,b,c)},removeBlockMetadata:function(a){return this.metadataManager.removeBlockMetadata(a)},addAllMetadata:function(a){this.metadataManager.addAllMetadata(a)},addMetadataById:function(a,b){this.metadataManager.addMetadataById(a,b)},replaceAllMetadataById:function(a,b){this.metadataManager.replaceAllMetadataById(a,b)},deleteAllMetadataById:function(a){this.metadataManager.deleteAllMetadataById(a)},getMetadataById:function(a){return this.metadataManager.getMetadataById(a)},setMetadataById:function(a,b){return this.metadataManager.setMetadataById(a,b)},removeMetadataById:function(a){return this.metadataManager.removeMetadataById(a)},getMetadataWithRange:function(a,b,c){return this.metadataManager.getMetadataWithRange(a,b,c)},getSelectedMetadataId:function(){return this.metadataManager.getSelectedMetadataId()},setSelectedMetadataId:function(a){this.metadataManager.setSelectedMetadataId(a)},addMetadataItem:function(a,b){this.metadataManager.addMetadataItem(a,b)},getSelectedItems:function(){return this.metadataManager.getSelectedItems()},addSelectedItem:function(a){this.metadataManager.addSelectedItem(a)},removeAllSelectedItems:function(){this.metadataManager.removeAllSelectedItems()},setZoomTc:function(a,b,c){c="undefined"!=typeof c?c:"",(Math.ceil(this.zTcin)!==Math.ceil(a)||Math.ceil(this.zTcout)!==Math.ceil(b))&&(this.zTcin=Math.max(0,parseFloat(a)),this.zTcout=parseFloat(b),null!==this.logger&&this.logger.info("SetZoomTc: // Tcin: "+this.zTcin+" // Tcout:"+this.zTcout+" // Event Tag Name:"+c),this.mediaPlayer.trigger(fr.ina.amalia.player.PlayerEventType.ZOOM_RANGE_CHANGE,{zTcin:parseFloat(a),zTcout:parseFloat(b),eventTag:c}))},getCurrentImage:function(a){var b="";try{var c=this.mediaPlayer.get(0),d=document.createElement("canvas");return a="undefined"!=typeof a?Math.min(1,parseFloat(a)):1,d.width=c.videoWidth*a,d.height=c.videoHeight*a,d.getContext("2d").drawImage(c,0,0,d.width,d.height),b=d.toDataURL("image/png"),this.mediaPlayer.trigger(fr.ina.amalia.player.PlayerEventType.IMAGE_CAPTURE,{currentTime:this.getCurrentTime(),captureTc:this.captureTc.toString(),captureId:this.captureId.toString(),captureImage:b.toString()}),b}catch(e){null!==this.logger&&(this.logger.warn("Error lors de la capture d'imagette"),this.logger.warn(e.stack))}return b},getTcImage:function(a,b,c){this.setCurrentTime(b),this.play(),this.captureId=a,this.captureTc=b+this.tcOffset,this.captureScale="undefined"!=typeof c?Math.min(1,parseFloat(c)):1},onLoadstart:function(event){if(null!==event.data.self.logger&&event.data.self.logger.trace(event.data.self.Class.fullName,"onLoadstart"),"undefined"!=typeof event.data.self.settings.callbacks.onReady)try{eval(event.data.self.settings.callbacks.onReady+"()")}catch(e){null!==event.data.self.logger&&event.data.self.logger.warn("Send callback failed.")}},onPlay:function(a){null!==a.data.self.logger&&a.data.self.logger.trace(a.data.self.Class.fullName,"onPlay"),a.data.self.mediaPlayer.trigger(fr.ina.amalia.player.PlayerEventType.PLAYING,[a.data.self])},onPause:function(a){null!==a.data.self.logger&&a.data.self.logger.trace(a.data.self.Class.fullName,"onPause"),a.data.self.mediaPlayer.trigger(fr.ina.amalia.player.PlayerEventType.PAUSED,[a.data.self])},onSeeked:function(a){if(a.data.self.mediaPlayer.trigger(fr.ina.amalia.player.PlayerEventType.SEEK,{currentTime:a.data.self.getCurrentTime()}),"number"==typeof a.data.self.captureTc)try{a.data.self.getCurrentImage(a.data.self.captureScale),a.data.self.captureTc=null}catch(b){null!==a.data.self.logger&&(a.data.self.logger.warn("Error to capture Tc"),a.data.self.logger.warn(b.stack))}},onEnded:function(event){if(null!==event.data.self.logger&&event.data.self.logger.trace(event.data.self.Class.fullName,"onEnded"),event.data.self.mediaPlayer.trigger(fr.ina.amalia.player.PlayerEventType.ENDEN,[event.data.self]),"undefined"!=typeof event.data.self.settings.callbacks.onComplete)try{eval(event.data.self.settings.callbacks.onComplete+"()")}catch(e){null!==event.data.self.logger&&event.data.self.logger.warn("Send callback failed.")}},onDurationchange:function(a){a.data.self.hideLoader(),a.data.self.mediaPlayer.trigger(fr.ina.amalia.player.PlayerEventType.STARTED,[a.data.self]),a.data.self.settings.autoplay===!0&&a.data.self.play()},onTimeupdate:function(event){var tcOffset=event.data.self.getTcOffset(),currentTime=event.data.self.getCurrentTime(),duration=event.data.self.getDuration()+tcOffset,percentage=100*(currentTime-tcOffset)/(duration-tcOffset);if(event.data.self.mediaPlayer.trigger(fr.ina.amalia.player.PlayerEventType.TIME_CHANGE,{self:event.data.self,currentTime:currentTime,duration:duration,percentage:percentage,tcOffset:event.data.self.getTcOffset()}),event.data.self.isRangePlayer===!0&&"number"==typeof event.data.self.rangePlayerTcout&&event.data.self.rangePlayerTcout<=currentTime&&event.data.self.pause(),"undefined"!=typeof event.data.self.settings.callbacks.onTimeupdate)try{eval(event.data.self.settings.callbacks.onTimeupdate+"(currentTime)")}catch(e){null!==event.data.self.logger&&event.data.self.logger.warn("Send callback failed.")}},onSourceError:function(a){null!==a.data.self.logger&&(a.data.self.logger.warn(a.data.self.Class.fullName+" :: onSourceError"),a.data.self.logger.warn(a)),a.data.self.mediaPlayer.trigger(fr.ina.amalia.player.PlayerEventType.ERROR,{self:a.data.self,errorCode:fr.ina.amalia.player.PlayerErrorCode.MEDIA_FILE_NOT_FOUND})},onError:function(event,data){null!==event.data.self.logger&&event.data.self.logger.trace(event.data.self.Class.fullName,"onError");var errorCode="undefined"==typeof data.errorCode?"":data.errorCode;if(event.data.self.setErrorCode(errorCode),"undefined"!=typeof event.data.self.settings.callbacks.onError)try{eval(event.data.self.settings.callbacks.onError+"(errorCode)")}catch(e){null!==event.data.self.logger&&event.data.self.logger.warn("Send callback failed.")}},addMenuItemWithLink:function(a,b,c){if("object"==typeof this.pluginManager&&"function"==typeof this.pluginManager.getContextMenuPlugin){var d=this.pluginManager.getContextMenuPlugin();if("object"==typeof d&&"function"==typeof d.addItemWithLink)return d.addItemWithLink(a,b,c)}return!1}}),$.Class("fr.ina.amalia.player.MediaFactory",{},{settings:{},logger:null,mediaContainer:null,player:null,errorContainer:null,init:function(a,b){this.mediaContainer=$(a),this.settings=$.extend({src:null,poster:"",autoplay:!1,plugins:{},callbacks:{},debug:!1},b||{}),void 0!==fr.ina.amalia.player.log&&void 0!==fr.ina.amalia.player.log.LogHandler&&(this.logger=new fr.ina.amalia.player.log.LogHandler({enabled:this.settings.debug})),this.initialize()},initialize:function(){try{this.loadPlayer(),null!==this.logger&&this.logger.trace(this.Class.fullName,"initialize")}catch(a){this.createErrorContainer(),this.setErrorCode(8e3),null!==this.logger&&this.logger.error(a.stack)}},createErrorContainer:function(){this.errorContainer=$("<div>",{"class":"ajs-error"}),this.errorContainer.hide(),this.mediaContainer.append(this.errorContainer)},setErrorCode:function(a){if("undefined"!=typeof this.errorContainer){var b=$("<p>",{text:fr.ina.amalia.player.PlayerErrorCode.getMessage(a)});this.errorContainer.html(b),this.errorContainer.show()}},loadPlayer:function(){if(null!==this.logger&&this.logger.trace(this.Class.fullName,"Load html 5 media player"),null===this.src)throw new Error("Can't find media src");var a=new fr.ina.amalia.player.helpers.BrowserFeatureDetection;if(!a.isSupportsVideos())throw null!==this.logger&&this.logger.error("Your browser does not support the video tag."),new Error("Your browser does not support the video tag.");this.loadHtml5MediaPlayer()},loadHtml5MediaPlayer:function(){null!==this.logger&&this.logger.info("Load html 5 media player"),this.player=new fr.ina.amalia.player.PlayerHtml5(this.settings,this.mediaContainer)},getPlayer:function(){return this.player}}),function(a){a.fn.mediaPlayer=function(b){return this.each(function(){var c=a(this),d="fr.ina.amalia.player";if(c.data(d))return null;b=a.extend({plugins:{},src:null,framerate:25,autoplay:!0,controlBarClassName:"fr.ina.amalia.player.plugins.CustomControlBarPlugin",controlBar:{},tcOffset:0,mediaType:"mp4",debug:!1},b||{});var e=new fr.ina.amalia.player.MediaFactory(this,b);c.data(d,e),c.addClass("ajs"),c.attr("style","width: 100%; height:100%;"),c.parent().css("position","relative")})}}(jQuery);